<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.3"/>
    <title>tiler API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>


            <h2>Contents</h2>
            <ul>
  <li><a href="#features">Features</a></li>
  <li><a href="#quick-start">Quick start</a></li>
  <li><a href="#installation">Installation</a></li>
  <li><a href="#motivation-other-packages">Motivation &amp; other packages</a></li>
  <li><a href="#frequently-asked-questions">Frequently asked questions</a></li>
</ul>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#Tiler">Tiler</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Tiler.__init__">Tiler</a>
                        </li>
                        <li>
                                <a class="variable" href="#Tiler.TILING_MODES">TILING_MODES</a>
                        </li>
                        <li>
                                <a class="function" href="#Tiler.recalculate">recalculate</a>
                        </li>
                        <li>
                                <a class="function" href="#Tiler.iterate">iterate</a>
                        </li>
                        <li>
                                <a class="function" href="#Tiler.get_tile">get_tile</a>
                        </li>
                        <li>
                                <a class="function" href="#Tiler.get_all_tiles">get_all_tiles</a>
                        </li>
                        <li>
                                <a class="function" href="#Tiler.get_tile_bbox">get_tile_bbox</a>
                        </li>
                        <li>
                                <a class="function" href="#Tiler.get_tile_mosaic_position">get_tile_mosaic_position</a>
                        </li>
                        <li>
                                <a class="function" href="#Tiler.get_mosaic_shape">get_mosaic_shape</a>
                        </li>
                        <li>
                                <a class="function" href="#Tiler.calculate_padding">calculate_padding</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Merger">Merger</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Merger.__init__">Merger</a>
                        </li>
                        <li>
                                <a class="variable" href="#Merger.SUPPORTED_WINDOWS">SUPPORTED_WINDOWS</a>
                        </li>
                        <li>
                                <a class="function" href="#Merger.set_window">set_window</a>
                        </li>
                        <li>
                                <a class="function" href="#Merger.reset">reset</a>
                        </li>
                        <li>
                                <a class="function" href="#Merger.add">add</a>
                        </li>
                        <li>
                                <a class="function" href="#Merger.add_batch">add_batch</a>
                        </li>
                        <li>
                                <a class="function" href="#Merger.merge">merge</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
tiler    </h1>

                        <div class="docstring"><p><img src="tiler_teaser.png" alt="Tiler teaser image" /></p>

<p><a href="https://github.com/the-lay/tiler/actions/workflows/ci.yml"><img src="https://github.com/the-lay/tiler/actions/workflows/ci.yml/badge.svg" alt="CI" /></a>
<a href="https://coveralls.io/github/the-lay/tiler?branch=master"><img src="https://coveralls.io/repos/github/the-lay/tiler/badge.svg?branch=master" alt="Coverage status" /></a>
<a href="https://badge.fury.io/py/tiler"><img src="https://badge.fury.io/py/tiler.svg" alt="PyPI version" /></a></p>

<p><a href="https://github.com/the-lay/tiler">Github repository</a> | 
<a href="https://github.com/the-lay/tiler/issues">Github issues</a> | 
<a href="https://the-lay.github.io/tiler">Documentation</a></p>

<hr />

<p>This python package provides consistent and user-friendly
functions for tiling/patching and subsequent merging of NumPy arrays.</p>

<p>Such tiling is often required for various heavy image-processing tasks
such as semantic segmentation in deep learning, especially in domains where images do not fit into GPU memory
(e.g., hyperspectral satellite images, whole slide images, videos, tomography data).</p>

<p>Please see <a href="https://github.com/the-lay/tiler#quick-start">Quick start section</a>.<br />
If you want to use tiler interactively, I highly recommend <a href="https://github.com/napari/napari">napari</a> and <a href="https://github.com/tdmorello/napari-tiler">napari-tiler plugin</a>.</p>

<h2 id="features">Features</h2>

<ul>
<li>N-dimensional</li>
<li>Optional in-place tiling</li>
<li>Optional channel dimension (dimension that is not tiled)</li>
<li>Optional tile batching</li>
<li>Tile overlapping</li>
<li>Access individual tiles with an iterator or a getter</li>
<li>Tile merging, with optional window functions/tapering</li>
</ul>

<h2 id="quick-start">Quick start</h2>

<p>You can find more examples in <a href="https://github.com/the-lay/tiler/tree/master/examples">examples</a>.<br />
For more Tiler and Merger functionality, please check <a href="https://the-lay.github.io/tiler">documentation</a>.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tiler</span><span class="w"> </span><span class="kn">import</span> <span class="n">Tiler</span><span class="p">,</span> <span class="n">Merger</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1920</span><span class="p">,</span> <span class="mi">1080</span><span class="p">))</span>

<span class="c1"># Setup tiling parameters</span>
<span class="n">tiler</span> <span class="o">=</span> <span class="n">Tiler</span><span class="p">(</span><span class="n">data_shape</span><span class="o">=</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
              <span class="n">tile_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">250</span><span class="p">),</span>
              <span class="n">channel_dimension</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1">## Access tiles:</span>
<span class="c1"># 1. with an iterator</span>
<span class="k">for</span> <span class="n">tile_id</span><span class="p">,</span> <span class="n">tile</span> <span class="ow">in</span> <span class="n">tiler</span><span class="o">.</span><span class="n">iterate</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>
   <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Tile </span><span class="si">{</span><span class="n">tile_id</span><span class="si">}</span><span class="s1"> out of </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">tiler</span><span class="p">)</span><span class="si">}</span><span class="s1"> tiles.&#39;</span><span class="p">)</span>
<span class="c1"># 1b. the iterator can also be accessed through __call__</span>
<span class="k">for</span> <span class="n">tile_id</span><span class="p">,</span> <span class="n">tile</span> <span class="ow">in</span> <span class="n">tiler</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>
   <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Tile </span><span class="si">{</span><span class="n">tile_id</span><span class="si">}</span><span class="s1"> out of </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">tiler</span><span class="p">)</span><span class="si">}</span><span class="s1"> tiles.&#39;</span><span class="p">)</span>
<span class="c1"># 2. individually</span>
<span class="n">tile_3</span> <span class="o">=</span> <span class="n">tiler</span><span class="o">.</span><span class="n">get_tile</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="c1"># 3. in batches</span>
<span class="n">tiles_in_batches</span> <span class="o">=</span> <span class="p">[</span><span class="n">batch</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">batch</span> <span class="ow">in</span> <span class="n">tiler</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">10</span><span class="p">)]</span>

<span class="c1"># Setup merging parameters</span>
<span class="n">merger</span> <span class="o">=</span> <span class="n">Merger</span><span class="p">(</span><span class="n">tiler</span><span class="p">)</span>

<span class="c1">## Merge tiles:</span>
<span class="c1"># 1. one by one</span>
<span class="k">for</span> <span class="n">tile_id</span><span class="p">,</span> <span class="n">tile</span> <span class="ow">in</span> <span class="n">tiler</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>
   <span class="n">merger</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tile_id</span><span class="p">,</span> <span class="n">some_processing_fn</span><span class="p">(</span><span class="n">tile</span><span class="p">))</span>
<span class="c1"># 2. in batches</span>
<span class="n">merger</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="k">for</span> <span class="n">batch_id</span><span class="p">,</span> <span class="n">batch</span> <span class="ow">in</span> <span class="n">tiler</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
   <span class="n">merger</span><span class="o">.</span><span class="n">add_batch</span><span class="p">(</span><span class="n">batch_id</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">batch</span><span class="p">)</span>

<span class="c1"># Final merging: applies tapering and optional unpadding</span>
<span class="n">final_image</span> <span class="o">=</span> <span class="n">merger</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">unpad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># (3, 1920, 1080)</span>
</code></pre>
</div>

<h2 id="installation">Installation</h2>

<p>The latest release is available through pip:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>tiler
</code></pre>
</div>

<p>Alternatively, you can clone the repository and install it manually:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code>git<span class="w"> </span>clone<span class="w"> </span>git@github.com:the-lay/tiler.git
<span class="nb">cd</span><span class="w"> </span>tiler
pip<span class="w"> </span>install
</code></pre>
</div>

<p>If you are planning to contribute, please take a look at the <a href=".github/CONTRIBUTING.md">contribution instructions</a>.</p>

<h2 id="motivation-other-packages">Motivation &amp; other packages</h2>

<p>I work on semantic segmentation of patched 3D data and
I often found myself reusing tiling functions that I wrote for the previous projects.
No existing libraries listed below fit my use case, so that's why I wrote this library.</p>

<p>However, other libraries/examples might fit you better:</p>

<ul>
<li><a href="https://github.com/vfdev-5/ImageTilingUtils">vfdev-5/ImageTilingUtils</a>
<ul>
<li>Minimalistic image reader agnostic 2D tiling tools</li>
</ul></li>
</ul>

<ul>
<li><p><a href="https://github.com/BloodAxe/pytorch-toolbelt#inference-on-huge-images">BloodAxe/pytorch-toolbelt</a></p>

<ul>
<li>Powerful PyTorch toolset that has 2D image tiling and on-GPU merger</li>
</ul></li>
<li><p><a href="https://github.com/Vooban/Smoothly-Blend-Image-Patches">Vooban/Smoothly-Blend-Image-Patches</a></p>

<ul>
<li>Mirroring and D4 rotations data (8-fold) augmentation with squared spline window function for 2D images</li>
</ul></li>
<li><p><a href="https://github.com/samdobson/image_slicer">samdobson/image_slicer</a></p>

<ul>
<li>Slicing and merging 2D image into N equally sized tiles</li>
</ul></li>
<li><p><a href="https://github.com/dovahcrow/patchify.py">dovahcrow/patchify.py</a></p>

<ul>
<li>Tile and merge 2D, 3D images defined by tile shapes and step between tiles</li>
</ul></li>
<li><p>Do you know any other similar packages?</p>

<ul>
<li>Please let me know by contacting me, <a href="(https://github.com/the-lay/tiler/pulls)">making a PR</a> or <a href="https://github.com/the-lay/tiler/issues">opening a new issue</a>.</li>
</ul></li>
</ul>

<p>Moreover, some related approaches have been described in the literature:</p>

<ul>
<li><a href="https://doi.org/10.1371/journal.pone.0229839
">Introducing Hann windows for reducing edge-effects in patch-based image segmentation</a>, Pielawski and Wählby, March 2020</li>
</ul>

<h2 id="frequently-asked-questions">Frequently asked questions</h2>

<p>This section is a work in progress.</p>

<p><strong>How do I create tiles with less dimensions than the data array?</strong></p>

<p>Tiler expects <code>tile_shape</code> to have less than or the same number of elements as <code>data_shape</code>.
If <code>tile_shape</code> has less elements than <code>data_shape</code>, <code>tile_shape</code> will be prepended with 
ones to match the size of <code>data_shape</code>.<br />
For example, if you want to get 2d tiles out from 3d array you can initialize Tiler like this: <code>Tiler(data_shape=(128,128,128), tile_shape=(128, 128))</code> and it will be equivalent to
<code>Tiler(data_shape=(128,128,128), tile_shape=(1, 128, 128))</code>.</p>
</div>

                        <input id="mod-tiler-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-tiler-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos"> 1</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos"> 2</span></a>
</span><span id="L-3"><a href="#L-3"><span class="linenos"> 3</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">tiler.merger</span><span class="w"> </span><span class="kn">import</span> <span class="n">Merger</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos"> 4</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">tiler.tiler</span><span class="w"> </span><span class="kn">import</span> <span class="n">Tiler</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos"> 5</span></a>
</span><span id="L-6"><a href="#L-6"><span class="linenos"> 6</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Tiler&quot;</span><span class="p">,</span> <span class="s2">&quot;Merger&quot;</span><span class="p">]</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos"> 7</span></a>
</span><span id="L-8"><a href="#L-8"><span class="linenos"> 8</span></a><span class="c1"># Import README file as a module general docstring, only when generating documentation</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos"> 9</span></a><span class="c1"># We also modify it to make it prettier</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">10</span></a><span class="k">if</span> <span class="s2">&quot;pdoc&quot;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">11</span></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;README.md&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">12</span></a>        <span class="n">_readme</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">13</span></a>
</span><span id="L-14"><a href="#L-14"><span class="linenos">14</span></a>        <span class="c1"># remove baby logo and header</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">15</span></a>        <span class="n">_readme</span> <span class="o">=</span> <span class="n">_readme</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">16</span></a>
</span><span id="L-17"><a href="#L-17"><span class="linenos">17</span></a>        <span class="c1"># replace teaser image path</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">18</span></a>        <span class="n">_readme</span> <span class="o">=</span> <span class="n">_readme</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;misc/teaser/tiler_teaser.png&quot;</span><span class="p">,</span> <span class="s2">&quot;tiler_teaser.png&quot;</span><span class="p">)</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">19</span></a>        <span class="n">_readme</span> <span class="o">=</span> <span class="n">_readme</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;misc/baby_logo.png&quot;</span><span class="p">,</span> <span class="s2">&quot;baby_logo.png&quot;</span><span class="p">)</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">20</span></a>        <span class="vm">__doc__</span> <span class="o">=</span> <span class="n">_readme</span>
</span></pre></div>


            </section>
                <section id="Tiler">
                            <input id="Tiler-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Tiler</span>:

                <label class="view-source-button" for="Tiler-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Tiler"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Tiler-10"><a href="#Tiler-10"><span class="linenos"> 10</span></a><span class="k">class</span><span class="w"> </span><span class="nc">Tiler</span><span class="p">:</span>
</span><span id="Tiler-11"><a href="#Tiler-11"><span class="linenos"> 11</span></a>    <span class="n">TILING_MODES</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;constant&quot;</span><span class="p">,</span> <span class="s2">&quot;drop&quot;</span><span class="p">,</span> <span class="s2">&quot;irregular&quot;</span><span class="p">,</span> <span class="s2">&quot;reflect&quot;</span><span class="p">,</span> <span class="s2">&quot;edge&quot;</span><span class="p">,</span> <span class="s2">&quot;wrap&quot;</span><span class="p">]</span>
</span><span id="Tiler-12"><a href="#Tiler-12"><span class="linenos"> 12</span></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Tiler-13"><a href="#Tiler-13"><span class="linenos"> 13</span></a><span class="sd">    Supported tiling modes:</span>
</span><span id="Tiler-14"><a href="#Tiler-14"><span class="linenos"> 14</span></a><span class="sd">    - `constant` (default)</span>
</span><span id="Tiler-15"><a href="#Tiler-15"><span class="linenos"> 15</span></a><span class="sd">        If a tile is smaller than `tile_shape`, pad it with the constant value along each axis to match `tile_shape`.</span>
</span><span id="Tiler-16"><a href="#Tiler-16"><span class="linenos"> 16</span></a><span class="sd">        Set the value with the keyword `constant_value`.</span>
</span><span id="Tiler-17"><a href="#Tiler-17"><span class="linenos"> 17</span></a><span class="sd">    - `drop`</span>
</span><span id="Tiler-18"><a href="#Tiler-18"><span class="linenos"> 18</span></a><span class="sd">        If a tile is smaller than `tile_shape` in any of the dimensions, ignore it. Can result in zero tiles.</span>
</span><span id="Tiler-19"><a href="#Tiler-19"><span class="linenos"> 19</span></a><span class="sd">    - `irregular`</span>
</span><span id="Tiler-20"><a href="#Tiler-20"><span class="linenos"> 20</span></a><span class="sd">        Allow tiles to be smaller than `tile_shape`.</span>
</span><span id="Tiler-21"><a href="#Tiler-21"><span class="linenos"> 21</span></a><span class="sd">    - `reflect`</span>
</span><span id="Tiler-22"><a href="#Tiler-22"><span class="linenos"> 22</span></a><span class="sd">        If a tile is smaller than `tile_shape`,</span>
</span><span id="Tiler-23"><a href="#Tiler-23"><span class="linenos"> 23</span></a><span class="sd">        pad it with the reflection of values along each axis to match `tile_shape`.</span>
</span><span id="Tiler-24"><a href="#Tiler-24"><span class="linenos"> 24</span></a><span class="sd">    - `edge`</span>
</span><span id="Tiler-25"><a href="#Tiler-25"><span class="linenos"> 25</span></a><span class="sd">        If a tile is smaller than `tile_shape`,</span>
</span><span id="Tiler-26"><a href="#Tiler-26"><span class="linenos"> 26</span></a><span class="sd">        pad it with the edge values of data along each axis to match `tile_shape`.</span>
</span><span id="Tiler-27"><a href="#Tiler-27"><span class="linenos"> 27</span></a><span class="sd">    - `wrap`</span>
</span><span id="Tiler-28"><a href="#Tiler-28"><span class="linenos"> 28</span></a><span class="sd">        If a tile is smaller than `tile_shape`,</span>
</span><span id="Tiler-29"><a href="#Tiler-29"><span class="linenos"> 29</span></a><span class="sd">        pad it with the wrap of the vector along each axis to match `tile_shape`.</span>
</span><span id="Tiler-30"><a href="#Tiler-30"><span class="linenos"> 30</span></a><span class="sd">        The first values are used to pad the end and the end values are used to pad the beginning.</span>
</span><span id="Tiler-31"><a href="#Tiler-31"><span class="linenos"> 31</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Tiler-32"><a href="#Tiler-32"><span class="linenos"> 32</span></a>
</span><span id="Tiler-33"><a href="#Tiler-33"><span class="linenos"> 33</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="Tiler-34"><a href="#Tiler-34"><span class="linenos"> 34</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Tiler-35"><a href="#Tiler-35"><span class="linenos"> 35</span></a>        <span class="n">data_shape</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
</span><span id="Tiler-36"><a href="#Tiler-36"><span class="linenos"> 36</span></a>        <span class="n">tile_shape</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
</span><span id="Tiler-37"><a href="#Tiler-37"><span class="linenos"> 37</span></a>        <span class="n">overlap</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="Tiler-38"><a href="#Tiler-38"><span class="linenos"> 38</span></a>        <span class="n">channel_dimension</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Tiler-39"><a href="#Tiler-39"><span class="linenos"> 39</span></a>        <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;constant&quot;</span><span class="p">,</span>
</span><span id="Tiler-40"><a href="#Tiler-40"><span class="linenos"> 40</span></a>        <span class="n">constant_value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="Tiler-41"><a href="#Tiler-41"><span class="linenos"> 41</span></a>    <span class="p">):</span>
</span><span id="Tiler-42"><a href="#Tiler-42"><span class="linenos"> 42</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Tiler class precomputes everything for tiling with specified parameters, without actually slicing data.</span>
</span><span id="Tiler-43"><a href="#Tiler-43"><span class="linenos"> 43</span></a><span class="sd">        You can access tiles individually with `Tiler.get_tile()` or with an iterator, both individually and in batches,</span>
</span><span id="Tiler-44"><a href="#Tiler-44"><span class="linenos"> 44</span></a><span class="sd">        with `Tiler.iterate()` (or the alias `Tiler.__call__()`).</span>
</span><span id="Tiler-45"><a href="#Tiler-45"><span class="linenos"> 45</span></a>
</span><span id="Tiler-46"><a href="#Tiler-46"><span class="linenos"> 46</span></a><span class="sd">        Args:</span>
</span><span id="Tiler-47"><a href="#Tiler-47"><span class="linenos"> 47</span></a><span class="sd">            data_shape (tuple, list or np.ndarray): Input data shape.</span>
</span><span id="Tiler-48"><a href="#Tiler-48"><span class="linenos"> 48</span></a><span class="sd">                If there is a channel dimension, it should be included in the shape.</span>
</span><span id="Tiler-49"><a href="#Tiler-49"><span class="linenos"> 49</span></a><span class="sd">                For example, (1920, 1080, 3), [512, 512, 512] or np.ndarray([3, 1024, 768]).</span>
</span><span id="Tiler-50"><a href="#Tiler-50"><span class="linenos"> 50</span></a>
</span><span id="Tiler-51"><a href="#Tiler-51"><span class="linenos"> 51</span></a><span class="sd">            tile_shape (tuple, list or np.ndarray): Shape of a tile.</span>
</span><span id="Tiler-52"><a href="#Tiler-52"><span class="linenos"> 52</span></a><span class="sd">                Tile must have the same number of dimensions as data or less.</span>
</span><span id="Tiler-53"><a href="#Tiler-53"><span class="linenos"> 53</span></a><span class="sd">                If less, the shape will be automatically prepended with ones to match data_shape size.</span>
</span><span id="Tiler-54"><a href="#Tiler-54"><span class="linenos"> 54</span></a><span class="sd">                For example,  (256, 256, 3), [64, 64, 64] or np.ndarray([3, 128, 128]).</span>
</span><span id="Tiler-55"><a href="#Tiler-55"><span class="linenos"> 55</span></a>
</span><span id="Tiler-56"><a href="#Tiler-56"><span class="linenos"> 56</span></a><span class="sd">            overlap (int, float, tuple, list or np.ndarray): Specifies overlap between tiles.</span>
</span><span id="Tiler-57"><a href="#Tiler-57"><span class="linenos"> 57</span></a><span class="sd">                If integer, the same overlap of overlap pixels applied in each dimension, except channel_dimension.</span>
</span><span id="Tiler-58"><a href="#Tiler-58"><span class="linenos"> 58</span></a><span class="sd">                If float, percentage of a tile_shape to overlap [0.0, 1.0), from 0% to 100% non-inclusive, except</span>
</span><span id="Tiler-59"><a href="#Tiler-59"><span class="linenos"> 59</span></a><span class="sd">                channel_dimension.</span>
</span><span id="Tiler-60"><a href="#Tiler-60"><span class="linenos"> 60</span></a><span class="sd">                If tuple, list or np.ndarray, explicit size of the overlap (must be smaller than tile_shape in each</span>
</span><span id="Tiler-61"><a href="#Tiler-61"><span class="linenos"> 61</span></a><span class="sd">                dimension).</span>
</span><span id="Tiler-62"><a href="#Tiler-62"><span class="linenos"> 62</span></a><span class="sd">                Default is `0`.</span>
</span><span id="Tiler-63"><a href="#Tiler-63"><span class="linenos"> 63</span></a>
</span><span id="Tiler-64"><a href="#Tiler-64"><span class="linenos"> 64</span></a><span class="sd">            channel_dimension (int, optional): Specifies which axis is the channel dimension that will not be tiled.</span>
</span><span id="Tiler-65"><a href="#Tiler-65"><span class="linenos"> 65</span></a><span class="sd">                Usually it is the last or the first dimension of the array.</span>
</span><span id="Tiler-66"><a href="#Tiler-66"><span class="linenos"> 66</span></a><span class="sd">                Negative indexing (`-len(data_shape)` to `-1` inclusive) is allowed.</span>
</span><span id="Tiler-67"><a href="#Tiler-67"><span class="linenos"> 67</span></a><span class="sd">                Default is `None`, no channel dimension in the data.</span>
</span><span id="Tiler-68"><a href="#Tiler-68"><span class="linenos"> 68</span></a>
</span><span id="Tiler-69"><a href="#Tiler-69"><span class="linenos"> 69</span></a><span class="sd">            mode (str): Defines how the data will be tiled.</span>
</span><span id="Tiler-70"><a href="#Tiler-70"><span class="linenos"> 70</span></a><span class="sd">                Must be one of the supported `Tiler.TILING_MODES`. Defaults to `&quot;constant&quot;`.</span>
</span><span id="Tiler-71"><a href="#Tiler-71"><span class="linenos"> 71</span></a>
</span><span id="Tiler-72"><a href="#Tiler-72"><span class="linenos"> 72</span></a><span class="sd">            constant_value (float): Specifies the value of padding when `mode=&#39;constant&#39;`.</span>
</span><span id="Tiler-73"><a href="#Tiler-73"><span class="linenos"> 73</span></a><span class="sd">                Default is `0.0`.</span>
</span><span id="Tiler-74"><a href="#Tiler-74"><span class="linenos"> 74</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Tiler-75"><a href="#Tiler-75"><span class="linenos"> 75</span></a>
</span><span id="Tiler-76"><a href="#Tiler-76"><span class="linenos"> 76</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">recalculate</span><span class="p">(</span>
</span><span id="Tiler-77"><a href="#Tiler-77"><span class="linenos"> 77</span></a>            <span class="n">data_shape</span><span class="o">=</span><span class="n">data_shape</span><span class="p">,</span>
</span><span id="Tiler-78"><a href="#Tiler-78"><span class="linenos"> 78</span></a>            <span class="n">tile_shape</span><span class="o">=</span><span class="n">tile_shape</span><span class="p">,</span>
</span><span id="Tiler-79"><a href="#Tiler-79"><span class="linenos"> 79</span></a>            <span class="n">overlap</span><span class="o">=</span><span class="n">overlap</span><span class="p">,</span>
</span><span id="Tiler-80"><a href="#Tiler-80"><span class="linenos"> 80</span></a>            <span class="n">channel_dimension</span><span class="o">=</span><span class="n">channel_dimension</span><span class="p">,</span>
</span><span id="Tiler-81"><a href="#Tiler-81"><span class="linenos"> 81</span></a>            <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
</span><span id="Tiler-82"><a href="#Tiler-82"><span class="linenos"> 82</span></a>            <span class="n">constant_value</span><span class="o">=</span><span class="n">constant_value</span><span class="p">,</span>
</span><span id="Tiler-83"><a href="#Tiler-83"><span class="linenos"> 83</span></a>        <span class="p">)</span>
</span><span id="Tiler-84"><a href="#Tiler-84"><span class="linenos"> 84</span></a>
</span><span id="Tiler-85"><a href="#Tiler-85"><span class="linenos"> 85</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">recalculate</span><span class="p">(</span>
</span><span id="Tiler-86"><a href="#Tiler-86"><span class="linenos"> 86</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Tiler-87"><a href="#Tiler-87"><span class="linenos"> 87</span></a>        <span class="n">data_shape</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Tiler-88"><a href="#Tiler-88"><span class="linenos"> 88</span></a>        <span class="n">tile_shape</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Tiler-89"><a href="#Tiler-89"><span class="linenos"> 89</span></a>        <span class="n">overlap</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Tiler-90"><a href="#Tiler-90"><span class="linenos"> 90</span></a>        <span class="n">channel_dimension</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Tiler-91"><a href="#Tiler-91"><span class="linenos"> 91</span></a>        <span class="n">mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Tiler-92"><a href="#Tiler-92"><span class="linenos"> 92</span></a>        <span class="n">constant_value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Tiler-93"><a href="#Tiler-93"><span class="linenos"> 93</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Tiler-94"><a href="#Tiler-94"><span class="linenos"> 94</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Recalculates tiling for new given settings.</span>
</span><span id="Tiler-95"><a href="#Tiler-95"><span class="linenos"> 95</span></a><span class="sd">        If a passed value is None, use previously given value.</span>
</span><span id="Tiler-96"><a href="#Tiler-96"><span class="linenos"> 96</span></a>
</span><span id="Tiler-97"><a href="#Tiler-97"><span class="linenos"> 97</span></a><span class="sd">        For more information about each argument see `Tiler.__init__()` documentation.</span>
</span><span id="Tiler-98"><a href="#Tiler-98"><span class="linenos"> 98</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Tiler-99"><a href="#Tiler-99"><span class="linenos"> 99</span></a>
</span><span id="Tiler-100"><a href="#Tiler-100"><span class="linenos">100</span></a>        <span class="c1"># Data and tile shapes</span>
</span><span id="Tiler-101"><a href="#Tiler-101"><span class="linenos">101</span></a>        <span class="k">if</span> <span class="n">data_shape</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Tiler-102"><a href="#Tiler-102"><span class="linenos">102</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
</span><span id="Tiler-103"><a href="#Tiler-103"><span class="linenos">103</span></a>        <span class="k">if</span> <span class="n">tile_shape</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Tiler-104"><a href="#Tiler-104"><span class="linenos">104</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tile_shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">tile_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">))</span>
</span><span id="Tiler-105"><a href="#Tiler-105"><span class="linenos">105</span></a>
</span><span id="Tiler-106"><a href="#Tiler-106"><span class="linenos">106</span></a>            <span class="c1"># Append ones to match data_shape size</span>
</span><span id="Tiler-107"><a href="#Tiler-107"><span class="linenos">107</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_shape</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
</span><span id="Tiler-108"><a href="#Tiler-108"><span class="linenos">108</span></a>                <span class="n">size_difference</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_shape</span><span class="o">.</span><span class="n">size</span>
</span><span id="Tiler-109"><a href="#Tiler-109"><span class="linenos">109</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">tile_shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">arr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tile_shape</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">size_difference</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Tiler-110"><a href="#Tiler-110"><span class="linenos">110</span></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="Tiler-111"><a href="#Tiler-111"><span class="linenos">111</span></a>                    <span class="sa">f</span><span class="s2">&quot;Tiler automatically adjusted tile_shape from </span><span class="si">{</span><span class="nb">tuple</span><span class="p">(</span><span class="n">tile_shape</span><span class="p">)</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tile_shape</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span>
</span><span id="Tiler-112"><a href="#Tiler-112"><span class="linenos">112</span></a>                    <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="Tiler-113"><a href="#Tiler-113"><span class="linenos">113</span></a>                <span class="p">)</span>
</span><span id="Tiler-114"><a href="#Tiler-114"><span class="linenos">114</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_n_dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">)</span>
</span><span id="Tiler-115"><a href="#Tiler-115"><span class="linenos">115</span></a>        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tile_shape</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">()</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="Tiler-116"><a href="#Tiler-116"><span class="linenos">116</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Tile and data shapes must be tuple, list or ndarray of positive integers.&quot;</span><span class="p">)</span>
</span><span id="Tiler-117"><a href="#Tiler-117"><span class="linenos">117</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_shape</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
</span><span id="Tiler-118"><a href="#Tiler-118"><span class="linenos">118</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Tiler-119"><a href="#Tiler-119"><span class="linenos">119</span></a>                <span class="s2">&quot;Tile shape must have less or equal number of elements compared to the data shape. &quot;</span>
</span><span id="Tiler-120"><a href="#Tiler-120"><span class="linenos">120</span></a>                <span class="s2">&quot;If less, your tile shape will be prepended with ones to match the data shape, &quot;</span>
</span><span id="Tiler-121"><a href="#Tiler-121"><span class="linenos">121</span></a>                <span class="s2">&quot;e.g. data_shape=(28, 28), tile_shape=(28) -&gt; tile_shape=(1, 28).&quot;</span>
</span><span id="Tiler-122"><a href="#Tiler-122"><span class="linenos">122</span></a>            <span class="p">)</span>
</span><span id="Tiler-123"><a href="#Tiler-123"><span class="linenos">123</span></a>
</span><span id="Tiler-124"><a href="#Tiler-124"><span class="linenos">124</span></a>        <span class="c1"># Tiling mode</span>
</span><span id="Tiler-125"><a href="#Tiler-125"><span class="linenos">125</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Tiler-126"><a href="#Tiler-126"><span class="linenos">126</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span>
</span><span id="Tiler-127"><a href="#Tiler-127"><span class="linenos">127</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">TILING_MODES</span><span class="p">:</span>
</span><span id="Tiler-128"><a href="#Tiler-128"><span class="linenos">128</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="si">}</span><span class="s2"> is an unsupported tiling mode, please check the documentation.&quot;</span><span class="p">)</span>
</span><span id="Tiler-129"><a href="#Tiler-129"><span class="linenos">129</span></a>
</span><span id="Tiler-130"><a href="#Tiler-130"><span class="linenos">130</span></a>        <span class="c1"># Constant value used for constant tiling mode</span>
</span><span id="Tiler-131"><a href="#Tiler-131"><span class="linenos">131</span></a>        <span class="k">if</span> <span class="n">constant_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Tiler-132"><a href="#Tiler-132"><span class="linenos">132</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">constant_value</span> <span class="o">=</span> <span class="n">constant_value</span>
</span><span id="Tiler-133"><a href="#Tiler-133"><span class="linenos">133</span></a>
</span><span id="Tiler-134"><a href="#Tiler-134"><span class="linenos">134</span></a>        <span class="c1"># Channel dimension can be None which means we need to check for init too</span>
</span><span id="Tiler-135"><a href="#Tiler-135"><span class="linenos">135</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;channel_dimension&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">channel_dimension</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Tiler-136"><a href="#Tiler-136"><span class="linenos">136</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">channel_dimension</span> <span class="o">=</span> <span class="n">channel_dimension</span>
</span><span id="Tiler-137"><a href="#Tiler-137"><span class="linenos">137</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel_dimension</span><span class="p">:</span>
</span><span id="Tiler-138"><a href="#Tiler-138"><span class="linenos">138</span></a>            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">channel_dimension</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_dim</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">channel_dimension</span> <span class="o">&lt;</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_dim</span><span class="p">):</span>
</span><span id="Tiler-139"><a href="#Tiler-139"><span class="linenos">139</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Tiler-140"><a href="#Tiler-140"><span class="linenos">140</span></a>                    <span class="sa">f</span><span class="s2">&quot;Specified channel dimension is out of bounds &quot;</span>
</span><span id="Tiler-141"><a href="#Tiler-141"><span class="linenos">141</span></a>                    <span class="sa">f</span><span class="s2">&quot;(should be None or an integer from </span><span class="si">{</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_dim</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_dim</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">).&quot;</span>
</span><span id="Tiler-142"><a href="#Tiler-142"><span class="linenos">142</span></a>                <span class="p">)</span>
</span><span id="Tiler-143"><a href="#Tiler-143"><span class="linenos">143</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel_dimension</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Tiler-144"><a href="#Tiler-144"><span class="linenos">144</span></a>                <span class="c1"># negative indexing</span>
</span><span id="Tiler-145"><a href="#Tiler-145"><span class="linenos">145</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">channel_dimension</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_dim</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel_dimension</span>
</span><span id="Tiler-146"><a href="#Tiler-146"><span class="linenos">146</span></a>
</span><span id="Tiler-147"><a href="#Tiler-147"><span class="linenos">147</span></a>        <span class="c1"># Overlap and step</span>
</span><span id="Tiler-148"><a href="#Tiler-148"><span class="linenos">148</span></a>        <span class="k">if</span> <span class="n">overlap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Tiler-149"><a href="#Tiler-149"><span class="linenos">149</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">overlap</span> <span class="o">=</span> <span class="n">overlap</span>
</span><span id="Tiler-150"><a href="#Tiler-150"><span class="linenos">150</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">overlap</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="Tiler-151"><a href="#Tiler-151"><span class="linenos">151</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlap</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlap</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="Tiler-152"><a href="#Tiler-152"><span class="linenos">152</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Float overlap must be in range of [0.0, 1.0) i.e. [0%, 100%).&quot;</span><span class="p">)</span>
</span><span id="Tiler-153"><a href="#Tiler-153"><span class="linenos">153</span></a>
</span><span id="Tiler-154"><a href="#Tiler-154"><span class="linenos">154</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_tile_overlap</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">overlap</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_shape</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="Tiler-155"><a href="#Tiler-155"><span class="linenos">155</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel_dimension</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Tiler-156"><a href="#Tiler-156"><span class="linenos">156</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_tile_overlap</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">channel_dimension</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Tiler-157"><a href="#Tiler-157"><span class="linenos">157</span></a>
</span><span id="Tiler-158"><a href="#Tiler-158"><span class="linenos">158</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">overlap</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Tiler-159"><a href="#Tiler-159"><span class="linenos">159</span></a>            <span class="n">tile_shape_without_channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_shape</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_dim</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel_dimension</span><span class="p">]</span>
</span><span id="Tiler-160"><a href="#Tiler-160"><span class="linenos">160</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlap</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">overlap</span> <span class="o">&gt;=</span> <span class="n">tile_shape_without_channel</span><span class="p">):</span>
</span><span id="Tiler-161"><a href="#Tiler-161"><span class="linenos">161</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Integer overlap must be in range of 0 to </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">tile_shape_without_channel</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Tiler-162"><a href="#Tiler-162"><span class="linenos">162</span></a>
</span><span id="Tiler-163"><a href="#Tiler-163"><span class="linenos">163</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_tile_overlap</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">overlap</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_shape</span><span class="p">])</span>
</span><span id="Tiler-164"><a href="#Tiler-164"><span class="linenos">164</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel_dimension</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Tiler-165"><a href="#Tiler-165"><span class="linenos">165</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_tile_overlap</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">channel_dimension</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Tiler-166"><a href="#Tiler-166"><span class="linenos">166</span></a>
</span><span id="Tiler-167"><a href="#Tiler-167"><span class="linenos">167</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">overlap</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
</span><span id="Tiler-168"><a href="#Tiler-168"><span class="linenos">168</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">overlap</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">overlap</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_shape</span><span class="p">):</span>
</span><span id="Tiler-169"><a href="#Tiler-169"><span class="linenos">169</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Overlap size must be smaller than tile_shape.&quot;</span><span class="p">)</span>
</span><span id="Tiler-170"><a href="#Tiler-170"><span class="linenos">170</span></a>
</span><span id="Tiler-171"><a href="#Tiler-171"><span class="linenos">171</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_tile_overlap</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">overlap</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="Tiler-172"><a href="#Tiler-172"><span class="linenos">172</span></a>
</span><span id="Tiler-173"><a href="#Tiler-173"><span class="linenos">173</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Tiler-174"><a href="#Tiler-174"><span class="linenos">174</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unsupported overlap mode (not float, int, list, tuple or np.ndarray).&quot;</span><span class="p">)</span>
</span><span id="Tiler-175"><a href="#Tiler-175"><span class="linenos">175</span></a>
</span><span id="Tiler-176"><a href="#Tiler-176"><span class="linenos">176</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_tile_step</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tile_shape</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_overlap</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>  <span class="c1"># tile step</span>
</span><span id="Tiler-177"><a href="#Tiler-177"><span class="linenos">177</span></a>
</span><span id="Tiler-178"><a href="#Tiler-178"><span class="linenos">178</span></a>        <span class="c1"># Calculate mosaic (collection of tiles) shape</span>
</span><span id="Tiler-179"><a href="#Tiler-179"><span class="linenos">179</span></a>        <span class="n">div</span><span class="p">,</span> <span class="n">mod</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divmod</span><span class="p">(</span>
</span><span id="Tiler-180"><a href="#Tiler-180"><span class="linenos">180</span></a>            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_overlap</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_dim</span><span class="p">)],</span>
</span><span id="Tiler-181"><a href="#Tiler-181"><span class="linenos">181</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_tile_step</span><span class="p">,</span>
</span><span id="Tiler-182"><a href="#Tiler-182"><span class="linenos">182</span></a>        <span class="p">)</span>
</span><span id="Tiler-183"><a href="#Tiler-183"><span class="linenos">183</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;drop&quot;</span><span class="p">:</span>
</span><span id="Tiler-184"><a href="#Tiler-184"><span class="linenos">184</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_indexing_shape</span> <span class="o">=</span> <span class="n">div</span>
</span><span id="Tiler-185"><a href="#Tiler-185"><span class="linenos">185</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Tiler-186"><a href="#Tiler-186"><span class="linenos">186</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_indexing_shape</span> <span class="o">=</span> <span class="n">div</span> <span class="o">+</span> <span class="p">(</span><span class="n">mod</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Tiler-187"><a href="#Tiler-187"><span class="linenos">187</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel_dimension</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Tiler-188"><a href="#Tiler-188"><span class="linenos">188</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_indexing_shape</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">channel_dimension</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Tiler-189"><a href="#Tiler-189"><span class="linenos">189</span></a>
</span><span id="Tiler-190"><a href="#Tiler-190"><span class="linenos">190</span></a>        <span class="c1"># Calculate new shape assuming tiles are padded</span>
</span><span id="Tiler-191"><a href="#Tiler-191"><span class="linenos">191</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;irregular&quot;</span><span class="p">:</span>
</span><span id="Tiler-192"><a href="#Tiler-192"><span class="linenos">192</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_new_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span>
</span><span id="Tiler-193"><a href="#Tiler-193"><span class="linenos">193</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Tiler-194"><a href="#Tiler-194"><span class="linenos">194</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_new_shape</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_indexing_shape</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_step</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_overlap</span>
</span><span id="Tiler-195"><a href="#Tiler-195"><span class="linenos">195</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_shape_diff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_shape</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span>
</span><span id="Tiler-196"><a href="#Tiler-196"><span class="linenos">196</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel_dimension</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Tiler-197"><a href="#Tiler-197"><span class="linenos">197</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_shape_diff</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">channel_dimension</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Tiler-198"><a href="#Tiler-198"><span class="linenos">198</span></a>
</span><span id="Tiler-199"><a href="#Tiler-199"><span class="linenos">199</span></a>        <span class="c1"># If channel dimension is given, set tile_step of that dimension to 0</span>
</span><span id="Tiler-200"><a href="#Tiler-200"><span class="linenos">200</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel_dimension</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Tiler-201"><a href="#Tiler-201"><span class="linenos">201</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_tile_step</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">channel_dimension</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Tiler-202"><a href="#Tiler-202"><span class="linenos">202</span></a>
</span><span id="Tiler-203"><a href="#Tiler-203"><span class="linenos">203</span></a>        <span class="c1"># Tile indexing</span>
</span><span id="Tiler-204"><a href="#Tiler-204"><span class="linenos">204</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_tile_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indexing_shape</span><span class="p">],</span> <span class="n">indexing</span><span class="o">=</span><span class="s2">&quot;ij&quot;</span><span class="p">))</span>
</span><span id="Tiler-205"><a href="#Tiler-205"><span class="linenos">205</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_tile_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_index</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_dim</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</span><span id="Tiler-206"><a href="#Tiler-206"><span class="linenos">206</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_tiles</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tile_index</span><span class="p">)</span>
</span><span id="Tiler-207"><a href="#Tiler-207"><span class="linenos">207</span></a>
</span><span id="Tiler-208"><a href="#Tiler-208"><span class="linenos">208</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_tiles</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Tiler-209"><a href="#Tiler-209"><span class="linenos">209</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="Tiler-210"><a href="#Tiler-210"><span class="linenos">210</span></a>                <span class="sa">f</span><span class="s2">&quot;Tiler (mode=</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">, overlap=</span><span class="si">{</span><span class="n">overlap</span><span class="si">}</span><span class="s2">) will split data_shape </span><span class="si">{</span><span class="n">data_shape</span><span class="si">}</span><span class="s2"> &quot;</span>
</span><span id="Tiler-211"><a href="#Tiler-211"><span class="linenos">211</span></a>                <span class="sa">f</span><span class="s2">&quot;into zero tiles (tile_shape=</span><span class="si">{</span><span class="n">tile_shape</span><span class="si">}</span><span class="s2">).&quot;</span><span class="p">,</span>
</span><span id="Tiler-212"><a href="#Tiler-212"><span class="linenos">212</span></a>                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="Tiler-213"><a href="#Tiler-213"><span class="linenos">213</span></a>            <span class="p">)</span>
</span><span id="Tiler-214"><a href="#Tiler-214"><span class="linenos">214</span></a>
</span><span id="Tiler-215"><a href="#Tiler-215"><span class="linenos">215</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Tiler-216"><a href="#Tiler-216"><span class="linenos">216</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Tiler-217"><a href="#Tiler-217"><span class="linenos">217</span></a><span class="sd">        Returns:</span>
</span><span id="Tiler-218"><a href="#Tiler-218"><span class="linenos">218</span></a><span class="sd">             int: Number of tiles in the mosaic.</span>
</span><span id="Tiler-219"><a href="#Tiler-219"><span class="linenos">219</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Tiler-220"><a href="#Tiler-220"><span class="linenos">220</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_tiles</span>
</span><span id="Tiler-221"><a href="#Tiler-221"><span class="linenos">221</span></a>
</span><span id="Tiler-222"><a href="#Tiler-222"><span class="linenos">222</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Tiler-223"><a href="#Tiler-223"><span class="linenos">223</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Tiler-224"><a href="#Tiler-224"><span class="linenos">224</span></a><span class="sd">        Returns:</span>
</span><span id="Tiler-225"><a href="#Tiler-225"><span class="linenos">225</span></a><span class="sd">            str: String representation of the object.</span>
</span><span id="Tiler-226"><a href="#Tiler-226"><span class="linenos">226</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Tiler-227"><a href="#Tiler-227"><span class="linenos">227</span></a>        <span class="k">return</span> <span class="p">(</span>
</span><span id="Tiler-228"><a href="#Tiler-228"><span class="linenos">228</span></a>            <span class="sa">f</span><span class="s2">&quot;Tiler split </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="si">}</span><span class="s2"> data into </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2"> tiles of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tile_shape</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="Tiler-229"><a href="#Tiler-229"><span class="linenos">229</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">Mosaic shape: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_indexing_shape</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Tiler-230"><a href="#Tiler-230"><span class="linenos">230</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">Padded shape: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_new_shape</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Tiler-231"><a href="#Tiler-231"><span class="linenos">231</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">Tile overlap: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">overlap</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Tiler-232"><a href="#Tiler-232"><span class="linenos">232</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">Element step: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_tile_step</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Tiler-233"><a href="#Tiler-233"><span class="linenos">233</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">Mode: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Tiler-234"><a href="#Tiler-234"><span class="linenos">234</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">Channel dimension: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">channel_dimension</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Tiler-235"><a href="#Tiler-235"><span class="linenos">235</span></a>        <span class="p">)</span>
</span><span id="Tiler-236"><a href="#Tiler-236"><span class="linenos">236</span></a>
</span><span id="Tiler-237"><a href="#Tiler-237"><span class="linenos">237</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span>
</span><span id="Tiler-238"><a href="#Tiler-238"><span class="linenos">238</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Tiler-239"><a href="#Tiler-239"><span class="linenos">239</span></a>        <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]],</span>
</span><span id="Tiler-240"><a href="#Tiler-240"><span class="linenos">240</span></a>        <span class="n">progress_bar</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Tiler-241"><a href="#Tiler-241"><span class="linenos">241</span></a>        <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="Tiler-242"><a href="#Tiler-242"><span class="linenos">242</span></a>        <span class="n">drop_last</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Tiler-243"><a href="#Tiler-243"><span class="linenos">243</span></a>        <span class="n">copy_data</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Tiler-244"><a href="#Tiler-244"><span class="linenos">244</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
</span><span id="Tiler-245"><a href="#Tiler-245"><span class="linenos">245</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Alias for `Tiler.iterate()`&quot;&quot;&quot;</span>
</span><span id="Tiler-246"><a href="#Tiler-246"><span class="linenos">246</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterate</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">progress_bar</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">drop_last</span><span class="p">,</span> <span class="n">copy_data</span><span class="p">)</span>
</span><span id="Tiler-247"><a href="#Tiler-247"><span class="linenos">247</span></a>
</span><span id="Tiler-248"><a href="#Tiler-248"><span class="linenos">248</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">iterate</span><span class="p">(</span>
</span><span id="Tiler-249"><a href="#Tiler-249"><span class="linenos">249</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Tiler-250"><a href="#Tiler-250"><span class="linenos">250</span></a>        <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]],</span>
</span><span id="Tiler-251"><a href="#Tiler-251"><span class="linenos">251</span></a>        <span class="n">progress_bar</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Tiler-252"><a href="#Tiler-252"><span class="linenos">252</span></a>        <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="Tiler-253"><a href="#Tiler-253"><span class="linenos">253</span></a>        <span class="n">drop_last</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Tiler-254"><a href="#Tiler-254"><span class="linenos">254</span></a>        <span class="n">copy_data</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Tiler-255"><a href="#Tiler-255"><span class="linenos">255</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
</span><span id="Tiler-256"><a href="#Tiler-256"><span class="linenos">256</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Iterates through tiles of the given data array. This method can also be accessed by `Tiler.__call__()`.</span>
</span><span id="Tiler-257"><a href="#Tiler-257"><span class="linenos">257</span></a>
</span><span id="Tiler-258"><a href="#Tiler-258"><span class="linenos">258</span></a><span class="sd">        Args:</span>
</span><span id="Tiler-259"><a href="#Tiler-259"><span class="linenos">259</span></a><span class="sd">            data (np.ndarray or callable): The data array on which the tiling will be performed. A callable can be</span>
</span><span id="Tiler-260"><a href="#Tiler-260"><span class="linenos">260</span></a><span class="sd">                supplied to load data into memory instead of slicing from an array. The callable should take integers</span>
</span><span id="Tiler-261"><a href="#Tiler-261"><span class="linenos">261</span></a><span class="sd">                as input, the smallest tile corner coordinates and tile size in each dimension, and output numpy array.</span>
</span><span id="Tiler-262"><a href="#Tiler-262"><span class="linenos">262</span></a>
</span><span id="Tiler-263"><a href="#Tiler-263"><span class="linenos">263</span></a><span class="sd">                e.g.</span>
</span><span id="Tiler-264"><a href="#Tiler-264"><span class="linenos">264</span></a><span class="sd">                *python-bioformats*</span>
</span><span id="Tiler-265"><a href="#Tiler-265"><span class="linenos">265</span></a><span class="sd">                ```python</span>
</span><span id="Tiler-266"><a href="#Tiler-266"><span class="linenos">266</span></a><span class="sd">                &gt;&gt;&gt; tileSize = 2000</span>
</span><span id="Tiler-267"><a href="#Tiler-267"><span class="linenos">267</span></a><span class="sd">                &gt;&gt;&gt; tiler = Tiler((sizeX, sizeY, sizeC), (tileSize, tileSize, sizeC))</span>
</span><span id="Tiler-268"><a href="#Tiler-268"><span class="linenos">268</span></a><span class="sd">                &gt;&gt;&gt; def reader_func(*args):</span>
</span><span id="Tiler-269"><a href="#Tiler-269"><span class="linenos">269</span></a><span class="sd">                &gt;&gt;&gt;     X, Y, W, H = args[0], args[1], args[3], args[4]</span>
</span><span id="Tiler-270"><a href="#Tiler-270"><span class="linenos">270</span></a><span class="sd">                &gt;&gt;&gt;     return reader.read(XYWH=[X, Y, W, H])</span>
</span><span id="Tiler-271"><a href="#Tiler-271"><span class="linenos">271</span></a><span class="sd">                &gt;&gt;&gt; for t_id, tile in tiler.iterate(reader_func):</span>
</span><span id="Tiler-272"><a href="#Tiler-272"><span class="linenos">272</span></a><span class="sd">                &gt;&gt;&gt;     pass</span>
</span><span id="Tiler-273"><a href="#Tiler-273"><span class="linenos">273</span></a><span class="sd">                ```</span>
</span><span id="Tiler-274"><a href="#Tiler-274"><span class="linenos">274</span></a><span class="sd">                *open-slide*</span>
</span><span id="Tiler-275"><a href="#Tiler-275"><span class="linenos">275</span></a><span class="sd">                ```python</span>
</span><span id="Tiler-276"><a href="#Tiler-276"><span class="linenos">276</span></a><span class="sd">                &gt;&gt;&gt; reader_func = lambda *args: wsi.read_region([args[0], args[1]], 0, [args[3], args[4]])</span>
</span><span id="Tiler-277"><a href="#Tiler-277"><span class="linenos">277</span></a><span class="sd">                &gt;&gt;&gt; for t_id, tile in tiler.iterate(reader_func):</span>
</span><span id="Tiler-278"><a href="#Tiler-278"><span class="linenos">278</span></a><span class="sd">                &gt;&gt;&gt;     pass</span>
</span><span id="Tiler-279"><a href="#Tiler-279"><span class="linenos">279</span></a><span class="sd">                ```</span>
</span><span id="Tiler-280"><a href="#Tiler-280"><span class="linenos">280</span></a>
</span><span id="Tiler-281"><a href="#Tiler-281"><span class="linenos">281</span></a><span class="sd">            progress_bar (bool): Specifies whether to show the progress bar or not.</span>
</span><span id="Tiler-282"><a href="#Tiler-282"><span class="linenos">282</span></a><span class="sd">                Uses `tqdm` package.</span>
</span><span id="Tiler-283"><a href="#Tiler-283"><span class="linenos">283</span></a><span class="sd">                Default is `False`.</span>
</span><span id="Tiler-284"><a href="#Tiler-284"><span class="linenos">284</span></a>
</span><span id="Tiler-285"><a href="#Tiler-285"><span class="linenos">285</span></a><span class="sd">            batch_size (int): Specifies returned batch size.</span>
</span><span id="Tiler-286"><a href="#Tiler-286"><span class="linenos">286</span></a><span class="sd">                If `batch_size == 0`, return one tile at a time.</span>
</span><span id="Tiler-287"><a href="#Tiler-287"><span class="linenos">287</span></a><span class="sd">                If `batch_size &gt;= 1`, return in batches (returned shape: `[batch_size, *tile_shape]`).</span>
</span><span id="Tiler-288"><a href="#Tiler-288"><span class="linenos">288</span></a><span class="sd">                Default is 0.</span>
</span><span id="Tiler-289"><a href="#Tiler-289"><span class="linenos">289</span></a>
</span><span id="Tiler-290"><a href="#Tiler-290"><span class="linenos">290</span></a><span class="sd">            drop_last (bool): Specifies whether to drop last non-full batch.</span>
</span><span id="Tiler-291"><a href="#Tiler-291"><span class="linenos">291</span></a><span class="sd">                Used only when batch_size &gt; 0.</span>
</span><span id="Tiler-292"><a href="#Tiler-292"><span class="linenos">292</span></a><span class="sd">                Default is False.</span>
</span><span id="Tiler-293"><a href="#Tiler-293"><span class="linenos">293</span></a>
</span><span id="Tiler-294"><a href="#Tiler-294"><span class="linenos">294</span></a><span class="sd">            copy_data (bool): Specifies whether to copy the tile before returning it.</span>
</span><span id="Tiler-295"><a href="#Tiler-295"><span class="linenos">295</span></a><span class="sd">                If `copy_data == False`, returns a view.</span>
</span><span id="Tiler-296"><a href="#Tiler-296"><span class="linenos">296</span></a><span class="sd">                Default is True.</span>
</span><span id="Tiler-297"><a href="#Tiler-297"><span class="linenos">297</span></a>
</span><span id="Tiler-298"><a href="#Tiler-298"><span class="linenos">298</span></a><span class="sd">        Yields:</span>
</span><span id="Tiler-299"><a href="#Tiler-299"><span class="linenos">299</span></a><span class="sd">            (int, np.ndarray): Tuple with integer tile number and array tile data.</span>
</span><span id="Tiler-300"><a href="#Tiler-300"><span class="linenos">300</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Tiler-301"><a href="#Tiler-301"><span class="linenos">301</span></a>
</span><span id="Tiler-302"><a href="#Tiler-302"><span class="linenos">302</span></a>        <span class="k">if</span> <span class="n">batch_size</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Tiler-303"><a href="#Tiler-303"><span class="linenos">303</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Batch size must &gt;= 0, not </span><span class="si">{</span><span class="n">batch_size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Tiler-304"><a href="#Tiler-304"><span class="linenos">304</span></a>
</span><span id="Tiler-305"><a href="#Tiler-305"><span class="linenos">305</span></a>        <span class="c1"># return a tile at a time</span>
</span><span id="Tiler-306"><a href="#Tiler-306"><span class="linenos">306</span></a>        <span class="k">if</span> <span class="n">batch_size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Tiler-307"><a href="#Tiler-307"><span class="linenos">307</span></a>            <span class="k">for</span> <span class="n">tile_i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_tiles</span><span class="p">),</span> <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="n">progress_bar</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot; tiles&quot;</span><span class="p">):</span>
</span><span id="Tiler-308"><a href="#Tiler-308"><span class="linenos">308</span></a>                <span class="k">yield</span> <span class="n">tile_i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">tile_i</span><span class="p">,</span> <span class="n">copy_data</span><span class="o">=</span><span class="n">copy_data</span><span class="p">)</span>
</span><span id="Tiler-309"><a href="#Tiler-309"><span class="linenos">309</span></a>
</span><span id="Tiler-310"><a href="#Tiler-310"><span class="linenos">310</span></a>        <span class="c1"># return in batches</span>
</span><span id="Tiler-311"><a href="#Tiler-311"><span class="linenos">311</span></a>        <span class="k">if</span> <span class="n">batch_size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Tiler-312"><a href="#Tiler-312"><span class="linenos">312</span></a>            <span class="c1"># check for drop_last</span>
</span><span id="Tiler-313"><a href="#Tiler-313"><span class="linenos">313</span></a>            <span class="n">length</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_tiles</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_tiles</span> <span class="o">%</span> <span class="n">batch_size</span><span class="p">))</span> <span class="k">if</span> <span class="n">drop_last</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_tiles</span>
</span><span id="Tiler-314"><a href="#Tiler-314"><span class="linenos">314</span></a>
</span><span id="Tiler-315"><a href="#Tiler-315"><span class="linenos">315</span></a>            <span class="k">for</span> <span class="n">tile_i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">),</span> <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="n">progress_bar</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot; batches&quot;</span><span class="p">):</span>
</span><span id="Tiler-316"><a href="#Tiler-316"><span class="linenos">316</span></a>                <span class="n">tiles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span>
</span><span id="Tiler-317"><a href="#Tiler-317"><span class="linenos">317</span></a>                    <span class="p">[</span>
</span><span id="Tiler-318"><a href="#Tiler-318"><span class="linenos">318</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">get_tile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">copy_data</span><span class="o">=</span><span class="n">copy_data</span><span class="p">)</span>
</span><span id="Tiler-319"><a href="#Tiler-319"><span class="linenos">319</span></a>                        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">tile_i</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">tile_i</span> <span class="o">+</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">length</span><span class="p">))</span>
</span><span id="Tiler-320"><a href="#Tiler-320"><span class="linenos">320</span></a>                    <span class="p">]</span>
</span><span id="Tiler-321"><a href="#Tiler-321"><span class="linenos">321</span></a>                <span class="p">)</span>
</span><span id="Tiler-322"><a href="#Tiler-322"><span class="linenos">322</span></a>                <span class="k">yield</span> <span class="n">tile_i</span> <span class="o">//</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">tiles</span>
</span><span id="Tiler-323"><a href="#Tiler-323"><span class="linenos">323</span></a>
</span><span id="Tiler-324"><a href="#Tiler-324"><span class="linenos">324</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_tile</span><span class="p">(</span>
</span><span id="Tiler-325"><a href="#Tiler-325"><span class="linenos">325</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Tiler-326"><a href="#Tiler-326"><span class="linenos">326</span></a>        <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]],</span>
</span><span id="Tiler-327"><a href="#Tiler-327"><span class="linenos">327</span></a>        <span class="n">tile_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="Tiler-328"><a href="#Tiler-328"><span class="linenos">328</span></a>        <span class="n">copy_data</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Tiler-329"><a href="#Tiler-329"><span class="linenos">329</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="Tiler-330"><a href="#Tiler-330"><span class="linenos">330</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns an individual tile.</span>
</span><span id="Tiler-331"><a href="#Tiler-331"><span class="linenos">331</span></a>
</span><span id="Tiler-332"><a href="#Tiler-332"><span class="linenos">332</span></a><span class="sd">        Args:</span>
</span><span id="Tiler-333"><a href="#Tiler-333"><span class="linenos">333</span></a><span class="sd">            data (np.ndarray or callable): Data from which `tile_id`-th tile will be taken. A callable can be</span>
</span><span id="Tiler-334"><a href="#Tiler-334"><span class="linenos">334</span></a><span class="sd">                supplied to load data into memory instead of slicing from an array. The callable should take integers</span>
</span><span id="Tiler-335"><a href="#Tiler-335"><span class="linenos">335</span></a><span class="sd">                as input, the smallest tile corner coordinates and tile size in each dimension, and output numpy array.</span>
</span><span id="Tiler-336"><a href="#Tiler-336"><span class="linenos">336</span></a>
</span><span id="Tiler-337"><a href="#Tiler-337"><span class="linenos">337</span></a><span class="sd">                e.g.</span>
</span><span id="Tiler-338"><a href="#Tiler-338"><span class="linenos">338</span></a><span class="sd">                *python-bioformats*</span>
</span><span id="Tiler-339"><a href="#Tiler-339"><span class="linenos">339</span></a><span class="sd">                ```python</span>
</span><span id="Tiler-340"><a href="#Tiler-340"><span class="linenos">340</span></a><span class="sd">                &gt;&gt;&gt; tileSize = 2000</span>
</span><span id="Tiler-341"><a href="#Tiler-341"><span class="linenos">341</span></a><span class="sd">                &gt;&gt;&gt; tiler = Tiler((sizeX, sizeY, sizeC), (tileSize, tileSize, sizeC))</span>
</span><span id="Tiler-342"><a href="#Tiler-342"><span class="linenos">342</span></a><span class="sd">                &gt;&gt;&gt; def reader_func(*args):</span>
</span><span id="Tiler-343"><a href="#Tiler-343"><span class="linenos">343</span></a><span class="sd">                &gt;&gt;&gt;     X, Y, W, H = args[0], args[1], args[3], args[4]</span>
</span><span id="Tiler-344"><a href="#Tiler-344"><span class="linenos">344</span></a><span class="sd">                &gt;&gt;&gt;     return reader.read(XYWH=[X, Y, W, H])</span>
</span><span id="Tiler-345"><a href="#Tiler-345"><span class="linenos">345</span></a><span class="sd">                &gt;&gt;&gt; tiler.get_tile(reader_func, 0)</span>
</span><span id="Tiler-346"><a href="#Tiler-346"><span class="linenos">346</span></a><span class="sd">                ```</span>
</span><span id="Tiler-347"><a href="#Tiler-347"><span class="linenos">347</span></a><span class="sd">                *open-slide*</span>
</span><span id="Tiler-348"><a href="#Tiler-348"><span class="linenos">348</span></a><span class="sd">                ```python</span>
</span><span id="Tiler-349"><a href="#Tiler-349"><span class="linenos">349</span></a><span class="sd">                &gt;&gt;&gt; reader_func = lambda *args: wsi.read_region([args[0], args[1]], 0, [args[3], args[4]])</span>
</span><span id="Tiler-350"><a href="#Tiler-350"><span class="linenos">350</span></a><span class="sd">                &gt;&gt;&gt; tiler.get_tile(reader_func, 0)</span>
</span><span id="Tiler-351"><a href="#Tiler-351"><span class="linenos">351</span></a><span class="sd">                ```</span>
</span><span id="Tiler-352"><a href="#Tiler-352"><span class="linenos">352</span></a>
</span><span id="Tiler-353"><a href="#Tiler-353"><span class="linenos">353</span></a><span class="sd">            tile_id (int): Specifies which tile to return. Must be smaller than the total number of tiles.</span>
</span><span id="Tiler-354"><a href="#Tiler-354"><span class="linenos">354</span></a>
</span><span id="Tiler-355"><a href="#Tiler-355"><span class="linenos">355</span></a><span class="sd">            copy_data (bool): Specifies whether returned tile is a copy.</span>
</span><span id="Tiler-356"><a href="#Tiler-356"><span class="linenos">356</span></a><span class="sd">                If `copy_data == False` returns a view.</span>
</span><span id="Tiler-357"><a href="#Tiler-357"><span class="linenos">357</span></a><span class="sd">                Default is True.</span>
</span><span id="Tiler-358"><a href="#Tiler-358"><span class="linenos">358</span></a>
</span><span id="Tiler-359"><a href="#Tiler-359"><span class="linenos">359</span></a><span class="sd">        Returns:</span>
</span><span id="Tiler-360"><a href="#Tiler-360"><span class="linenos">360</span></a><span class="sd">            np.ndarray: Content of tile number `tile_id`, padded if necessary.</span>
</span><span id="Tiler-361"><a href="#Tiler-361"><span class="linenos">361</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Tiler-362"><a href="#Tiler-362"><span class="linenos">362</span></a>
</span><span id="Tiler-363"><a href="#Tiler-363"><span class="linenos">363</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">tile_id</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">tile_id</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_tiles</span><span class="p">):</span>
</span><span id="Tiler-364"><a href="#Tiler-364"><span class="linenos">364</span></a>            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span>
</span><span id="Tiler-365"><a href="#Tiler-365"><span class="linenos">365</span></a>                <span class="sa">f</span><span class="s2">&quot;Out of bounds, there is no tile </span><span class="si">{</span><span class="n">tile_id</span><span class="si">}</span><span class="s2">.There are </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> tiles, starting from index 0.&quot;</span>
</span><span id="Tiler-366"><a href="#Tiler-366"><span class="linenos">366</span></a>            <span class="p">)</span>
</span><span id="Tiler-367"><a href="#Tiler-367"><span class="linenos">367</span></a>
</span><span id="Tiler-368"><a href="#Tiler-368"><span class="linenos">368</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">not_equal</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="Tiler-369"><a href="#Tiler-369"><span class="linenos">369</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Tiler-370"><a href="#Tiler-370"><span class="linenos">370</span></a>                <span class="sa">f</span><span class="s2">&quot;Shape of provided data array (</span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">) does not match &quot;</span>
</span><span id="Tiler-371"><a href="#Tiler-371"><span class="linenos">371</span></a>                <span class="sa">f</span><span class="s2">&quot;same as Tiler&#39;s data_shape (</span><span class="si">{</span><span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">)</span><span class="si">}</span><span class="s2">).&quot;</span>
</span><span id="Tiler-372"><a href="#Tiler-372"><span class="linenos">372</span></a>            <span class="p">)</span>
</span><span id="Tiler-373"><a href="#Tiler-373"><span class="linenos">373</span></a>
</span><span id="Tiler-374"><a href="#Tiler-374"><span class="linenos">374</span></a>        <span class="c1"># get tile data</span>
</span><span id="Tiler-375"><a href="#Tiler-375"><span class="linenos">375</span></a>        <span class="n">tile_corner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_index</span><span class="p">[</span><span class="n">tile_id</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_step</span>
</span><span id="Tiler-376"><a href="#Tiler-376"><span class="linenos">376</span></a>        <span class="c1"># take the lesser of the tile shape and the distance to the edge</span>
</span><span id="Tiler-377"><a href="#Tiler-377"><span class="linenos">377</span></a>        <span class="n">sampling</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Tiler-378"><a href="#Tiler-378"><span class="linenos">378</span></a>            <span class="nb">slice</span><span class="p">(</span>
</span><span id="Tiler-379"><a href="#Tiler-379"><span class="linenos">379</span></a>                <span class="n">tile_corner</span><span class="p">[</span><span class="n">d</span><span class="p">],</span>
</span><span id="Tiler-380"><a href="#Tiler-380"><span class="linenos">380</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="n">tile_corner</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_shape</span><span class="p">[</span><span class="n">d</span><span class="p">]]),</span>
</span><span id="Tiler-381"><a href="#Tiler-381"><span class="linenos">381</span></a>            <span class="p">)</span>
</span><span id="Tiler-382"><a href="#Tiler-382"><span class="linenos">382</span></a>            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_dim</span><span class="p">)</span>
</span><span id="Tiler-383"><a href="#Tiler-383"><span class="linenos">383</span></a>        <span class="p">]</span>
</span><span id="Tiler-384"><a href="#Tiler-384"><span class="linenos">384</span></a>
</span><span id="Tiler-385"><a href="#Tiler-385"><span class="linenos">385</span></a>        <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span><span id="Tiler-386"><a href="#Tiler-386"><span class="linenos">386</span></a>            <span class="n">sampling</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">stop</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">start</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sampling</span><span class="p">]</span>
</span><span id="Tiler-387"><a href="#Tiler-387"><span class="linenos">387</span></a>            <span class="n">tile_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">(</span><span class="o">*</span><span class="n">tile_corner</span><span class="p">,</span> <span class="o">*</span><span class="n">sampling</span><span class="p">)</span>
</span><span id="Tiler-388"><a href="#Tiler-388"><span class="linenos">388</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Tiler-389"><a href="#Tiler-389"><span class="linenos">389</span></a>            <span class="n">tile_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">sampling</span><span class="p">)]</span>
</span><span id="Tiler-390"><a href="#Tiler-390"><span class="linenos">390</span></a>
</span><span id="Tiler-391"><a href="#Tiler-391"><span class="linenos">391</span></a>        <span class="k">if</span> <span class="n">copy_data</span><span class="p">:</span>
</span><span id="Tiler-392"><a href="#Tiler-392"><span class="linenos">392</span></a>            <span class="n">tile_data</span> <span class="o">=</span> <span class="n">tile_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Tiler-393"><a href="#Tiler-393"><span class="linenos">393</span></a>
</span><span id="Tiler-394"><a href="#Tiler-394"><span class="linenos">394</span></a>        <span class="n">shape_diff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_shape</span> <span class="o">-</span> <span class="n">tile_data</span><span class="o">.</span><span class="n">shape</span>
</span><span id="Tiler-395"><a href="#Tiler-395"><span class="linenos">395</span></a>        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">!=</span> <span class="s2">&quot;irregular&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">shape_diff</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="Tiler-396"><a href="#Tiler-396"><span class="linenos">396</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;constant&quot;</span><span class="p">:</span>
</span><span id="Tiler-397"><a href="#Tiler-397"><span class="linenos">397</span></a>                <span class="n">tile_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span>
</span><span id="Tiler-398"><a href="#Tiler-398"><span class="linenos">398</span></a>                    <span class="n">tile_data</span><span class="p">,</span>
</span><span id="Tiler-399"><a href="#Tiler-399"><span class="linenos">399</span></a>                    <span class="nb">list</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">diff</span><span class="p">)</span> <span class="k">for</span> <span class="n">diff</span> <span class="ow">in</span> <span class="n">shape_diff</span><span class="p">),</span>
</span><span id="Tiler-400"><a href="#Tiler-400"><span class="linenos">400</span></a>                    <span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span>
</span><span id="Tiler-401"><a href="#Tiler-401"><span class="linenos">401</span></a>                    <span class="n">constant_values</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">constant_value</span><span class="p">,</span>
</span><span id="Tiler-402"><a href="#Tiler-402"><span class="linenos">402</span></a>                <span class="p">)</span>
</span><span id="Tiler-403"><a href="#Tiler-403"><span class="linenos">403</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;reflect&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;edge&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;wrap&quot;</span><span class="p">:</span>
</span><span id="Tiler-404"><a href="#Tiler-404"><span class="linenos">404</span></a>                <span class="n">tile_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">tile_data</span><span class="p">,</span> <span class="nb">list</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">diff</span><span class="p">)</span> <span class="k">for</span> <span class="n">diff</span> <span class="ow">in</span> <span class="n">shape_diff</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
</span><span id="Tiler-405"><a href="#Tiler-405"><span class="linenos">405</span></a>
</span><span id="Tiler-406"><a href="#Tiler-406"><span class="linenos">406</span></a>        <span class="k">return</span> <span class="n">tile_data</span>
</span><span id="Tiler-407"><a href="#Tiler-407"><span class="linenos">407</span></a>
</span><span id="Tiler-408"><a href="#Tiler-408"><span class="linenos">408</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_all_tiles</span><span class="p">(</span>
</span><span id="Tiler-409"><a href="#Tiler-409"><span class="linenos">409</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Tiler-410"><a href="#Tiler-410"><span class="linenos">410</span></a>        <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]],</span>
</span><span id="Tiler-411"><a href="#Tiler-411"><span class="linenos">411</span></a>        <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="Tiler-412"><a href="#Tiler-412"><span class="linenos">412</span></a>        <span class="n">copy_data</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Tiler-413"><a href="#Tiler-413"><span class="linenos">413</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="Tiler-414"><a href="#Tiler-414"><span class="linenos">414</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns all tiles joined along a new axis. Does not work for `Tiler.mode = &#39;irregular&#39;`.</span>
</span><span id="Tiler-415"><a href="#Tiler-415"><span class="linenos">415</span></a>
</span><span id="Tiler-416"><a href="#Tiler-416"><span class="linenos">416</span></a><span class="sd">        The `axis` parameter specifies the index of the new axis in the dimensions of the result.</span>
</span><span id="Tiler-417"><a href="#Tiler-417"><span class="linenos">417</span></a><span class="sd">        For example, if `axis=0` it will be the first dimension and if `axis=-1` it will be the last dimension.</span>
</span><span id="Tiler-418"><a href="#Tiler-418"><span class="linenos">418</span></a>
</span><span id="Tiler-419"><a href="#Tiler-419"><span class="linenos">419</span></a><span class="sd">        For more information about `data` and `copy_data` parameters, see `Tiler.get_tile()`.</span>
</span><span id="Tiler-420"><a href="#Tiler-420"><span class="linenos">420</span></a>
</span><span id="Tiler-421"><a href="#Tiler-421"><span class="linenos">421</span></a><span class="sd">        Args:</span>
</span><span id="Tiler-422"><a href="#Tiler-422"><span class="linenos">422</span></a><span class="sd">            data (np.ndarray or callable): Data which will be tiled. A callable can be supplied to load data into memory</span>
</span><span id="Tiler-423"><a href="#Tiler-423"><span class="linenos">423</span></a><span class="sd">                instead of slicing from an array. The callable should take integers as input, the smallest tile corner</span>
</span><span id="Tiler-424"><a href="#Tiler-424"><span class="linenos">424</span></a><span class="sd">                coordinates and tile size in each dimension, and output numpy array.</span>
</span><span id="Tiler-425"><a href="#Tiler-425"><span class="linenos">425</span></a>
</span><span id="Tiler-426"><a href="#Tiler-426"><span class="linenos">426</span></a><span class="sd">            axis (int): The axis in the result array along which the tiles are stacked.</span>
</span><span id="Tiler-427"><a href="#Tiler-427"><span class="linenos">427</span></a>
</span><span id="Tiler-428"><a href="#Tiler-428"><span class="linenos">428</span></a><span class="sd">            copy_data (bool): Specifies whether returned tile is a copy.</span>
</span><span id="Tiler-429"><a href="#Tiler-429"><span class="linenos">429</span></a><span class="sd">                If `copy_data == False` returns a view.</span>
</span><span id="Tiler-430"><a href="#Tiler-430"><span class="linenos">430</span></a><span class="sd">                Default is True.</span>
</span><span id="Tiler-431"><a href="#Tiler-431"><span class="linenos">431</span></a>
</span><span id="Tiler-432"><a href="#Tiler-432"><span class="linenos">432</span></a><span class="sd">        Returns:</span>
</span><span id="Tiler-433"><a href="#Tiler-433"><span class="linenos">433</span></a><span class="sd">            np.ndarray: All tiles stacked along a new axis.</span>
</span><span id="Tiler-434"><a href="#Tiler-434"><span class="linenos">434</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Tiler-435"><a href="#Tiler-435"><span class="linenos">435</span></a>
</span><span id="Tiler-436"><a href="#Tiler-436"><span class="linenos">436</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;irregular&quot;</span><span class="p">:</span>
</span><span id="Tiler-437"><a href="#Tiler-437"><span class="linenos">437</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;get_all_tiles does not support irregular mode&quot;</span><span class="p">)</span>
</span><span id="Tiler-438"><a href="#Tiler-438"><span class="linenos">438</span></a>
</span><span id="Tiler-439"><a href="#Tiler-439"><span class="linenos">439</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span>
</span><span id="Tiler-440"><a href="#Tiler-440"><span class="linenos">440</span></a>            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_tile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">copy_data</span><span class="o">=</span><span class="n">copy_data</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_tiles</span><span class="p">)],</span>
</span><span id="Tiler-441"><a href="#Tiler-441"><span class="linenos">441</span></a>            <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span>
</span><span id="Tiler-442"><a href="#Tiler-442"><span class="linenos">442</span></a>        <span class="p">)</span>
</span><span id="Tiler-443"><a href="#Tiler-443"><span class="linenos">443</span></a>
</span><span id="Tiler-444"><a href="#Tiler-444"><span class="linenos">444</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_tile_bbox</span><span class="p">(</span>
</span><span id="Tiler-445"><a href="#Tiler-445"><span class="linenos">445</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Tiler-446"><a href="#Tiler-446"><span class="linenos">446</span></a>        <span class="n">tile_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="Tiler-447"><a href="#Tiler-447"><span class="linenos">447</span></a>        <span class="n">with_channel_dim</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Tiler-448"><a href="#Tiler-448"><span class="linenos">448</span></a>        <span class="n">all_corners</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Tiler-449"><a href="#Tiler-449"><span class="linenos">449</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
</span><span id="Tiler-450"><a href="#Tiler-450"><span class="linenos">450</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns coordinates of the opposite corners of the bounding box (hyperrectangle?) of the tile on padded data.</span>
</span><span id="Tiler-451"><a href="#Tiler-451"><span class="linenos">451</span></a>
</span><span id="Tiler-452"><a href="#Tiler-452"><span class="linenos">452</span></a><span class="sd">        Args:</span>
</span><span id="Tiler-453"><a href="#Tiler-453"><span class="linenos">453</span></a><span class="sd">            tile_id (int): Specifies which tile&#39;s bounding coordinates will be returned.</span>
</span><span id="Tiler-454"><a href="#Tiler-454"><span class="linenos">454</span></a><span class="sd">                Must be between 0 and the total number of tiles.</span>
</span><span id="Tiler-455"><a href="#Tiler-455"><span class="linenos">455</span></a>
</span><span id="Tiler-456"><a href="#Tiler-456"><span class="linenos">456</span></a><span class="sd">            with_channel_dim (bool): Specifies whether to return shape with channel dimension or without.</span>
</span><span id="Tiler-457"><a href="#Tiler-457"><span class="linenos">457</span></a><span class="sd">                Default is False.</span>
</span><span id="Tiler-458"><a href="#Tiler-458"><span class="linenos">458</span></a>
</span><span id="Tiler-459"><a href="#Tiler-459"><span class="linenos">459</span></a><span class="sd">            all_corners (bool): If True, returns all vertices of the bounding box.</span>
</span><span id="Tiler-460"><a href="#Tiler-460"><span class="linenos">460</span></a><span class="sd">                Default is False.</span>
</span><span id="Tiler-461"><a href="#Tiler-461"><span class="linenos">461</span></a>
</span><span id="Tiler-462"><a href="#Tiler-462"><span class="linenos">462</span></a><span class="sd">        Returns:</span>
</span><span id="Tiler-463"><a href="#Tiler-463"><span class="linenos">463</span></a><span class="sd">            (np.ndarray, np.ndarray): Smallest (bottom-left) and largest (top-right) corners of the bounding box.</span>
</span><span id="Tiler-464"><a href="#Tiler-464"><span class="linenos">464</span></a>
</span><span id="Tiler-465"><a href="#Tiler-465"><span class="linenos">465</span></a><span class="sd">            np.ndarray: All corners of the bounding box, if `all_corners=True`.</span>
</span><span id="Tiler-466"><a href="#Tiler-466"><span class="linenos">466</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Tiler-467"><a href="#Tiler-467"><span class="linenos">467</span></a>
</span><span id="Tiler-468"><a href="#Tiler-468"><span class="linenos">468</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">tile_id</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">tile_id</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_tiles</span><span class="p">):</span>
</span><span id="Tiler-469"><a href="#Tiler-469"><span class="linenos">469</span></a>            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span>
</span><span id="Tiler-470"><a href="#Tiler-470"><span class="linenos">470</span></a>                <span class="sa">f</span><span class="s2">&quot;Out of bounds, there is no tile </span><span class="si">{</span><span class="n">tile_id</span><span class="si">}</span><span class="s2">. There are </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> tiles, starting from index 0.&quot;</span>
</span><span id="Tiler-471"><a href="#Tiler-471"><span class="linenos">471</span></a>            <span class="p">)</span>
</span><span id="Tiler-472"><a href="#Tiler-472"><span class="linenos">472</span></a>
</span><span id="Tiler-473"><a href="#Tiler-473"><span class="linenos">473</span></a>        <span class="c1"># find min and max vertices</span>
</span><span id="Tiler-474"><a href="#Tiler-474"><span class="linenos">474</span></a>        <span class="n">bottom_left_corner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_step</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tile_mosaic_position</span><span class="p">(</span><span class="n">tile_id</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="Tiler-475"><a href="#Tiler-475"><span class="linenos">475</span></a>        <span class="n">top_right_corner</span> <span class="o">=</span> <span class="n">bottom_left_corner</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_shape</span>
</span><span id="Tiler-476"><a href="#Tiler-476"><span class="linenos">476</span></a>
</span><span id="Tiler-477"><a href="#Tiler-477"><span class="linenos">477</span></a>        <span class="c1"># remove channel dimension if not required</span>
</span><span id="Tiler-478"><a href="#Tiler-478"><span class="linenos">478</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel_dimension</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">with_channel_dim</span><span class="p">:</span>
</span><span id="Tiler-479"><a href="#Tiler-479"><span class="linenos">479</span></a>            <span class="n">dim_indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">channel_dimension</span><span class="p">))</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="Tiler-480"><a href="#Tiler-480"><span class="linenos">480</span></a>                <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">channel_dimension</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tile_step</span><span class="p">))</span>
</span><span id="Tiler-481"><a href="#Tiler-481"><span class="linenos">481</span></a>            <span class="p">)</span>
</span><span id="Tiler-482"><a href="#Tiler-482"><span class="linenos">482</span></a>            <span class="n">bottom_left_corner</span> <span class="o">=</span> <span class="n">bottom_left_corner</span><span class="p">[</span><span class="n">dim_indices</span><span class="p">]</span>
</span><span id="Tiler-483"><a href="#Tiler-483"><span class="linenos">483</span></a>            <span class="n">top_right_corner</span> <span class="o">=</span> <span class="n">top_right_corner</span><span class="p">[</span><span class="n">dim_indices</span><span class="p">]</span>
</span><span id="Tiler-484"><a href="#Tiler-484"><span class="linenos">484</span></a>
</span><span id="Tiler-485"><a href="#Tiler-485"><span class="linenos">485</span></a>        <span class="c1"># by default, return only min/max vertices</span>
</span><span id="Tiler-486"><a href="#Tiler-486"><span class="linenos">486</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">all_corners</span><span class="p">:</span>
</span><span id="Tiler-487"><a href="#Tiler-487"><span class="linenos">487</span></a>            <span class="k">return</span> <span class="n">bottom_left_corner</span><span class="p">,</span> <span class="n">top_right_corner</span>
</span><span id="Tiler-488"><a href="#Tiler-488"><span class="linenos">488</span></a>
</span><span id="Tiler-489"><a href="#Tiler-489"><span class="linenos">489</span></a>        <span class="c1"># otherwise, return all vertices of the bbox</span>
</span><span id="Tiler-490"><a href="#Tiler-490"><span class="linenos">490</span></a>        <span class="c1"># inspired by https://stackoverflow.com/a/57065356/1668421</span>
</span><span id="Tiler-491"><a href="#Tiler-491"><span class="linenos">491</span></a>        <span class="c1"># but instead create an indexing array from cartesian product of bits</span>
</span><span id="Tiler-492"><a href="#Tiler-492"><span class="linenos">492</span></a>        <span class="c1"># and use it to sample intervals</span>
</span><span id="Tiler-493"><a href="#Tiler-493"><span class="linenos">493</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Tiler-494"><a href="#Tiler-494"><span class="linenos">494</span></a>            <span class="n">n_dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bottom_left_corner</span><span class="p">)</span>  <span class="c1"># already channel_dimension adjusted</span>
</span><span id="Tiler-495"><a href="#Tiler-495"><span class="linenos">495</span></a>            <span class="n">mins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">bottom_left_corner</span><span class="p">,</span> <span class="n">top_right_corner</span><span class="p">)</span>
</span><span id="Tiler-496"><a href="#Tiler-496"><span class="linenos">496</span></a>            <span class="n">maxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">bottom_left_corner</span><span class="p">,</span> <span class="n">top_right_corner</span><span class="p">)</span>
</span><span id="Tiler-497"><a href="#Tiler-497"><span class="linenos">497</span></a>            <span class="n">intervals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">mins</span><span class="p">,</span> <span class="n">maxs</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Tiler-498"><a href="#Tiler-498"><span class="linenos">498</span></a>            <span class="n">indexing</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">repeat</span><span class="o">=</span><span class="n">n_dim</span><span class="p">)))</span>
</span><span id="Tiler-499"><a href="#Tiler-499"><span class="linenos">499</span></a>            <span class="n">corners</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">intervals</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">indexing</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">x</span><span class="p">]]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_dim</span><span class="p">)],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Tiler-500"><a href="#Tiler-500"><span class="linenos">500</span></a>            <span class="k">return</span> <span class="n">corners</span>
</span><span id="Tiler-501"><a href="#Tiler-501"><span class="linenos">501</span></a>
</span><span id="Tiler-502"><a href="#Tiler-502"><span class="linenos">502</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_tile_mosaic_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tile_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">with_channel_dim</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="Tiler-503"><a href="#Tiler-503"><span class="linenos">503</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns tile position in the mosaic.</span>
</span><span id="Tiler-504"><a href="#Tiler-504"><span class="linenos">504</span></a>
</span><span id="Tiler-505"><a href="#Tiler-505"><span class="linenos">505</span></a><span class="sd">        Args:</span>
</span><span id="Tiler-506"><a href="#Tiler-506"><span class="linenos">506</span></a><span class="sd">          tile_id (int): Specifies which tile&#39;s mosaic position will be returned. \</span>
</span><span id="Tiler-507"><a href="#Tiler-507"><span class="linenos">507</span></a><span class="sd">            Must be smaller than the total number of tiles.</span>
</span><span id="Tiler-508"><a href="#Tiler-508"><span class="linenos">508</span></a>
</span><span id="Tiler-509"><a href="#Tiler-509"><span class="linenos">509</span></a><span class="sd">          with_channel_dim (bool): Specifies whether to return position with channel dimension or without.</span>
</span><span id="Tiler-510"><a href="#Tiler-510"><span class="linenos">510</span></a><span class="sd">            Default is False.</span>
</span><span id="Tiler-511"><a href="#Tiler-511"><span class="linenos">511</span></a>
</span><span id="Tiler-512"><a href="#Tiler-512"><span class="linenos">512</span></a><span class="sd">        Returns:</span>
</span><span id="Tiler-513"><a href="#Tiler-513"><span class="linenos">513</span></a><span class="sd">            np.ndarray: Tile mosaic position (tile position relative to other tiles).</span>
</span><span id="Tiler-514"><a href="#Tiler-514"><span class="linenos">514</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Tiler-515"><a href="#Tiler-515"><span class="linenos">515</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">tile_id</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">tile_id</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_tiles</span><span class="p">):</span>
</span><span id="Tiler-516"><a href="#Tiler-516"><span class="linenos">516</span></a>            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span>
</span><span id="Tiler-517"><a href="#Tiler-517"><span class="linenos">517</span></a>                <span class="sa">f</span><span class="s2">&quot;Out of bounds, there is no tile </span><span class="si">{</span><span class="n">tile_id</span><span class="si">}</span><span class="s2">. There are </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> tiles, starting from index 0.&quot;</span>
</span><span id="Tiler-518"><a href="#Tiler-518"><span class="linenos">518</span></a>            <span class="p">)</span>
</span><span id="Tiler-519"><a href="#Tiler-519"><span class="linenos">519</span></a>
</span><span id="Tiler-520"><a href="#Tiler-520"><span class="linenos">520</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel_dimension</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">with_channel_dim</span><span class="p">:</span>
</span><span id="Tiler-521"><a href="#Tiler-521"><span class="linenos">521</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_index</span><span class="p">[</span><span class="n">tile_id</span><span class="p">][</span><span class="o">~</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_dim</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel_dimension</span><span class="p">)]</span>
</span><span id="Tiler-522"><a href="#Tiler-522"><span class="linenos">522</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_index</span><span class="p">[</span><span class="n">tile_id</span><span class="p">]</span>
</span><span id="Tiler-523"><a href="#Tiler-523"><span class="linenos">523</span></a>
</span><span id="Tiler-524"><a href="#Tiler-524"><span class="linenos">524</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_mosaic_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">with_channel_dim</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="Tiler-525"><a href="#Tiler-525"><span class="linenos">525</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns mosaic shape.</span>
</span><span id="Tiler-526"><a href="#Tiler-526"><span class="linenos">526</span></a>
</span><span id="Tiler-527"><a href="#Tiler-527"><span class="linenos">527</span></a><span class="sd">        Args:</span>
</span><span id="Tiler-528"><a href="#Tiler-528"><span class="linenos">528</span></a><span class="sd">            with_channel_dim (bool):</span>
</span><span id="Tiler-529"><a href="#Tiler-529"><span class="linenos">529</span></a><span class="sd">                Specifies whether to return shape with channel dimension or without. Defaults to False.</span>
</span><span id="Tiler-530"><a href="#Tiler-530"><span class="linenos">530</span></a>
</span><span id="Tiler-531"><a href="#Tiler-531"><span class="linenos">531</span></a><span class="sd">        Returns:</span>
</span><span id="Tiler-532"><a href="#Tiler-532"><span class="linenos">532</span></a><span class="sd">            np.ndarray: Shape of tiles mosaic.</span>
</span><span id="Tiler-533"><a href="#Tiler-533"><span class="linenos">533</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Tiler-534"><a href="#Tiler-534"><span class="linenos">534</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel_dimension</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">with_channel_dim</span><span class="p">:</span>
</span><span id="Tiler-535"><a href="#Tiler-535"><span class="linenos">535</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indexing_shape</span><span class="p">[</span><span class="o">~</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_dim</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel_dimension</span><span class="p">)]</span>
</span><span id="Tiler-536"><a href="#Tiler-536"><span class="linenos">536</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indexing_shape</span>
</span><span id="Tiler-537"><a href="#Tiler-537"><span class="linenos">537</span></a>
</span><span id="Tiler-538"><a href="#Tiler-538"><span class="linenos">538</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_padding</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]:</span>
</span><span id="Tiler-539"><a href="#Tiler-539"><span class="linenos">539</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate a frame padding for the current Tiler parameters.</span>
</span><span id="Tiler-540"><a href="#Tiler-540"><span class="linenos">540</span></a><span class="sd">        The padding is overlap//2 or tile_step//2, whichever is bigger.</span>
</span><span id="Tiler-541"><a href="#Tiler-541"><span class="linenos">541</span></a><span class="sd">        The method returns a tuple (new_shape, padding) where padding is</span>
</span><span id="Tiler-542"><a href="#Tiler-542"><span class="linenos">542</span></a><span class="sd">        ((before_1, after_1), … (before_N, after_N)), unique pad widths for each axis N.</span>
</span><span id="Tiler-543"><a href="#Tiler-543"><span class="linenos">543</span></a>
</span><span id="Tiler-544"><a href="#Tiler-544"><span class="linenos">544</span></a><span class="sd">        In the usual workflow, you&#39;d recalculate tiling settings and then apply padding, prior to tiling.</span>
</span><span id="Tiler-545"><a href="#Tiler-545"><span class="linenos">545</span></a><span class="sd">        Then when merging, pass padding to `Merger.merge(extra_padding=padding, ...)`:</span>
</span><span id="Tiler-546"><a href="#Tiler-546"><span class="linenos">546</span></a><span class="sd">        ```python</span>
</span><span id="Tiler-547"><a href="#Tiler-547"><span class="linenos">547</span></a><span class="sd">        &gt;&gt;&gt; tiler = Tiler(...)</span>
</span><span id="Tiler-548"><a href="#Tiler-548"><span class="linenos">548</span></a><span class="sd">        &gt;&gt;&gt; merger = Merger(tiler, ...)</span>
</span><span id="Tiler-549"><a href="#Tiler-549"><span class="linenos">549</span></a><span class="sd">        &gt;&gt;&gt; new_shape, padding = tiler.calculate_padding()</span>
</span><span id="Tiler-550"><a href="#Tiler-550"><span class="linenos">550</span></a><span class="sd">        &gt;&gt;&gt; tiler.recalculate(data_shape=new_shape)</span>
</span><span id="Tiler-551"><a href="#Tiler-551"><span class="linenos">551</span></a><span class="sd">        &gt;&gt;&gt; padded_data = np.pad(data, pad_width=padding, mode=&quot;reflect&quot;)</span>
</span><span id="Tiler-552"><a href="#Tiler-552"><span class="linenos">552</span></a><span class="sd">        &gt;&gt;&gt; for tile_id, tile in tiler(padded_data):</span>
</span><span id="Tiler-553"><a href="#Tiler-553"><span class="linenos">553</span></a><span class="sd">        &gt;&gt;&gt;     processed_tile = process(tile)</span>
</span><span id="Tiler-554"><a href="#Tiler-554"><span class="linenos">554</span></a><span class="sd">        &gt;&gt;&gt;     merger.add(tile_id, processed_tile)</span>
</span><span id="Tiler-555"><a href="#Tiler-555"><span class="linenos">555</span></a><span class="sd">        &gt;&gt;&gt; final_image = merger.merge(extra_padding=padding)</span>
</span><span id="Tiler-556"><a href="#Tiler-556"><span class="linenos">556</span></a><span class="sd">        ```</span>
</span><span id="Tiler-557"><a href="#Tiler-557"><span class="linenos">557</span></a><span class="sd">        Return:</span>
</span><span id="Tiler-558"><a href="#Tiler-558"><span class="linenos">558</span></a><span class="sd">            np.ndarray: Resulting shape when padding is applied.</span>
</span><span id="Tiler-559"><a href="#Tiler-559"><span class="linenos">559</span></a>
</span><span id="Tiler-560"><a href="#Tiler-560"><span class="linenos">560</span></a><span class="sd">            List[Tuple[int, int]]: Calculated padding.</span>
</span><span id="Tiler-561"><a href="#Tiler-561"><span class="linenos">561</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Tiler-562"><a href="#Tiler-562"><span class="linenos">562</span></a>
</span><span id="Tiler-563"><a href="#Tiler-563"><span class="linenos">563</span></a>        <span class="c1"># Choosing padding</span>
</span><span id="Tiler-564"><a href="#Tiler-564"><span class="linenos">564</span></a>        <span class="n">pre_pad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tile_step</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_overlap</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="Tiler-565"><a href="#Tiler-565"><span class="linenos">565</span></a>        <span class="n">post_pad</span> <span class="o">=</span> <span class="n">pre_pad</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tile_step</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="Tiler-566"><a href="#Tiler-566"><span class="linenos">566</span></a>
</span><span id="Tiler-567"><a href="#Tiler-567"><span class="linenos">567</span></a>        <span class="n">new_shape</span> <span class="o">=</span> <span class="n">pre_pad</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span> <span class="o">+</span> <span class="n">post_pad</span>
</span><span id="Tiler-568"><a href="#Tiler-568"><span class="linenos">568</span></a>        <span class="n">padding</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">pre_pad</span><span class="p">,</span> <span class="n">post_pad</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</span><span id="Tiler-569"><a href="#Tiler-569"><span class="linenos">569</span></a>
</span><span id="Tiler-570"><a href="#Tiler-570"><span class="linenos">570</span></a>        <span class="k">return</span> <span class="n">new_shape</span><span class="p">,</span> <span class="n">padding</span>
</span></pre></div>


    

                            <div id="Tiler.__init__" class="classattr">
                                        <input id="Tiler.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Tiler</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">data_shape</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>,</span><span class="param">	<span class="n">tile_shape</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>,</span><span class="param">	<span class="n">overlap</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">channel_dimension</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;constant&#39;</span>,</span><span class="param">	<span class="n">constant_value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span></span>)</span>

                <label class="view-source-button" for="Tiler.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Tiler.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Tiler.__init__-33"><a href="#Tiler.__init__-33"><span class="linenos">33</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="Tiler.__init__-34"><a href="#Tiler.__init__-34"><span class="linenos">34</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Tiler.__init__-35"><a href="#Tiler.__init__-35"><span class="linenos">35</span></a>        <span class="n">data_shape</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
</span><span id="Tiler.__init__-36"><a href="#Tiler.__init__-36"><span class="linenos">36</span></a>        <span class="n">tile_shape</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
</span><span id="Tiler.__init__-37"><a href="#Tiler.__init__-37"><span class="linenos">37</span></a>        <span class="n">overlap</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="Tiler.__init__-38"><a href="#Tiler.__init__-38"><span class="linenos">38</span></a>        <span class="n">channel_dimension</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Tiler.__init__-39"><a href="#Tiler.__init__-39"><span class="linenos">39</span></a>        <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;constant&quot;</span><span class="p">,</span>
</span><span id="Tiler.__init__-40"><a href="#Tiler.__init__-40"><span class="linenos">40</span></a>        <span class="n">constant_value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="Tiler.__init__-41"><a href="#Tiler.__init__-41"><span class="linenos">41</span></a>    <span class="p">):</span>
</span><span id="Tiler.__init__-42"><a href="#Tiler.__init__-42"><span class="linenos">42</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Tiler class precomputes everything for tiling with specified parameters, without actually slicing data.</span>
</span><span id="Tiler.__init__-43"><a href="#Tiler.__init__-43"><span class="linenos">43</span></a><span class="sd">        You can access tiles individually with `Tiler.get_tile()` or with an iterator, both individually and in batches,</span>
</span><span id="Tiler.__init__-44"><a href="#Tiler.__init__-44"><span class="linenos">44</span></a><span class="sd">        with `Tiler.iterate()` (or the alias `Tiler.__call__()`).</span>
</span><span id="Tiler.__init__-45"><a href="#Tiler.__init__-45"><span class="linenos">45</span></a>
</span><span id="Tiler.__init__-46"><a href="#Tiler.__init__-46"><span class="linenos">46</span></a><span class="sd">        Args:</span>
</span><span id="Tiler.__init__-47"><a href="#Tiler.__init__-47"><span class="linenos">47</span></a><span class="sd">            data_shape (tuple, list or np.ndarray): Input data shape.</span>
</span><span id="Tiler.__init__-48"><a href="#Tiler.__init__-48"><span class="linenos">48</span></a><span class="sd">                If there is a channel dimension, it should be included in the shape.</span>
</span><span id="Tiler.__init__-49"><a href="#Tiler.__init__-49"><span class="linenos">49</span></a><span class="sd">                For example, (1920, 1080, 3), [512, 512, 512] or np.ndarray([3, 1024, 768]).</span>
</span><span id="Tiler.__init__-50"><a href="#Tiler.__init__-50"><span class="linenos">50</span></a>
</span><span id="Tiler.__init__-51"><a href="#Tiler.__init__-51"><span class="linenos">51</span></a><span class="sd">            tile_shape (tuple, list or np.ndarray): Shape of a tile.</span>
</span><span id="Tiler.__init__-52"><a href="#Tiler.__init__-52"><span class="linenos">52</span></a><span class="sd">                Tile must have the same number of dimensions as data or less.</span>
</span><span id="Tiler.__init__-53"><a href="#Tiler.__init__-53"><span class="linenos">53</span></a><span class="sd">                If less, the shape will be automatically prepended with ones to match data_shape size.</span>
</span><span id="Tiler.__init__-54"><a href="#Tiler.__init__-54"><span class="linenos">54</span></a><span class="sd">                For example,  (256, 256, 3), [64, 64, 64] or np.ndarray([3, 128, 128]).</span>
</span><span id="Tiler.__init__-55"><a href="#Tiler.__init__-55"><span class="linenos">55</span></a>
</span><span id="Tiler.__init__-56"><a href="#Tiler.__init__-56"><span class="linenos">56</span></a><span class="sd">            overlap (int, float, tuple, list or np.ndarray): Specifies overlap between tiles.</span>
</span><span id="Tiler.__init__-57"><a href="#Tiler.__init__-57"><span class="linenos">57</span></a><span class="sd">                If integer, the same overlap of overlap pixels applied in each dimension, except channel_dimension.</span>
</span><span id="Tiler.__init__-58"><a href="#Tiler.__init__-58"><span class="linenos">58</span></a><span class="sd">                If float, percentage of a tile_shape to overlap [0.0, 1.0), from 0% to 100% non-inclusive, except</span>
</span><span id="Tiler.__init__-59"><a href="#Tiler.__init__-59"><span class="linenos">59</span></a><span class="sd">                channel_dimension.</span>
</span><span id="Tiler.__init__-60"><a href="#Tiler.__init__-60"><span class="linenos">60</span></a><span class="sd">                If tuple, list or np.ndarray, explicit size of the overlap (must be smaller than tile_shape in each</span>
</span><span id="Tiler.__init__-61"><a href="#Tiler.__init__-61"><span class="linenos">61</span></a><span class="sd">                dimension).</span>
</span><span id="Tiler.__init__-62"><a href="#Tiler.__init__-62"><span class="linenos">62</span></a><span class="sd">                Default is `0`.</span>
</span><span id="Tiler.__init__-63"><a href="#Tiler.__init__-63"><span class="linenos">63</span></a>
</span><span id="Tiler.__init__-64"><a href="#Tiler.__init__-64"><span class="linenos">64</span></a><span class="sd">            channel_dimension (int, optional): Specifies which axis is the channel dimension that will not be tiled.</span>
</span><span id="Tiler.__init__-65"><a href="#Tiler.__init__-65"><span class="linenos">65</span></a><span class="sd">                Usually it is the last or the first dimension of the array.</span>
</span><span id="Tiler.__init__-66"><a href="#Tiler.__init__-66"><span class="linenos">66</span></a><span class="sd">                Negative indexing (`-len(data_shape)` to `-1` inclusive) is allowed.</span>
</span><span id="Tiler.__init__-67"><a href="#Tiler.__init__-67"><span class="linenos">67</span></a><span class="sd">                Default is `None`, no channel dimension in the data.</span>
</span><span id="Tiler.__init__-68"><a href="#Tiler.__init__-68"><span class="linenos">68</span></a>
</span><span id="Tiler.__init__-69"><a href="#Tiler.__init__-69"><span class="linenos">69</span></a><span class="sd">            mode (str): Defines how the data will be tiled.</span>
</span><span id="Tiler.__init__-70"><a href="#Tiler.__init__-70"><span class="linenos">70</span></a><span class="sd">                Must be one of the supported `Tiler.TILING_MODES`. Defaults to `&quot;constant&quot;`.</span>
</span><span id="Tiler.__init__-71"><a href="#Tiler.__init__-71"><span class="linenos">71</span></a>
</span><span id="Tiler.__init__-72"><a href="#Tiler.__init__-72"><span class="linenos">72</span></a><span class="sd">            constant_value (float): Specifies the value of padding when `mode=&#39;constant&#39;`.</span>
</span><span id="Tiler.__init__-73"><a href="#Tiler.__init__-73"><span class="linenos">73</span></a><span class="sd">                Default is `0.0`.</span>
</span><span id="Tiler.__init__-74"><a href="#Tiler.__init__-74"><span class="linenos">74</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Tiler.__init__-75"><a href="#Tiler.__init__-75"><span class="linenos">75</span></a>
</span><span id="Tiler.__init__-76"><a href="#Tiler.__init__-76"><span class="linenos">76</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">recalculate</span><span class="p">(</span>
</span><span id="Tiler.__init__-77"><a href="#Tiler.__init__-77"><span class="linenos">77</span></a>            <span class="n">data_shape</span><span class="o">=</span><span class="n">data_shape</span><span class="p">,</span>
</span><span id="Tiler.__init__-78"><a href="#Tiler.__init__-78"><span class="linenos">78</span></a>            <span class="n">tile_shape</span><span class="o">=</span><span class="n">tile_shape</span><span class="p">,</span>
</span><span id="Tiler.__init__-79"><a href="#Tiler.__init__-79"><span class="linenos">79</span></a>            <span class="n">overlap</span><span class="o">=</span><span class="n">overlap</span><span class="p">,</span>
</span><span id="Tiler.__init__-80"><a href="#Tiler.__init__-80"><span class="linenos">80</span></a>            <span class="n">channel_dimension</span><span class="o">=</span><span class="n">channel_dimension</span><span class="p">,</span>
</span><span id="Tiler.__init__-81"><a href="#Tiler.__init__-81"><span class="linenos">81</span></a>            <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
</span><span id="Tiler.__init__-82"><a href="#Tiler.__init__-82"><span class="linenos">82</span></a>            <span class="n">constant_value</span><span class="o">=</span><span class="n">constant_value</span><span class="p">,</span>
</span><span id="Tiler.__init__-83"><a href="#Tiler.__init__-83"><span class="linenos">83</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Tiler class precomputes everything for tiling with specified parameters, without actually slicing data.
You can access tiles individually with <code><a href="#Tiler.get_tile">Tiler.get_tile()</a></code> or with an iterator, both individually and in batches,
with <code><a href="#Tiler.iterate">Tiler.iterate()</a></code> (or the alias <code>Tiler.__call__()</code>).</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>data_shape (tuple, list or np.ndarray):</strong>  Input data shape.
If there is a channel dimension, it should be included in the shape.
For example, (1920, 1080, 3), [512, 512, 512] or np.ndarray([3, 1024, 768]).</li>
<li><strong>tile_shape (tuple, list or np.ndarray):</strong>  Shape of a tile.
Tile must have the same number of dimensions as data or less.
If less, the shape will be automatically prepended with ones to match data_shape size.
For example,  (256, 256, 3), [64, 64, 64] or np.ndarray([3, 128, 128]).</li>
<li><strong>overlap (int, float, tuple, list or np.ndarray):</strong>  Specifies overlap between tiles.
If integer, the same overlap of overlap pixels applied in each dimension, except channel_dimension.
If float, percentage of a tile_shape to overlap [0.0, 1.0), from 0% to 100% non-inclusive, except
channel_dimension.
If tuple, list or np.ndarray, explicit size of the overlap (must be smaller than tile_shape in each
dimension).
Default is <code>0</code>.</li>
<li><strong>channel_dimension (int, optional):</strong>  Specifies which axis is the channel dimension that will not be tiled.
Usually it is the last or the first dimension of the array.
Negative indexing (<code>-len(data_shape)</code> to <code>-1</code> inclusive) is allowed.
Default is <code>None</code>, no channel dimension in the data.</li>
<li><strong>mode (str):</strong>  Defines how the data will be tiled.
Must be one of the supported <code><a href="#Tiler.TILING_MODES">Tiler.TILING_MODES</a></code>. Defaults to <code>"constant"</code>.</li>
<li><strong>constant_value (float):</strong>  Specifies the value of padding when <code>mode='constant'</code>.
Default is <code>0.0</code>.</li>
</ul>
</div>


                            </div>
                            <div id="Tiler.TILING_MODES" class="classattr">
                                <div class="attr variable">
            <span class="name">TILING_MODES</span>        =
<span class="default_value">[&#39;constant&#39;, &#39;drop&#39;, &#39;irregular&#39;, &#39;reflect&#39;, &#39;edge&#39;, &#39;wrap&#39;]</span>

        
    </div>
    <a class="headerlink" href="#Tiler.TILING_MODES"></a>
    
            <div class="docstring"><p>Supported tiling modes:</p>

<ul>
<li><code>constant</code> (default)
If a tile is smaller than <code>tile_shape</code>, pad it with the constant value along each axis to match <code>tile_shape</code>.
Set the value with the keyword <code>constant_value</code>.</li>
<li><code>drop</code>
If a tile is smaller than <code>tile_shape</code> in any of the dimensions, ignore it. Can result in zero tiles.</li>
<li><code>irregular</code>
Allow tiles to be smaller than <code>tile_shape</code>.</li>
<li><code>reflect</code>
If a tile is smaller than <code>tile_shape</code>,
pad it with the reflection of values along each axis to match <code>tile_shape</code>.</li>
<li><code>edge</code>
If a tile is smaller than <code>tile_shape</code>,
pad it with the edge values of data along each axis to match <code>tile_shape</code>.</li>
<li><code>wrap</code>
If a tile is smaller than <code>tile_shape</code>,
pad it with the wrap of the vector along each axis to match <code>tile_shape</code>.
The first values are used to pad the end and the end values are used to pad the beginning.</li>
</ul>
</div>


                            </div>
                            <div id="Tiler.recalculate" class="classattr">
                                        <input id="Tiler.recalculate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">recalculate</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">data_shape</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">tile_shape</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">overlap</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">channel_dimension</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">constant_value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Tiler.recalculate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Tiler.recalculate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Tiler.recalculate-85"><a href="#Tiler.recalculate-85"><span class="linenos"> 85</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">recalculate</span><span class="p">(</span>
</span><span id="Tiler.recalculate-86"><a href="#Tiler.recalculate-86"><span class="linenos"> 86</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Tiler.recalculate-87"><a href="#Tiler.recalculate-87"><span class="linenos"> 87</span></a>        <span class="n">data_shape</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Tiler.recalculate-88"><a href="#Tiler.recalculate-88"><span class="linenos"> 88</span></a>        <span class="n">tile_shape</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Tiler.recalculate-89"><a href="#Tiler.recalculate-89"><span class="linenos"> 89</span></a>        <span class="n">overlap</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Tiler.recalculate-90"><a href="#Tiler.recalculate-90"><span class="linenos"> 90</span></a>        <span class="n">channel_dimension</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Tiler.recalculate-91"><a href="#Tiler.recalculate-91"><span class="linenos"> 91</span></a>        <span class="n">mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Tiler.recalculate-92"><a href="#Tiler.recalculate-92"><span class="linenos"> 92</span></a>        <span class="n">constant_value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Tiler.recalculate-93"><a href="#Tiler.recalculate-93"><span class="linenos"> 93</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Tiler.recalculate-94"><a href="#Tiler.recalculate-94"><span class="linenos"> 94</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Recalculates tiling for new given settings.</span>
</span><span id="Tiler.recalculate-95"><a href="#Tiler.recalculate-95"><span class="linenos"> 95</span></a><span class="sd">        If a passed value is None, use previously given value.</span>
</span><span id="Tiler.recalculate-96"><a href="#Tiler.recalculate-96"><span class="linenos"> 96</span></a>
</span><span id="Tiler.recalculate-97"><a href="#Tiler.recalculate-97"><span class="linenos"> 97</span></a><span class="sd">        For more information about each argument see `Tiler.__init__()` documentation.</span>
</span><span id="Tiler.recalculate-98"><a href="#Tiler.recalculate-98"><span class="linenos"> 98</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Tiler.recalculate-99"><a href="#Tiler.recalculate-99"><span class="linenos"> 99</span></a>
</span><span id="Tiler.recalculate-100"><a href="#Tiler.recalculate-100"><span class="linenos">100</span></a>        <span class="c1"># Data and tile shapes</span>
</span><span id="Tiler.recalculate-101"><a href="#Tiler.recalculate-101"><span class="linenos">101</span></a>        <span class="k">if</span> <span class="n">data_shape</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Tiler.recalculate-102"><a href="#Tiler.recalculate-102"><span class="linenos">102</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
</span><span id="Tiler.recalculate-103"><a href="#Tiler.recalculate-103"><span class="linenos">103</span></a>        <span class="k">if</span> <span class="n">tile_shape</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Tiler.recalculate-104"><a href="#Tiler.recalculate-104"><span class="linenos">104</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tile_shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">tile_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">))</span>
</span><span id="Tiler.recalculate-105"><a href="#Tiler.recalculate-105"><span class="linenos">105</span></a>
</span><span id="Tiler.recalculate-106"><a href="#Tiler.recalculate-106"><span class="linenos">106</span></a>            <span class="c1"># Append ones to match data_shape size</span>
</span><span id="Tiler.recalculate-107"><a href="#Tiler.recalculate-107"><span class="linenos">107</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_shape</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
</span><span id="Tiler.recalculate-108"><a href="#Tiler.recalculate-108"><span class="linenos">108</span></a>                <span class="n">size_difference</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_shape</span><span class="o">.</span><span class="n">size</span>
</span><span id="Tiler.recalculate-109"><a href="#Tiler.recalculate-109"><span class="linenos">109</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">tile_shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">arr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tile_shape</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">size_difference</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Tiler.recalculate-110"><a href="#Tiler.recalculate-110"><span class="linenos">110</span></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="Tiler.recalculate-111"><a href="#Tiler.recalculate-111"><span class="linenos">111</span></a>                    <span class="sa">f</span><span class="s2">&quot;Tiler automatically adjusted tile_shape from </span><span class="si">{</span><span class="nb">tuple</span><span class="p">(</span><span class="n">tile_shape</span><span class="p">)</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tile_shape</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span>
</span><span id="Tiler.recalculate-112"><a href="#Tiler.recalculate-112"><span class="linenos">112</span></a>                    <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="Tiler.recalculate-113"><a href="#Tiler.recalculate-113"><span class="linenos">113</span></a>                <span class="p">)</span>
</span><span id="Tiler.recalculate-114"><a href="#Tiler.recalculate-114"><span class="linenos">114</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_n_dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">)</span>
</span><span id="Tiler.recalculate-115"><a href="#Tiler.recalculate-115"><span class="linenos">115</span></a>        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tile_shape</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">()</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="Tiler.recalculate-116"><a href="#Tiler.recalculate-116"><span class="linenos">116</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Tile and data shapes must be tuple, list or ndarray of positive integers.&quot;</span><span class="p">)</span>
</span><span id="Tiler.recalculate-117"><a href="#Tiler.recalculate-117"><span class="linenos">117</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_shape</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
</span><span id="Tiler.recalculate-118"><a href="#Tiler.recalculate-118"><span class="linenos">118</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Tiler.recalculate-119"><a href="#Tiler.recalculate-119"><span class="linenos">119</span></a>                <span class="s2">&quot;Tile shape must have less or equal number of elements compared to the data shape. &quot;</span>
</span><span id="Tiler.recalculate-120"><a href="#Tiler.recalculate-120"><span class="linenos">120</span></a>                <span class="s2">&quot;If less, your tile shape will be prepended with ones to match the data shape, &quot;</span>
</span><span id="Tiler.recalculate-121"><a href="#Tiler.recalculate-121"><span class="linenos">121</span></a>                <span class="s2">&quot;e.g. data_shape=(28, 28), tile_shape=(28) -&gt; tile_shape=(1, 28).&quot;</span>
</span><span id="Tiler.recalculate-122"><a href="#Tiler.recalculate-122"><span class="linenos">122</span></a>            <span class="p">)</span>
</span><span id="Tiler.recalculate-123"><a href="#Tiler.recalculate-123"><span class="linenos">123</span></a>
</span><span id="Tiler.recalculate-124"><a href="#Tiler.recalculate-124"><span class="linenos">124</span></a>        <span class="c1"># Tiling mode</span>
</span><span id="Tiler.recalculate-125"><a href="#Tiler.recalculate-125"><span class="linenos">125</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Tiler.recalculate-126"><a href="#Tiler.recalculate-126"><span class="linenos">126</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span>
</span><span id="Tiler.recalculate-127"><a href="#Tiler.recalculate-127"><span class="linenos">127</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">TILING_MODES</span><span class="p">:</span>
</span><span id="Tiler.recalculate-128"><a href="#Tiler.recalculate-128"><span class="linenos">128</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="si">}</span><span class="s2"> is an unsupported tiling mode, please check the documentation.&quot;</span><span class="p">)</span>
</span><span id="Tiler.recalculate-129"><a href="#Tiler.recalculate-129"><span class="linenos">129</span></a>
</span><span id="Tiler.recalculate-130"><a href="#Tiler.recalculate-130"><span class="linenos">130</span></a>        <span class="c1"># Constant value used for constant tiling mode</span>
</span><span id="Tiler.recalculate-131"><a href="#Tiler.recalculate-131"><span class="linenos">131</span></a>        <span class="k">if</span> <span class="n">constant_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Tiler.recalculate-132"><a href="#Tiler.recalculate-132"><span class="linenos">132</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">constant_value</span> <span class="o">=</span> <span class="n">constant_value</span>
</span><span id="Tiler.recalculate-133"><a href="#Tiler.recalculate-133"><span class="linenos">133</span></a>
</span><span id="Tiler.recalculate-134"><a href="#Tiler.recalculate-134"><span class="linenos">134</span></a>        <span class="c1"># Channel dimension can be None which means we need to check for init too</span>
</span><span id="Tiler.recalculate-135"><a href="#Tiler.recalculate-135"><span class="linenos">135</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;channel_dimension&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">channel_dimension</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Tiler.recalculate-136"><a href="#Tiler.recalculate-136"><span class="linenos">136</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">channel_dimension</span> <span class="o">=</span> <span class="n">channel_dimension</span>
</span><span id="Tiler.recalculate-137"><a href="#Tiler.recalculate-137"><span class="linenos">137</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel_dimension</span><span class="p">:</span>
</span><span id="Tiler.recalculate-138"><a href="#Tiler.recalculate-138"><span class="linenos">138</span></a>            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">channel_dimension</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_dim</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">channel_dimension</span> <span class="o">&lt;</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_dim</span><span class="p">):</span>
</span><span id="Tiler.recalculate-139"><a href="#Tiler.recalculate-139"><span class="linenos">139</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Tiler.recalculate-140"><a href="#Tiler.recalculate-140"><span class="linenos">140</span></a>                    <span class="sa">f</span><span class="s2">&quot;Specified channel dimension is out of bounds &quot;</span>
</span><span id="Tiler.recalculate-141"><a href="#Tiler.recalculate-141"><span class="linenos">141</span></a>                    <span class="sa">f</span><span class="s2">&quot;(should be None or an integer from </span><span class="si">{</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_dim</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_dim</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">).&quot;</span>
</span><span id="Tiler.recalculate-142"><a href="#Tiler.recalculate-142"><span class="linenos">142</span></a>                <span class="p">)</span>
</span><span id="Tiler.recalculate-143"><a href="#Tiler.recalculate-143"><span class="linenos">143</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel_dimension</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Tiler.recalculate-144"><a href="#Tiler.recalculate-144"><span class="linenos">144</span></a>                <span class="c1"># negative indexing</span>
</span><span id="Tiler.recalculate-145"><a href="#Tiler.recalculate-145"><span class="linenos">145</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">channel_dimension</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_dim</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel_dimension</span>
</span><span id="Tiler.recalculate-146"><a href="#Tiler.recalculate-146"><span class="linenos">146</span></a>
</span><span id="Tiler.recalculate-147"><a href="#Tiler.recalculate-147"><span class="linenos">147</span></a>        <span class="c1"># Overlap and step</span>
</span><span id="Tiler.recalculate-148"><a href="#Tiler.recalculate-148"><span class="linenos">148</span></a>        <span class="k">if</span> <span class="n">overlap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Tiler.recalculate-149"><a href="#Tiler.recalculate-149"><span class="linenos">149</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">overlap</span> <span class="o">=</span> <span class="n">overlap</span>
</span><span id="Tiler.recalculate-150"><a href="#Tiler.recalculate-150"><span class="linenos">150</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">overlap</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="Tiler.recalculate-151"><a href="#Tiler.recalculate-151"><span class="linenos">151</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlap</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlap</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="Tiler.recalculate-152"><a href="#Tiler.recalculate-152"><span class="linenos">152</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Float overlap must be in range of [0.0, 1.0) i.e. [0%, 100%).&quot;</span><span class="p">)</span>
</span><span id="Tiler.recalculate-153"><a href="#Tiler.recalculate-153"><span class="linenos">153</span></a>
</span><span id="Tiler.recalculate-154"><a href="#Tiler.recalculate-154"><span class="linenos">154</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_tile_overlap</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">overlap</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_shape</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="Tiler.recalculate-155"><a href="#Tiler.recalculate-155"><span class="linenos">155</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel_dimension</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Tiler.recalculate-156"><a href="#Tiler.recalculate-156"><span class="linenos">156</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_tile_overlap</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">channel_dimension</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Tiler.recalculate-157"><a href="#Tiler.recalculate-157"><span class="linenos">157</span></a>
</span><span id="Tiler.recalculate-158"><a href="#Tiler.recalculate-158"><span class="linenos">158</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">overlap</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Tiler.recalculate-159"><a href="#Tiler.recalculate-159"><span class="linenos">159</span></a>            <span class="n">tile_shape_without_channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_shape</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_dim</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel_dimension</span><span class="p">]</span>
</span><span id="Tiler.recalculate-160"><a href="#Tiler.recalculate-160"><span class="linenos">160</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlap</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">overlap</span> <span class="o">&gt;=</span> <span class="n">tile_shape_without_channel</span><span class="p">):</span>
</span><span id="Tiler.recalculate-161"><a href="#Tiler.recalculate-161"><span class="linenos">161</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Integer overlap must be in range of 0 to </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">tile_shape_without_channel</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Tiler.recalculate-162"><a href="#Tiler.recalculate-162"><span class="linenos">162</span></a>
</span><span id="Tiler.recalculate-163"><a href="#Tiler.recalculate-163"><span class="linenos">163</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_tile_overlap</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">overlap</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_shape</span><span class="p">])</span>
</span><span id="Tiler.recalculate-164"><a href="#Tiler.recalculate-164"><span class="linenos">164</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel_dimension</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Tiler.recalculate-165"><a href="#Tiler.recalculate-165"><span class="linenos">165</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_tile_overlap</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">channel_dimension</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Tiler.recalculate-166"><a href="#Tiler.recalculate-166"><span class="linenos">166</span></a>
</span><span id="Tiler.recalculate-167"><a href="#Tiler.recalculate-167"><span class="linenos">167</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">overlap</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
</span><span id="Tiler.recalculate-168"><a href="#Tiler.recalculate-168"><span class="linenos">168</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">overlap</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">overlap</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_shape</span><span class="p">):</span>
</span><span id="Tiler.recalculate-169"><a href="#Tiler.recalculate-169"><span class="linenos">169</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Overlap size must be smaller than tile_shape.&quot;</span><span class="p">)</span>
</span><span id="Tiler.recalculate-170"><a href="#Tiler.recalculate-170"><span class="linenos">170</span></a>
</span><span id="Tiler.recalculate-171"><a href="#Tiler.recalculate-171"><span class="linenos">171</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_tile_overlap</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">overlap</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="Tiler.recalculate-172"><a href="#Tiler.recalculate-172"><span class="linenos">172</span></a>
</span><span id="Tiler.recalculate-173"><a href="#Tiler.recalculate-173"><span class="linenos">173</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Tiler.recalculate-174"><a href="#Tiler.recalculate-174"><span class="linenos">174</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unsupported overlap mode (not float, int, list, tuple or np.ndarray).&quot;</span><span class="p">)</span>
</span><span id="Tiler.recalculate-175"><a href="#Tiler.recalculate-175"><span class="linenos">175</span></a>
</span><span id="Tiler.recalculate-176"><a href="#Tiler.recalculate-176"><span class="linenos">176</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_tile_step</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tile_shape</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_overlap</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>  <span class="c1"># tile step</span>
</span><span id="Tiler.recalculate-177"><a href="#Tiler.recalculate-177"><span class="linenos">177</span></a>
</span><span id="Tiler.recalculate-178"><a href="#Tiler.recalculate-178"><span class="linenos">178</span></a>        <span class="c1"># Calculate mosaic (collection of tiles) shape</span>
</span><span id="Tiler.recalculate-179"><a href="#Tiler.recalculate-179"><span class="linenos">179</span></a>        <span class="n">div</span><span class="p">,</span> <span class="n">mod</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divmod</span><span class="p">(</span>
</span><span id="Tiler.recalculate-180"><a href="#Tiler.recalculate-180"><span class="linenos">180</span></a>            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_overlap</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_dim</span><span class="p">)],</span>
</span><span id="Tiler.recalculate-181"><a href="#Tiler.recalculate-181"><span class="linenos">181</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_tile_step</span><span class="p">,</span>
</span><span id="Tiler.recalculate-182"><a href="#Tiler.recalculate-182"><span class="linenos">182</span></a>        <span class="p">)</span>
</span><span id="Tiler.recalculate-183"><a href="#Tiler.recalculate-183"><span class="linenos">183</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;drop&quot;</span><span class="p">:</span>
</span><span id="Tiler.recalculate-184"><a href="#Tiler.recalculate-184"><span class="linenos">184</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_indexing_shape</span> <span class="o">=</span> <span class="n">div</span>
</span><span id="Tiler.recalculate-185"><a href="#Tiler.recalculate-185"><span class="linenos">185</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Tiler.recalculate-186"><a href="#Tiler.recalculate-186"><span class="linenos">186</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_indexing_shape</span> <span class="o">=</span> <span class="n">div</span> <span class="o">+</span> <span class="p">(</span><span class="n">mod</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Tiler.recalculate-187"><a href="#Tiler.recalculate-187"><span class="linenos">187</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel_dimension</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Tiler.recalculate-188"><a href="#Tiler.recalculate-188"><span class="linenos">188</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_indexing_shape</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">channel_dimension</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Tiler.recalculate-189"><a href="#Tiler.recalculate-189"><span class="linenos">189</span></a>
</span><span id="Tiler.recalculate-190"><a href="#Tiler.recalculate-190"><span class="linenos">190</span></a>        <span class="c1"># Calculate new shape assuming tiles are padded</span>
</span><span id="Tiler.recalculate-191"><a href="#Tiler.recalculate-191"><span class="linenos">191</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;irregular&quot;</span><span class="p">:</span>
</span><span id="Tiler.recalculate-192"><a href="#Tiler.recalculate-192"><span class="linenos">192</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_new_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span>
</span><span id="Tiler.recalculate-193"><a href="#Tiler.recalculate-193"><span class="linenos">193</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Tiler.recalculate-194"><a href="#Tiler.recalculate-194"><span class="linenos">194</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_new_shape</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_indexing_shape</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_step</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_overlap</span>
</span><span id="Tiler.recalculate-195"><a href="#Tiler.recalculate-195"><span class="linenos">195</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_shape_diff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_shape</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span>
</span><span id="Tiler.recalculate-196"><a href="#Tiler.recalculate-196"><span class="linenos">196</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel_dimension</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Tiler.recalculate-197"><a href="#Tiler.recalculate-197"><span class="linenos">197</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_shape_diff</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">channel_dimension</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Tiler.recalculate-198"><a href="#Tiler.recalculate-198"><span class="linenos">198</span></a>
</span><span id="Tiler.recalculate-199"><a href="#Tiler.recalculate-199"><span class="linenos">199</span></a>        <span class="c1"># If channel dimension is given, set tile_step of that dimension to 0</span>
</span><span id="Tiler.recalculate-200"><a href="#Tiler.recalculate-200"><span class="linenos">200</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel_dimension</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Tiler.recalculate-201"><a href="#Tiler.recalculate-201"><span class="linenos">201</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_tile_step</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">channel_dimension</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Tiler.recalculate-202"><a href="#Tiler.recalculate-202"><span class="linenos">202</span></a>
</span><span id="Tiler.recalculate-203"><a href="#Tiler.recalculate-203"><span class="linenos">203</span></a>        <span class="c1"># Tile indexing</span>
</span><span id="Tiler.recalculate-204"><a href="#Tiler.recalculate-204"><span class="linenos">204</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_tile_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indexing_shape</span><span class="p">],</span> <span class="n">indexing</span><span class="o">=</span><span class="s2">&quot;ij&quot;</span><span class="p">))</span>
</span><span id="Tiler.recalculate-205"><a href="#Tiler.recalculate-205"><span class="linenos">205</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_tile_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_index</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_dim</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</span><span id="Tiler.recalculate-206"><a href="#Tiler.recalculate-206"><span class="linenos">206</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_tiles</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tile_index</span><span class="p">)</span>
</span><span id="Tiler.recalculate-207"><a href="#Tiler.recalculate-207"><span class="linenos">207</span></a>
</span><span id="Tiler.recalculate-208"><a href="#Tiler.recalculate-208"><span class="linenos">208</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_tiles</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Tiler.recalculate-209"><a href="#Tiler.recalculate-209"><span class="linenos">209</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="Tiler.recalculate-210"><a href="#Tiler.recalculate-210"><span class="linenos">210</span></a>                <span class="sa">f</span><span class="s2">&quot;Tiler (mode=</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">, overlap=</span><span class="si">{</span><span class="n">overlap</span><span class="si">}</span><span class="s2">) will split data_shape </span><span class="si">{</span><span class="n">data_shape</span><span class="si">}</span><span class="s2"> &quot;</span>
</span><span id="Tiler.recalculate-211"><a href="#Tiler.recalculate-211"><span class="linenos">211</span></a>                <span class="sa">f</span><span class="s2">&quot;into zero tiles (tile_shape=</span><span class="si">{</span><span class="n">tile_shape</span><span class="si">}</span><span class="s2">).&quot;</span><span class="p">,</span>
</span><span id="Tiler.recalculate-212"><a href="#Tiler.recalculate-212"><span class="linenos">212</span></a>                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="Tiler.recalculate-213"><a href="#Tiler.recalculate-213"><span class="linenos">213</span></a>            <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Recalculates tiling for new given settings.
If a passed value is None, use previously given value.</p>

<p>For more information about each argument see <code><a href="#Tiler.__init__">Tiler.__init__()</a></code> documentation.</p>
</div>


                            </div>
                            <div id="Tiler.iterate" class="classattr">
                                        <input id="Tiler.iterate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">iterate</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span>,</span><span class="param">	<span class="n">progress_bar</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">drop_last</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">copy_data</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="n">Generator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">NoneType</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Tiler.iterate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Tiler.iterate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Tiler.iterate-248"><a href="#Tiler.iterate-248"><span class="linenos">248</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">iterate</span><span class="p">(</span>
</span><span id="Tiler.iterate-249"><a href="#Tiler.iterate-249"><span class="linenos">249</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Tiler.iterate-250"><a href="#Tiler.iterate-250"><span class="linenos">250</span></a>        <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]],</span>
</span><span id="Tiler.iterate-251"><a href="#Tiler.iterate-251"><span class="linenos">251</span></a>        <span class="n">progress_bar</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Tiler.iterate-252"><a href="#Tiler.iterate-252"><span class="linenos">252</span></a>        <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="Tiler.iterate-253"><a href="#Tiler.iterate-253"><span class="linenos">253</span></a>        <span class="n">drop_last</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Tiler.iterate-254"><a href="#Tiler.iterate-254"><span class="linenos">254</span></a>        <span class="n">copy_data</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Tiler.iterate-255"><a href="#Tiler.iterate-255"><span class="linenos">255</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
</span><span id="Tiler.iterate-256"><a href="#Tiler.iterate-256"><span class="linenos">256</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Iterates through tiles of the given data array. This method can also be accessed by `Tiler.__call__()`.</span>
</span><span id="Tiler.iterate-257"><a href="#Tiler.iterate-257"><span class="linenos">257</span></a>
</span><span id="Tiler.iterate-258"><a href="#Tiler.iterate-258"><span class="linenos">258</span></a><span class="sd">        Args:</span>
</span><span id="Tiler.iterate-259"><a href="#Tiler.iterate-259"><span class="linenos">259</span></a><span class="sd">            data (np.ndarray or callable): The data array on which the tiling will be performed. A callable can be</span>
</span><span id="Tiler.iterate-260"><a href="#Tiler.iterate-260"><span class="linenos">260</span></a><span class="sd">                supplied to load data into memory instead of slicing from an array. The callable should take integers</span>
</span><span id="Tiler.iterate-261"><a href="#Tiler.iterate-261"><span class="linenos">261</span></a><span class="sd">                as input, the smallest tile corner coordinates and tile size in each dimension, and output numpy array.</span>
</span><span id="Tiler.iterate-262"><a href="#Tiler.iterate-262"><span class="linenos">262</span></a>
</span><span id="Tiler.iterate-263"><a href="#Tiler.iterate-263"><span class="linenos">263</span></a><span class="sd">                e.g.</span>
</span><span id="Tiler.iterate-264"><a href="#Tiler.iterate-264"><span class="linenos">264</span></a><span class="sd">                *python-bioformats*</span>
</span><span id="Tiler.iterate-265"><a href="#Tiler.iterate-265"><span class="linenos">265</span></a><span class="sd">                ```python</span>
</span><span id="Tiler.iterate-266"><a href="#Tiler.iterate-266"><span class="linenos">266</span></a><span class="sd">                &gt;&gt;&gt; tileSize = 2000</span>
</span><span id="Tiler.iterate-267"><a href="#Tiler.iterate-267"><span class="linenos">267</span></a><span class="sd">                &gt;&gt;&gt; tiler = Tiler((sizeX, sizeY, sizeC), (tileSize, tileSize, sizeC))</span>
</span><span id="Tiler.iterate-268"><a href="#Tiler.iterate-268"><span class="linenos">268</span></a><span class="sd">                &gt;&gt;&gt; def reader_func(*args):</span>
</span><span id="Tiler.iterate-269"><a href="#Tiler.iterate-269"><span class="linenos">269</span></a><span class="sd">                &gt;&gt;&gt;     X, Y, W, H = args[0], args[1], args[3], args[4]</span>
</span><span id="Tiler.iterate-270"><a href="#Tiler.iterate-270"><span class="linenos">270</span></a><span class="sd">                &gt;&gt;&gt;     return reader.read(XYWH=[X, Y, W, H])</span>
</span><span id="Tiler.iterate-271"><a href="#Tiler.iterate-271"><span class="linenos">271</span></a><span class="sd">                &gt;&gt;&gt; for t_id, tile in tiler.iterate(reader_func):</span>
</span><span id="Tiler.iterate-272"><a href="#Tiler.iterate-272"><span class="linenos">272</span></a><span class="sd">                &gt;&gt;&gt;     pass</span>
</span><span id="Tiler.iterate-273"><a href="#Tiler.iterate-273"><span class="linenos">273</span></a><span class="sd">                ```</span>
</span><span id="Tiler.iterate-274"><a href="#Tiler.iterate-274"><span class="linenos">274</span></a><span class="sd">                *open-slide*</span>
</span><span id="Tiler.iterate-275"><a href="#Tiler.iterate-275"><span class="linenos">275</span></a><span class="sd">                ```python</span>
</span><span id="Tiler.iterate-276"><a href="#Tiler.iterate-276"><span class="linenos">276</span></a><span class="sd">                &gt;&gt;&gt; reader_func = lambda *args: wsi.read_region([args[0], args[1]], 0, [args[3], args[4]])</span>
</span><span id="Tiler.iterate-277"><a href="#Tiler.iterate-277"><span class="linenos">277</span></a><span class="sd">                &gt;&gt;&gt; for t_id, tile in tiler.iterate(reader_func):</span>
</span><span id="Tiler.iterate-278"><a href="#Tiler.iterate-278"><span class="linenos">278</span></a><span class="sd">                &gt;&gt;&gt;     pass</span>
</span><span id="Tiler.iterate-279"><a href="#Tiler.iterate-279"><span class="linenos">279</span></a><span class="sd">                ```</span>
</span><span id="Tiler.iterate-280"><a href="#Tiler.iterate-280"><span class="linenos">280</span></a>
</span><span id="Tiler.iterate-281"><a href="#Tiler.iterate-281"><span class="linenos">281</span></a><span class="sd">            progress_bar (bool): Specifies whether to show the progress bar or not.</span>
</span><span id="Tiler.iterate-282"><a href="#Tiler.iterate-282"><span class="linenos">282</span></a><span class="sd">                Uses `tqdm` package.</span>
</span><span id="Tiler.iterate-283"><a href="#Tiler.iterate-283"><span class="linenos">283</span></a><span class="sd">                Default is `False`.</span>
</span><span id="Tiler.iterate-284"><a href="#Tiler.iterate-284"><span class="linenos">284</span></a>
</span><span id="Tiler.iterate-285"><a href="#Tiler.iterate-285"><span class="linenos">285</span></a><span class="sd">            batch_size (int): Specifies returned batch size.</span>
</span><span id="Tiler.iterate-286"><a href="#Tiler.iterate-286"><span class="linenos">286</span></a><span class="sd">                If `batch_size == 0`, return one tile at a time.</span>
</span><span id="Tiler.iterate-287"><a href="#Tiler.iterate-287"><span class="linenos">287</span></a><span class="sd">                If `batch_size &gt;= 1`, return in batches (returned shape: `[batch_size, *tile_shape]`).</span>
</span><span id="Tiler.iterate-288"><a href="#Tiler.iterate-288"><span class="linenos">288</span></a><span class="sd">                Default is 0.</span>
</span><span id="Tiler.iterate-289"><a href="#Tiler.iterate-289"><span class="linenos">289</span></a>
</span><span id="Tiler.iterate-290"><a href="#Tiler.iterate-290"><span class="linenos">290</span></a><span class="sd">            drop_last (bool): Specifies whether to drop last non-full batch.</span>
</span><span id="Tiler.iterate-291"><a href="#Tiler.iterate-291"><span class="linenos">291</span></a><span class="sd">                Used only when batch_size &gt; 0.</span>
</span><span id="Tiler.iterate-292"><a href="#Tiler.iterate-292"><span class="linenos">292</span></a><span class="sd">                Default is False.</span>
</span><span id="Tiler.iterate-293"><a href="#Tiler.iterate-293"><span class="linenos">293</span></a>
</span><span id="Tiler.iterate-294"><a href="#Tiler.iterate-294"><span class="linenos">294</span></a><span class="sd">            copy_data (bool): Specifies whether to copy the tile before returning it.</span>
</span><span id="Tiler.iterate-295"><a href="#Tiler.iterate-295"><span class="linenos">295</span></a><span class="sd">                If `copy_data == False`, returns a view.</span>
</span><span id="Tiler.iterate-296"><a href="#Tiler.iterate-296"><span class="linenos">296</span></a><span class="sd">                Default is True.</span>
</span><span id="Tiler.iterate-297"><a href="#Tiler.iterate-297"><span class="linenos">297</span></a>
</span><span id="Tiler.iterate-298"><a href="#Tiler.iterate-298"><span class="linenos">298</span></a><span class="sd">        Yields:</span>
</span><span id="Tiler.iterate-299"><a href="#Tiler.iterate-299"><span class="linenos">299</span></a><span class="sd">            (int, np.ndarray): Tuple with integer tile number and array tile data.</span>
</span><span id="Tiler.iterate-300"><a href="#Tiler.iterate-300"><span class="linenos">300</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Tiler.iterate-301"><a href="#Tiler.iterate-301"><span class="linenos">301</span></a>
</span><span id="Tiler.iterate-302"><a href="#Tiler.iterate-302"><span class="linenos">302</span></a>        <span class="k">if</span> <span class="n">batch_size</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Tiler.iterate-303"><a href="#Tiler.iterate-303"><span class="linenos">303</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Batch size must &gt;= 0, not </span><span class="si">{</span><span class="n">batch_size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Tiler.iterate-304"><a href="#Tiler.iterate-304"><span class="linenos">304</span></a>
</span><span id="Tiler.iterate-305"><a href="#Tiler.iterate-305"><span class="linenos">305</span></a>        <span class="c1"># return a tile at a time</span>
</span><span id="Tiler.iterate-306"><a href="#Tiler.iterate-306"><span class="linenos">306</span></a>        <span class="k">if</span> <span class="n">batch_size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Tiler.iterate-307"><a href="#Tiler.iterate-307"><span class="linenos">307</span></a>            <span class="k">for</span> <span class="n">tile_i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_tiles</span><span class="p">),</span> <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="n">progress_bar</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot; tiles&quot;</span><span class="p">):</span>
</span><span id="Tiler.iterate-308"><a href="#Tiler.iterate-308"><span class="linenos">308</span></a>                <span class="k">yield</span> <span class="n">tile_i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">tile_i</span><span class="p">,</span> <span class="n">copy_data</span><span class="o">=</span><span class="n">copy_data</span><span class="p">)</span>
</span><span id="Tiler.iterate-309"><a href="#Tiler.iterate-309"><span class="linenos">309</span></a>
</span><span id="Tiler.iterate-310"><a href="#Tiler.iterate-310"><span class="linenos">310</span></a>        <span class="c1"># return in batches</span>
</span><span id="Tiler.iterate-311"><a href="#Tiler.iterate-311"><span class="linenos">311</span></a>        <span class="k">if</span> <span class="n">batch_size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Tiler.iterate-312"><a href="#Tiler.iterate-312"><span class="linenos">312</span></a>            <span class="c1"># check for drop_last</span>
</span><span id="Tiler.iterate-313"><a href="#Tiler.iterate-313"><span class="linenos">313</span></a>            <span class="n">length</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_tiles</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_tiles</span> <span class="o">%</span> <span class="n">batch_size</span><span class="p">))</span> <span class="k">if</span> <span class="n">drop_last</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_tiles</span>
</span><span id="Tiler.iterate-314"><a href="#Tiler.iterate-314"><span class="linenos">314</span></a>
</span><span id="Tiler.iterate-315"><a href="#Tiler.iterate-315"><span class="linenos">315</span></a>            <span class="k">for</span> <span class="n">tile_i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">),</span> <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="n">progress_bar</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot; batches&quot;</span><span class="p">):</span>
</span><span id="Tiler.iterate-316"><a href="#Tiler.iterate-316"><span class="linenos">316</span></a>                <span class="n">tiles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span>
</span><span id="Tiler.iterate-317"><a href="#Tiler.iterate-317"><span class="linenos">317</span></a>                    <span class="p">[</span>
</span><span id="Tiler.iterate-318"><a href="#Tiler.iterate-318"><span class="linenos">318</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">get_tile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">copy_data</span><span class="o">=</span><span class="n">copy_data</span><span class="p">)</span>
</span><span id="Tiler.iterate-319"><a href="#Tiler.iterate-319"><span class="linenos">319</span></a>                        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">tile_i</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">tile_i</span> <span class="o">+</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">length</span><span class="p">))</span>
</span><span id="Tiler.iterate-320"><a href="#Tiler.iterate-320"><span class="linenos">320</span></a>                    <span class="p">]</span>
</span><span id="Tiler.iterate-321"><a href="#Tiler.iterate-321"><span class="linenos">321</span></a>                <span class="p">)</span>
</span><span id="Tiler.iterate-322"><a href="#Tiler.iterate-322"><span class="linenos">322</span></a>                <span class="k">yield</span> <span class="n">tile_i</span> <span class="o">//</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">tiles</span>
</span></pre></div>


            <div class="docstring"><p>Iterates through tiles of the given data array. This method can also be accessed by <code>Tiler.__call__()</code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><p><strong>data (np.ndarray or callable):</strong>  The data array on which the tiling will be performed. A callable can be
supplied to load data into memory instead of slicing from an array. The callable should take integers
as input, the smallest tile corner coordinates and tile size in each dimension, and output numpy array.</p>

<p>e.g.
<em>python-bioformats</em></p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">tileSize</span> <span class="o">=</span> <span class="mi">2000</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">tiler</span> <span class="o">=</span> <span class="n">Tiler</span><span class="p">((</span><span class="n">sizeX</span><span class="p">,</span> <span class="n">sizeY</span><span class="p">,</span> <span class="n">sizeC</span><span class="p">),</span> <span class="p">(</span><span class="n">tileSize</span><span class="p">,</span> <span class="n">tileSize</span><span class="p">,</span> <span class="n">sizeC</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">def</span><span class="w"> </span><span class="nf">reader_func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="k">return</span> <span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">XYWH</span><span class="o">=</span><span class="p">[</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">H</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">t_id</span><span class="p">,</span> <span class="n">tile</span> <span class="ow">in</span> <span class="n">tiler</span><span class="o">.</span><span class="n">iterate</span><span class="p">(</span><span class="n">reader_func</span><span class="p">):</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="k">pass</span>
</code></pre>
</div>

<p><em>open-slide</em></p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">reader_func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">wsi</span><span class="o">.</span><span class="n">read_region</span><span class="p">([</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="n">args</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">4</span><span class="p">]])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">t_id</span><span class="p">,</span> <span class="n">tile</span> <span class="ow">in</span> <span class="n">tiler</span><span class="o">.</span><span class="n">iterate</span><span class="p">(</span><span class="n">reader_func</span><span class="p">):</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="k">pass</span>
</code></pre>
</div></li>
<li><p><strong>progress_bar (bool):</strong>  Specifies whether to show the progress bar or not.
Uses <code>tqdm</code> package.
Default is <code>False</code>.</p></li>
<li><strong>batch_size (int):</strong>  Specifies returned batch size.
If <code>batch_size == 0</code>, return one tile at a time.
If <code>batch_size &gt;= 1</code>, return in batches (returned shape: <code>[batch_size, *tile_shape]</code>).
Default is 0.</li>
<li><strong>drop_last (bool):</strong>  Specifies whether to drop last non-full batch.
Used only when batch_size &gt; 0.
Default is False.</li>
<li><strong>copy_data (bool):</strong>  Specifies whether to copy the tile before returning it.
If <code>copy_data == False</code>, returns a view.
Default is True.</li>
</ul>

<h6 id="yields">Yields:</h6>

<blockquote>
  <p>(int, np.ndarray): Tuple with integer tile number and array tile data.</p>
</blockquote>
</div>


                            </div>
                            <div id="Tiler.get_tile" class="classattr">
                                        <input id="Tiler.get_tile-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_tile</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span>,</span><span class="param">	<span class="n">tile_id</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">copy_data</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>:</span></span>

                <label class="view-source-button" for="Tiler.get_tile-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Tiler.get_tile"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Tiler.get_tile-324"><a href="#Tiler.get_tile-324"><span class="linenos">324</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_tile</span><span class="p">(</span>
</span><span id="Tiler.get_tile-325"><a href="#Tiler.get_tile-325"><span class="linenos">325</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Tiler.get_tile-326"><a href="#Tiler.get_tile-326"><span class="linenos">326</span></a>        <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]],</span>
</span><span id="Tiler.get_tile-327"><a href="#Tiler.get_tile-327"><span class="linenos">327</span></a>        <span class="n">tile_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="Tiler.get_tile-328"><a href="#Tiler.get_tile-328"><span class="linenos">328</span></a>        <span class="n">copy_data</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Tiler.get_tile-329"><a href="#Tiler.get_tile-329"><span class="linenos">329</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="Tiler.get_tile-330"><a href="#Tiler.get_tile-330"><span class="linenos">330</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns an individual tile.</span>
</span><span id="Tiler.get_tile-331"><a href="#Tiler.get_tile-331"><span class="linenos">331</span></a>
</span><span id="Tiler.get_tile-332"><a href="#Tiler.get_tile-332"><span class="linenos">332</span></a><span class="sd">        Args:</span>
</span><span id="Tiler.get_tile-333"><a href="#Tiler.get_tile-333"><span class="linenos">333</span></a><span class="sd">            data (np.ndarray or callable): Data from which `tile_id`-th tile will be taken. A callable can be</span>
</span><span id="Tiler.get_tile-334"><a href="#Tiler.get_tile-334"><span class="linenos">334</span></a><span class="sd">                supplied to load data into memory instead of slicing from an array. The callable should take integers</span>
</span><span id="Tiler.get_tile-335"><a href="#Tiler.get_tile-335"><span class="linenos">335</span></a><span class="sd">                as input, the smallest tile corner coordinates and tile size in each dimension, and output numpy array.</span>
</span><span id="Tiler.get_tile-336"><a href="#Tiler.get_tile-336"><span class="linenos">336</span></a>
</span><span id="Tiler.get_tile-337"><a href="#Tiler.get_tile-337"><span class="linenos">337</span></a><span class="sd">                e.g.</span>
</span><span id="Tiler.get_tile-338"><a href="#Tiler.get_tile-338"><span class="linenos">338</span></a><span class="sd">                *python-bioformats*</span>
</span><span id="Tiler.get_tile-339"><a href="#Tiler.get_tile-339"><span class="linenos">339</span></a><span class="sd">                ```python</span>
</span><span id="Tiler.get_tile-340"><a href="#Tiler.get_tile-340"><span class="linenos">340</span></a><span class="sd">                &gt;&gt;&gt; tileSize = 2000</span>
</span><span id="Tiler.get_tile-341"><a href="#Tiler.get_tile-341"><span class="linenos">341</span></a><span class="sd">                &gt;&gt;&gt; tiler = Tiler((sizeX, sizeY, sizeC), (tileSize, tileSize, sizeC))</span>
</span><span id="Tiler.get_tile-342"><a href="#Tiler.get_tile-342"><span class="linenos">342</span></a><span class="sd">                &gt;&gt;&gt; def reader_func(*args):</span>
</span><span id="Tiler.get_tile-343"><a href="#Tiler.get_tile-343"><span class="linenos">343</span></a><span class="sd">                &gt;&gt;&gt;     X, Y, W, H = args[0], args[1], args[3], args[4]</span>
</span><span id="Tiler.get_tile-344"><a href="#Tiler.get_tile-344"><span class="linenos">344</span></a><span class="sd">                &gt;&gt;&gt;     return reader.read(XYWH=[X, Y, W, H])</span>
</span><span id="Tiler.get_tile-345"><a href="#Tiler.get_tile-345"><span class="linenos">345</span></a><span class="sd">                &gt;&gt;&gt; tiler.get_tile(reader_func, 0)</span>
</span><span id="Tiler.get_tile-346"><a href="#Tiler.get_tile-346"><span class="linenos">346</span></a><span class="sd">                ```</span>
</span><span id="Tiler.get_tile-347"><a href="#Tiler.get_tile-347"><span class="linenos">347</span></a><span class="sd">                *open-slide*</span>
</span><span id="Tiler.get_tile-348"><a href="#Tiler.get_tile-348"><span class="linenos">348</span></a><span class="sd">                ```python</span>
</span><span id="Tiler.get_tile-349"><a href="#Tiler.get_tile-349"><span class="linenos">349</span></a><span class="sd">                &gt;&gt;&gt; reader_func = lambda *args: wsi.read_region([args[0], args[1]], 0, [args[3], args[4]])</span>
</span><span id="Tiler.get_tile-350"><a href="#Tiler.get_tile-350"><span class="linenos">350</span></a><span class="sd">                &gt;&gt;&gt; tiler.get_tile(reader_func, 0)</span>
</span><span id="Tiler.get_tile-351"><a href="#Tiler.get_tile-351"><span class="linenos">351</span></a><span class="sd">                ```</span>
</span><span id="Tiler.get_tile-352"><a href="#Tiler.get_tile-352"><span class="linenos">352</span></a>
</span><span id="Tiler.get_tile-353"><a href="#Tiler.get_tile-353"><span class="linenos">353</span></a><span class="sd">            tile_id (int): Specifies which tile to return. Must be smaller than the total number of tiles.</span>
</span><span id="Tiler.get_tile-354"><a href="#Tiler.get_tile-354"><span class="linenos">354</span></a>
</span><span id="Tiler.get_tile-355"><a href="#Tiler.get_tile-355"><span class="linenos">355</span></a><span class="sd">            copy_data (bool): Specifies whether returned tile is a copy.</span>
</span><span id="Tiler.get_tile-356"><a href="#Tiler.get_tile-356"><span class="linenos">356</span></a><span class="sd">                If `copy_data == False` returns a view.</span>
</span><span id="Tiler.get_tile-357"><a href="#Tiler.get_tile-357"><span class="linenos">357</span></a><span class="sd">                Default is True.</span>
</span><span id="Tiler.get_tile-358"><a href="#Tiler.get_tile-358"><span class="linenos">358</span></a>
</span><span id="Tiler.get_tile-359"><a href="#Tiler.get_tile-359"><span class="linenos">359</span></a><span class="sd">        Returns:</span>
</span><span id="Tiler.get_tile-360"><a href="#Tiler.get_tile-360"><span class="linenos">360</span></a><span class="sd">            np.ndarray: Content of tile number `tile_id`, padded if necessary.</span>
</span><span id="Tiler.get_tile-361"><a href="#Tiler.get_tile-361"><span class="linenos">361</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Tiler.get_tile-362"><a href="#Tiler.get_tile-362"><span class="linenos">362</span></a>
</span><span id="Tiler.get_tile-363"><a href="#Tiler.get_tile-363"><span class="linenos">363</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">tile_id</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">tile_id</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_tiles</span><span class="p">):</span>
</span><span id="Tiler.get_tile-364"><a href="#Tiler.get_tile-364"><span class="linenos">364</span></a>            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span>
</span><span id="Tiler.get_tile-365"><a href="#Tiler.get_tile-365"><span class="linenos">365</span></a>                <span class="sa">f</span><span class="s2">&quot;Out of bounds, there is no tile </span><span class="si">{</span><span class="n">tile_id</span><span class="si">}</span><span class="s2">.There are </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> tiles, starting from index 0.&quot;</span>
</span><span id="Tiler.get_tile-366"><a href="#Tiler.get_tile-366"><span class="linenos">366</span></a>            <span class="p">)</span>
</span><span id="Tiler.get_tile-367"><a href="#Tiler.get_tile-367"><span class="linenos">367</span></a>
</span><span id="Tiler.get_tile-368"><a href="#Tiler.get_tile-368"><span class="linenos">368</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">not_equal</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="Tiler.get_tile-369"><a href="#Tiler.get_tile-369"><span class="linenos">369</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Tiler.get_tile-370"><a href="#Tiler.get_tile-370"><span class="linenos">370</span></a>                <span class="sa">f</span><span class="s2">&quot;Shape of provided data array (</span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">) does not match &quot;</span>
</span><span id="Tiler.get_tile-371"><a href="#Tiler.get_tile-371"><span class="linenos">371</span></a>                <span class="sa">f</span><span class="s2">&quot;same as Tiler&#39;s data_shape (</span><span class="si">{</span><span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">)</span><span class="si">}</span><span class="s2">).&quot;</span>
</span><span id="Tiler.get_tile-372"><a href="#Tiler.get_tile-372"><span class="linenos">372</span></a>            <span class="p">)</span>
</span><span id="Tiler.get_tile-373"><a href="#Tiler.get_tile-373"><span class="linenos">373</span></a>
</span><span id="Tiler.get_tile-374"><a href="#Tiler.get_tile-374"><span class="linenos">374</span></a>        <span class="c1"># get tile data</span>
</span><span id="Tiler.get_tile-375"><a href="#Tiler.get_tile-375"><span class="linenos">375</span></a>        <span class="n">tile_corner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_index</span><span class="p">[</span><span class="n">tile_id</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_step</span>
</span><span id="Tiler.get_tile-376"><a href="#Tiler.get_tile-376"><span class="linenos">376</span></a>        <span class="c1"># take the lesser of the tile shape and the distance to the edge</span>
</span><span id="Tiler.get_tile-377"><a href="#Tiler.get_tile-377"><span class="linenos">377</span></a>        <span class="n">sampling</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Tiler.get_tile-378"><a href="#Tiler.get_tile-378"><span class="linenos">378</span></a>            <span class="nb">slice</span><span class="p">(</span>
</span><span id="Tiler.get_tile-379"><a href="#Tiler.get_tile-379"><span class="linenos">379</span></a>                <span class="n">tile_corner</span><span class="p">[</span><span class="n">d</span><span class="p">],</span>
</span><span id="Tiler.get_tile-380"><a href="#Tiler.get_tile-380"><span class="linenos">380</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="n">tile_corner</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_shape</span><span class="p">[</span><span class="n">d</span><span class="p">]]),</span>
</span><span id="Tiler.get_tile-381"><a href="#Tiler.get_tile-381"><span class="linenos">381</span></a>            <span class="p">)</span>
</span><span id="Tiler.get_tile-382"><a href="#Tiler.get_tile-382"><span class="linenos">382</span></a>            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_dim</span><span class="p">)</span>
</span><span id="Tiler.get_tile-383"><a href="#Tiler.get_tile-383"><span class="linenos">383</span></a>        <span class="p">]</span>
</span><span id="Tiler.get_tile-384"><a href="#Tiler.get_tile-384"><span class="linenos">384</span></a>
</span><span id="Tiler.get_tile-385"><a href="#Tiler.get_tile-385"><span class="linenos">385</span></a>        <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span><span id="Tiler.get_tile-386"><a href="#Tiler.get_tile-386"><span class="linenos">386</span></a>            <span class="n">sampling</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">stop</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">start</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sampling</span><span class="p">]</span>
</span><span id="Tiler.get_tile-387"><a href="#Tiler.get_tile-387"><span class="linenos">387</span></a>            <span class="n">tile_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">(</span><span class="o">*</span><span class="n">tile_corner</span><span class="p">,</span> <span class="o">*</span><span class="n">sampling</span><span class="p">)</span>
</span><span id="Tiler.get_tile-388"><a href="#Tiler.get_tile-388"><span class="linenos">388</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Tiler.get_tile-389"><a href="#Tiler.get_tile-389"><span class="linenos">389</span></a>            <span class="n">tile_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">sampling</span><span class="p">)]</span>
</span><span id="Tiler.get_tile-390"><a href="#Tiler.get_tile-390"><span class="linenos">390</span></a>
</span><span id="Tiler.get_tile-391"><a href="#Tiler.get_tile-391"><span class="linenos">391</span></a>        <span class="k">if</span> <span class="n">copy_data</span><span class="p">:</span>
</span><span id="Tiler.get_tile-392"><a href="#Tiler.get_tile-392"><span class="linenos">392</span></a>            <span class="n">tile_data</span> <span class="o">=</span> <span class="n">tile_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Tiler.get_tile-393"><a href="#Tiler.get_tile-393"><span class="linenos">393</span></a>
</span><span id="Tiler.get_tile-394"><a href="#Tiler.get_tile-394"><span class="linenos">394</span></a>        <span class="n">shape_diff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_shape</span> <span class="o">-</span> <span class="n">tile_data</span><span class="o">.</span><span class="n">shape</span>
</span><span id="Tiler.get_tile-395"><a href="#Tiler.get_tile-395"><span class="linenos">395</span></a>        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">!=</span> <span class="s2">&quot;irregular&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">shape_diff</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="Tiler.get_tile-396"><a href="#Tiler.get_tile-396"><span class="linenos">396</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;constant&quot;</span><span class="p">:</span>
</span><span id="Tiler.get_tile-397"><a href="#Tiler.get_tile-397"><span class="linenos">397</span></a>                <span class="n">tile_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span>
</span><span id="Tiler.get_tile-398"><a href="#Tiler.get_tile-398"><span class="linenos">398</span></a>                    <span class="n">tile_data</span><span class="p">,</span>
</span><span id="Tiler.get_tile-399"><a href="#Tiler.get_tile-399"><span class="linenos">399</span></a>                    <span class="nb">list</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">diff</span><span class="p">)</span> <span class="k">for</span> <span class="n">diff</span> <span class="ow">in</span> <span class="n">shape_diff</span><span class="p">),</span>
</span><span id="Tiler.get_tile-400"><a href="#Tiler.get_tile-400"><span class="linenos">400</span></a>                    <span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span>
</span><span id="Tiler.get_tile-401"><a href="#Tiler.get_tile-401"><span class="linenos">401</span></a>                    <span class="n">constant_values</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">constant_value</span><span class="p">,</span>
</span><span id="Tiler.get_tile-402"><a href="#Tiler.get_tile-402"><span class="linenos">402</span></a>                <span class="p">)</span>
</span><span id="Tiler.get_tile-403"><a href="#Tiler.get_tile-403"><span class="linenos">403</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;reflect&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;edge&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;wrap&quot;</span><span class="p">:</span>
</span><span id="Tiler.get_tile-404"><a href="#Tiler.get_tile-404"><span class="linenos">404</span></a>                <span class="n">tile_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">tile_data</span><span class="p">,</span> <span class="nb">list</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">diff</span><span class="p">)</span> <span class="k">for</span> <span class="n">diff</span> <span class="ow">in</span> <span class="n">shape_diff</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
</span><span id="Tiler.get_tile-405"><a href="#Tiler.get_tile-405"><span class="linenos">405</span></a>
</span><span id="Tiler.get_tile-406"><a href="#Tiler.get_tile-406"><span class="linenos">406</span></a>        <span class="k">return</span> <span class="n">tile_data</span>
</span></pre></div>


            <div class="docstring"><p>Returns an individual tile.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><p><strong>data (np.ndarray or callable):</strong>  Data from which <code>tile_id</code>-th tile will be taken. A callable can be
supplied to load data into memory instead of slicing from an array. The callable should take integers
as input, the smallest tile corner coordinates and tile size in each dimension, and output numpy array.</p>

<p>e.g.
<em>python-bioformats</em></p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">tileSize</span> <span class="o">=</span> <span class="mi">2000</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">tiler</span> <span class="o">=</span> <span class="n">Tiler</span><span class="p">((</span><span class="n">sizeX</span><span class="p">,</span> <span class="n">sizeY</span><span class="p">,</span> <span class="n">sizeC</span><span class="p">),</span> <span class="p">(</span><span class="n">tileSize</span><span class="p">,</span> <span class="n">tileSize</span><span class="p">,</span> <span class="n">sizeC</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">def</span><span class="w"> </span><span class="nf">reader_func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="k">return</span> <span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">XYWH</span><span class="o">=</span><span class="p">[</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">H</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">tiler</span><span class="o">.</span><span class="n">get_tile</span><span class="p">(</span><span class="n">reader_func</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</code></pre>
</div>

<p><em>open-slide</em></p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">reader_func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">wsi</span><span class="o">.</span><span class="n">read_region</span><span class="p">([</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="n">args</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">4</span><span class="p">]])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">tiler</span><span class="o">.</span><span class="n">get_tile</span><span class="p">(</span><span class="n">reader_func</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</code></pre>
</div></li>
<li><p><strong>tile_id (int):</strong>  Specifies which tile to return. Must be smaller than the total number of tiles.</p></li>
<li><strong>copy_data (bool):</strong>  Specifies whether returned tile is a copy.
If <code>copy_data == False</code> returns a view.
Default is True.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>np.ndarray: Content of tile number <code>tile_id</code>, padded if necessary.</p>
</blockquote>
</div>


                            </div>
                            <div id="Tiler.get_all_tiles" class="classattr">
                                        <input id="Tiler.get_all_tiles-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_all_tiles</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span>,</span><span class="param">	<span class="n">axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">copy_data</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>:</span></span>

                <label class="view-source-button" for="Tiler.get_all_tiles-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Tiler.get_all_tiles"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Tiler.get_all_tiles-408"><a href="#Tiler.get_all_tiles-408"><span class="linenos">408</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_all_tiles</span><span class="p">(</span>
</span><span id="Tiler.get_all_tiles-409"><a href="#Tiler.get_all_tiles-409"><span class="linenos">409</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Tiler.get_all_tiles-410"><a href="#Tiler.get_all_tiles-410"><span class="linenos">410</span></a>        <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]],</span>
</span><span id="Tiler.get_all_tiles-411"><a href="#Tiler.get_all_tiles-411"><span class="linenos">411</span></a>        <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="Tiler.get_all_tiles-412"><a href="#Tiler.get_all_tiles-412"><span class="linenos">412</span></a>        <span class="n">copy_data</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Tiler.get_all_tiles-413"><a href="#Tiler.get_all_tiles-413"><span class="linenos">413</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="Tiler.get_all_tiles-414"><a href="#Tiler.get_all_tiles-414"><span class="linenos">414</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns all tiles joined along a new axis. Does not work for `Tiler.mode = &#39;irregular&#39;`.</span>
</span><span id="Tiler.get_all_tiles-415"><a href="#Tiler.get_all_tiles-415"><span class="linenos">415</span></a>
</span><span id="Tiler.get_all_tiles-416"><a href="#Tiler.get_all_tiles-416"><span class="linenos">416</span></a><span class="sd">        The `axis` parameter specifies the index of the new axis in the dimensions of the result.</span>
</span><span id="Tiler.get_all_tiles-417"><a href="#Tiler.get_all_tiles-417"><span class="linenos">417</span></a><span class="sd">        For example, if `axis=0` it will be the first dimension and if `axis=-1` it will be the last dimension.</span>
</span><span id="Tiler.get_all_tiles-418"><a href="#Tiler.get_all_tiles-418"><span class="linenos">418</span></a>
</span><span id="Tiler.get_all_tiles-419"><a href="#Tiler.get_all_tiles-419"><span class="linenos">419</span></a><span class="sd">        For more information about `data` and `copy_data` parameters, see `Tiler.get_tile()`.</span>
</span><span id="Tiler.get_all_tiles-420"><a href="#Tiler.get_all_tiles-420"><span class="linenos">420</span></a>
</span><span id="Tiler.get_all_tiles-421"><a href="#Tiler.get_all_tiles-421"><span class="linenos">421</span></a><span class="sd">        Args:</span>
</span><span id="Tiler.get_all_tiles-422"><a href="#Tiler.get_all_tiles-422"><span class="linenos">422</span></a><span class="sd">            data (np.ndarray or callable): Data which will be tiled. A callable can be supplied to load data into memory</span>
</span><span id="Tiler.get_all_tiles-423"><a href="#Tiler.get_all_tiles-423"><span class="linenos">423</span></a><span class="sd">                instead of slicing from an array. The callable should take integers as input, the smallest tile corner</span>
</span><span id="Tiler.get_all_tiles-424"><a href="#Tiler.get_all_tiles-424"><span class="linenos">424</span></a><span class="sd">                coordinates and tile size in each dimension, and output numpy array.</span>
</span><span id="Tiler.get_all_tiles-425"><a href="#Tiler.get_all_tiles-425"><span class="linenos">425</span></a>
</span><span id="Tiler.get_all_tiles-426"><a href="#Tiler.get_all_tiles-426"><span class="linenos">426</span></a><span class="sd">            axis (int): The axis in the result array along which the tiles are stacked.</span>
</span><span id="Tiler.get_all_tiles-427"><a href="#Tiler.get_all_tiles-427"><span class="linenos">427</span></a>
</span><span id="Tiler.get_all_tiles-428"><a href="#Tiler.get_all_tiles-428"><span class="linenos">428</span></a><span class="sd">            copy_data (bool): Specifies whether returned tile is a copy.</span>
</span><span id="Tiler.get_all_tiles-429"><a href="#Tiler.get_all_tiles-429"><span class="linenos">429</span></a><span class="sd">                If `copy_data == False` returns a view.</span>
</span><span id="Tiler.get_all_tiles-430"><a href="#Tiler.get_all_tiles-430"><span class="linenos">430</span></a><span class="sd">                Default is True.</span>
</span><span id="Tiler.get_all_tiles-431"><a href="#Tiler.get_all_tiles-431"><span class="linenos">431</span></a>
</span><span id="Tiler.get_all_tiles-432"><a href="#Tiler.get_all_tiles-432"><span class="linenos">432</span></a><span class="sd">        Returns:</span>
</span><span id="Tiler.get_all_tiles-433"><a href="#Tiler.get_all_tiles-433"><span class="linenos">433</span></a><span class="sd">            np.ndarray: All tiles stacked along a new axis.</span>
</span><span id="Tiler.get_all_tiles-434"><a href="#Tiler.get_all_tiles-434"><span class="linenos">434</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Tiler.get_all_tiles-435"><a href="#Tiler.get_all_tiles-435"><span class="linenos">435</span></a>
</span><span id="Tiler.get_all_tiles-436"><a href="#Tiler.get_all_tiles-436"><span class="linenos">436</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;irregular&quot;</span><span class="p">:</span>
</span><span id="Tiler.get_all_tiles-437"><a href="#Tiler.get_all_tiles-437"><span class="linenos">437</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;get_all_tiles does not support irregular mode&quot;</span><span class="p">)</span>
</span><span id="Tiler.get_all_tiles-438"><a href="#Tiler.get_all_tiles-438"><span class="linenos">438</span></a>
</span><span id="Tiler.get_all_tiles-439"><a href="#Tiler.get_all_tiles-439"><span class="linenos">439</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span>
</span><span id="Tiler.get_all_tiles-440"><a href="#Tiler.get_all_tiles-440"><span class="linenos">440</span></a>            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_tile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">copy_data</span><span class="o">=</span><span class="n">copy_data</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_tiles</span><span class="p">)],</span>
</span><span id="Tiler.get_all_tiles-441"><a href="#Tiler.get_all_tiles-441"><span class="linenos">441</span></a>            <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span>
</span><span id="Tiler.get_all_tiles-442"><a href="#Tiler.get_all_tiles-442"><span class="linenos">442</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Returns all tiles joined along a new axis. Does not work for <code>Tiler.mode = 'irregular'</code>.</p>

<p>The <code>axis</code> parameter specifies the index of the new axis in the dimensions of the result.
For example, if <code>axis=0</code> it will be the first dimension and if <code>axis=-1</code> it will be the last dimension.</p>

<p>For more information about <code>data</code> and <code>copy_data</code> parameters, see <code><a href="#Tiler.get_tile">Tiler.get_tile()</a></code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>data (np.ndarray or callable):</strong>  Data which will be tiled. A callable can be supplied to load data into memory
instead of slicing from an array. The callable should take integers as input, the smallest tile corner
coordinates and tile size in each dimension, and output numpy array.</li>
<li><strong>axis (int):</strong>  The axis in the result array along which the tiles are stacked.</li>
<li><strong>copy_data (bool):</strong>  Specifies whether returned tile is a copy.
If <code>copy_data == False</code> returns a view.
Default is True.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>np.ndarray: All tiles stacked along a new axis.</p>
</blockquote>
</div>


                            </div>
                            <div id="Tiler.get_tile_bbox" class="classattr">
                                        <input id="Tiler.get_tile_bbox-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_tile_bbox</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">tile_id</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">with_channel_dim</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">all_corners</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Tiler.get_tile_bbox-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Tiler.get_tile_bbox"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Tiler.get_tile_bbox-444"><a href="#Tiler.get_tile_bbox-444"><span class="linenos">444</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_tile_bbox</span><span class="p">(</span>
</span><span id="Tiler.get_tile_bbox-445"><a href="#Tiler.get_tile_bbox-445"><span class="linenos">445</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Tiler.get_tile_bbox-446"><a href="#Tiler.get_tile_bbox-446"><span class="linenos">446</span></a>        <span class="n">tile_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="Tiler.get_tile_bbox-447"><a href="#Tiler.get_tile_bbox-447"><span class="linenos">447</span></a>        <span class="n">with_channel_dim</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Tiler.get_tile_bbox-448"><a href="#Tiler.get_tile_bbox-448"><span class="linenos">448</span></a>        <span class="n">all_corners</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Tiler.get_tile_bbox-449"><a href="#Tiler.get_tile_bbox-449"><span class="linenos">449</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
</span><span id="Tiler.get_tile_bbox-450"><a href="#Tiler.get_tile_bbox-450"><span class="linenos">450</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns coordinates of the opposite corners of the bounding box (hyperrectangle?) of the tile on padded data.</span>
</span><span id="Tiler.get_tile_bbox-451"><a href="#Tiler.get_tile_bbox-451"><span class="linenos">451</span></a>
</span><span id="Tiler.get_tile_bbox-452"><a href="#Tiler.get_tile_bbox-452"><span class="linenos">452</span></a><span class="sd">        Args:</span>
</span><span id="Tiler.get_tile_bbox-453"><a href="#Tiler.get_tile_bbox-453"><span class="linenos">453</span></a><span class="sd">            tile_id (int): Specifies which tile&#39;s bounding coordinates will be returned.</span>
</span><span id="Tiler.get_tile_bbox-454"><a href="#Tiler.get_tile_bbox-454"><span class="linenos">454</span></a><span class="sd">                Must be between 0 and the total number of tiles.</span>
</span><span id="Tiler.get_tile_bbox-455"><a href="#Tiler.get_tile_bbox-455"><span class="linenos">455</span></a>
</span><span id="Tiler.get_tile_bbox-456"><a href="#Tiler.get_tile_bbox-456"><span class="linenos">456</span></a><span class="sd">            with_channel_dim (bool): Specifies whether to return shape with channel dimension or without.</span>
</span><span id="Tiler.get_tile_bbox-457"><a href="#Tiler.get_tile_bbox-457"><span class="linenos">457</span></a><span class="sd">                Default is False.</span>
</span><span id="Tiler.get_tile_bbox-458"><a href="#Tiler.get_tile_bbox-458"><span class="linenos">458</span></a>
</span><span id="Tiler.get_tile_bbox-459"><a href="#Tiler.get_tile_bbox-459"><span class="linenos">459</span></a><span class="sd">            all_corners (bool): If True, returns all vertices of the bounding box.</span>
</span><span id="Tiler.get_tile_bbox-460"><a href="#Tiler.get_tile_bbox-460"><span class="linenos">460</span></a><span class="sd">                Default is False.</span>
</span><span id="Tiler.get_tile_bbox-461"><a href="#Tiler.get_tile_bbox-461"><span class="linenos">461</span></a>
</span><span id="Tiler.get_tile_bbox-462"><a href="#Tiler.get_tile_bbox-462"><span class="linenos">462</span></a><span class="sd">        Returns:</span>
</span><span id="Tiler.get_tile_bbox-463"><a href="#Tiler.get_tile_bbox-463"><span class="linenos">463</span></a><span class="sd">            (np.ndarray, np.ndarray): Smallest (bottom-left) and largest (top-right) corners of the bounding box.</span>
</span><span id="Tiler.get_tile_bbox-464"><a href="#Tiler.get_tile_bbox-464"><span class="linenos">464</span></a>
</span><span id="Tiler.get_tile_bbox-465"><a href="#Tiler.get_tile_bbox-465"><span class="linenos">465</span></a><span class="sd">            np.ndarray: All corners of the bounding box, if `all_corners=True`.</span>
</span><span id="Tiler.get_tile_bbox-466"><a href="#Tiler.get_tile_bbox-466"><span class="linenos">466</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Tiler.get_tile_bbox-467"><a href="#Tiler.get_tile_bbox-467"><span class="linenos">467</span></a>
</span><span id="Tiler.get_tile_bbox-468"><a href="#Tiler.get_tile_bbox-468"><span class="linenos">468</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">tile_id</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">tile_id</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_tiles</span><span class="p">):</span>
</span><span id="Tiler.get_tile_bbox-469"><a href="#Tiler.get_tile_bbox-469"><span class="linenos">469</span></a>            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span>
</span><span id="Tiler.get_tile_bbox-470"><a href="#Tiler.get_tile_bbox-470"><span class="linenos">470</span></a>                <span class="sa">f</span><span class="s2">&quot;Out of bounds, there is no tile </span><span class="si">{</span><span class="n">tile_id</span><span class="si">}</span><span class="s2">. There are </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> tiles, starting from index 0.&quot;</span>
</span><span id="Tiler.get_tile_bbox-471"><a href="#Tiler.get_tile_bbox-471"><span class="linenos">471</span></a>            <span class="p">)</span>
</span><span id="Tiler.get_tile_bbox-472"><a href="#Tiler.get_tile_bbox-472"><span class="linenos">472</span></a>
</span><span id="Tiler.get_tile_bbox-473"><a href="#Tiler.get_tile_bbox-473"><span class="linenos">473</span></a>        <span class="c1"># find min and max vertices</span>
</span><span id="Tiler.get_tile_bbox-474"><a href="#Tiler.get_tile_bbox-474"><span class="linenos">474</span></a>        <span class="n">bottom_left_corner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_step</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tile_mosaic_position</span><span class="p">(</span><span class="n">tile_id</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="Tiler.get_tile_bbox-475"><a href="#Tiler.get_tile_bbox-475"><span class="linenos">475</span></a>        <span class="n">top_right_corner</span> <span class="o">=</span> <span class="n">bottom_left_corner</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_shape</span>
</span><span id="Tiler.get_tile_bbox-476"><a href="#Tiler.get_tile_bbox-476"><span class="linenos">476</span></a>
</span><span id="Tiler.get_tile_bbox-477"><a href="#Tiler.get_tile_bbox-477"><span class="linenos">477</span></a>        <span class="c1"># remove channel dimension if not required</span>
</span><span id="Tiler.get_tile_bbox-478"><a href="#Tiler.get_tile_bbox-478"><span class="linenos">478</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel_dimension</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">with_channel_dim</span><span class="p">:</span>
</span><span id="Tiler.get_tile_bbox-479"><a href="#Tiler.get_tile_bbox-479"><span class="linenos">479</span></a>            <span class="n">dim_indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">channel_dimension</span><span class="p">))</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="Tiler.get_tile_bbox-480"><a href="#Tiler.get_tile_bbox-480"><span class="linenos">480</span></a>                <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">channel_dimension</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tile_step</span><span class="p">))</span>
</span><span id="Tiler.get_tile_bbox-481"><a href="#Tiler.get_tile_bbox-481"><span class="linenos">481</span></a>            <span class="p">)</span>
</span><span id="Tiler.get_tile_bbox-482"><a href="#Tiler.get_tile_bbox-482"><span class="linenos">482</span></a>            <span class="n">bottom_left_corner</span> <span class="o">=</span> <span class="n">bottom_left_corner</span><span class="p">[</span><span class="n">dim_indices</span><span class="p">]</span>
</span><span id="Tiler.get_tile_bbox-483"><a href="#Tiler.get_tile_bbox-483"><span class="linenos">483</span></a>            <span class="n">top_right_corner</span> <span class="o">=</span> <span class="n">top_right_corner</span><span class="p">[</span><span class="n">dim_indices</span><span class="p">]</span>
</span><span id="Tiler.get_tile_bbox-484"><a href="#Tiler.get_tile_bbox-484"><span class="linenos">484</span></a>
</span><span id="Tiler.get_tile_bbox-485"><a href="#Tiler.get_tile_bbox-485"><span class="linenos">485</span></a>        <span class="c1"># by default, return only min/max vertices</span>
</span><span id="Tiler.get_tile_bbox-486"><a href="#Tiler.get_tile_bbox-486"><span class="linenos">486</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">all_corners</span><span class="p">:</span>
</span><span id="Tiler.get_tile_bbox-487"><a href="#Tiler.get_tile_bbox-487"><span class="linenos">487</span></a>            <span class="k">return</span> <span class="n">bottom_left_corner</span><span class="p">,</span> <span class="n">top_right_corner</span>
</span><span id="Tiler.get_tile_bbox-488"><a href="#Tiler.get_tile_bbox-488"><span class="linenos">488</span></a>
</span><span id="Tiler.get_tile_bbox-489"><a href="#Tiler.get_tile_bbox-489"><span class="linenos">489</span></a>        <span class="c1"># otherwise, return all vertices of the bbox</span>
</span><span id="Tiler.get_tile_bbox-490"><a href="#Tiler.get_tile_bbox-490"><span class="linenos">490</span></a>        <span class="c1"># inspired by https://stackoverflow.com/a/57065356/1668421</span>
</span><span id="Tiler.get_tile_bbox-491"><a href="#Tiler.get_tile_bbox-491"><span class="linenos">491</span></a>        <span class="c1"># but instead create an indexing array from cartesian product of bits</span>
</span><span id="Tiler.get_tile_bbox-492"><a href="#Tiler.get_tile_bbox-492"><span class="linenos">492</span></a>        <span class="c1"># and use it to sample intervals</span>
</span><span id="Tiler.get_tile_bbox-493"><a href="#Tiler.get_tile_bbox-493"><span class="linenos">493</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Tiler.get_tile_bbox-494"><a href="#Tiler.get_tile_bbox-494"><span class="linenos">494</span></a>            <span class="n">n_dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bottom_left_corner</span><span class="p">)</span>  <span class="c1"># already channel_dimension adjusted</span>
</span><span id="Tiler.get_tile_bbox-495"><a href="#Tiler.get_tile_bbox-495"><span class="linenos">495</span></a>            <span class="n">mins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">bottom_left_corner</span><span class="p">,</span> <span class="n">top_right_corner</span><span class="p">)</span>
</span><span id="Tiler.get_tile_bbox-496"><a href="#Tiler.get_tile_bbox-496"><span class="linenos">496</span></a>            <span class="n">maxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">bottom_left_corner</span><span class="p">,</span> <span class="n">top_right_corner</span><span class="p">)</span>
</span><span id="Tiler.get_tile_bbox-497"><a href="#Tiler.get_tile_bbox-497"><span class="linenos">497</span></a>            <span class="n">intervals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">mins</span><span class="p">,</span> <span class="n">maxs</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Tiler.get_tile_bbox-498"><a href="#Tiler.get_tile_bbox-498"><span class="linenos">498</span></a>            <span class="n">indexing</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">repeat</span><span class="o">=</span><span class="n">n_dim</span><span class="p">)))</span>
</span><span id="Tiler.get_tile_bbox-499"><a href="#Tiler.get_tile_bbox-499"><span class="linenos">499</span></a>            <span class="n">corners</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">intervals</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">indexing</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">x</span><span class="p">]]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_dim</span><span class="p">)],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Tiler.get_tile_bbox-500"><a href="#Tiler.get_tile_bbox-500"><span class="linenos">500</span></a>            <span class="k">return</span> <span class="n">corners</span>
</span></pre></div>


            <div class="docstring"><p>Returns coordinates of the opposite corners of the bounding box (hyperrectangle?) of the tile on padded data.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>tile_id (int):</strong>  Specifies which tile's bounding coordinates will be returned.
Must be between 0 and the total number of tiles.</li>
<li><strong>with_channel_dim (bool):</strong>  Specifies whether to return shape with channel dimension or without.
Default is False.</li>
<li><strong>all_corners (bool):</strong>  If True, returns all vertices of the bounding box.
Default is False.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>(np.ndarray, np.ndarray): Smallest (bottom-left) and largest (top-right) corners of the bounding box.</p>
  
  <p>np.ndarray: All corners of the bounding box, if <code>all_corners=True</code>.</p>
</blockquote>
</div>


                            </div>
                            <div id="Tiler.get_tile_mosaic_position" class="classattr">
                                        <input id="Tiler.get_tile_mosaic_position-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_tile_mosaic_position</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">tile_id</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="n">with_channel_dim</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>:</span></span>

                <label class="view-source-button" for="Tiler.get_tile_mosaic_position-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Tiler.get_tile_mosaic_position"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Tiler.get_tile_mosaic_position-502"><a href="#Tiler.get_tile_mosaic_position-502"><span class="linenos">502</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_tile_mosaic_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tile_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">with_channel_dim</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="Tiler.get_tile_mosaic_position-503"><a href="#Tiler.get_tile_mosaic_position-503"><span class="linenos">503</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns tile position in the mosaic.</span>
</span><span id="Tiler.get_tile_mosaic_position-504"><a href="#Tiler.get_tile_mosaic_position-504"><span class="linenos">504</span></a>
</span><span id="Tiler.get_tile_mosaic_position-505"><a href="#Tiler.get_tile_mosaic_position-505"><span class="linenos">505</span></a><span class="sd">        Args:</span>
</span><span id="Tiler.get_tile_mosaic_position-506"><a href="#Tiler.get_tile_mosaic_position-506"><span class="linenos">506</span></a><span class="sd">          tile_id (int): Specifies which tile&#39;s mosaic position will be returned. \</span>
</span><span id="Tiler.get_tile_mosaic_position-507"><a href="#Tiler.get_tile_mosaic_position-507"><span class="linenos">507</span></a><span class="sd">            Must be smaller than the total number of tiles.</span>
</span><span id="Tiler.get_tile_mosaic_position-508"><a href="#Tiler.get_tile_mosaic_position-508"><span class="linenos">508</span></a>
</span><span id="Tiler.get_tile_mosaic_position-509"><a href="#Tiler.get_tile_mosaic_position-509"><span class="linenos">509</span></a><span class="sd">          with_channel_dim (bool): Specifies whether to return position with channel dimension or without.</span>
</span><span id="Tiler.get_tile_mosaic_position-510"><a href="#Tiler.get_tile_mosaic_position-510"><span class="linenos">510</span></a><span class="sd">            Default is False.</span>
</span><span id="Tiler.get_tile_mosaic_position-511"><a href="#Tiler.get_tile_mosaic_position-511"><span class="linenos">511</span></a>
</span><span id="Tiler.get_tile_mosaic_position-512"><a href="#Tiler.get_tile_mosaic_position-512"><span class="linenos">512</span></a><span class="sd">        Returns:</span>
</span><span id="Tiler.get_tile_mosaic_position-513"><a href="#Tiler.get_tile_mosaic_position-513"><span class="linenos">513</span></a><span class="sd">            np.ndarray: Tile mosaic position (tile position relative to other tiles).</span>
</span><span id="Tiler.get_tile_mosaic_position-514"><a href="#Tiler.get_tile_mosaic_position-514"><span class="linenos">514</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Tiler.get_tile_mosaic_position-515"><a href="#Tiler.get_tile_mosaic_position-515"><span class="linenos">515</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">tile_id</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">tile_id</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_tiles</span><span class="p">):</span>
</span><span id="Tiler.get_tile_mosaic_position-516"><a href="#Tiler.get_tile_mosaic_position-516"><span class="linenos">516</span></a>            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span>
</span><span id="Tiler.get_tile_mosaic_position-517"><a href="#Tiler.get_tile_mosaic_position-517"><span class="linenos">517</span></a>                <span class="sa">f</span><span class="s2">&quot;Out of bounds, there is no tile </span><span class="si">{</span><span class="n">tile_id</span><span class="si">}</span><span class="s2">. There are </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> tiles, starting from index 0.&quot;</span>
</span><span id="Tiler.get_tile_mosaic_position-518"><a href="#Tiler.get_tile_mosaic_position-518"><span class="linenos">518</span></a>            <span class="p">)</span>
</span><span id="Tiler.get_tile_mosaic_position-519"><a href="#Tiler.get_tile_mosaic_position-519"><span class="linenos">519</span></a>
</span><span id="Tiler.get_tile_mosaic_position-520"><a href="#Tiler.get_tile_mosaic_position-520"><span class="linenos">520</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel_dimension</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">with_channel_dim</span><span class="p">:</span>
</span><span id="Tiler.get_tile_mosaic_position-521"><a href="#Tiler.get_tile_mosaic_position-521"><span class="linenos">521</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_index</span><span class="p">[</span><span class="n">tile_id</span><span class="p">][</span><span class="o">~</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_dim</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel_dimension</span><span class="p">)]</span>
</span><span id="Tiler.get_tile_mosaic_position-522"><a href="#Tiler.get_tile_mosaic_position-522"><span class="linenos">522</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_index</span><span class="p">[</span><span class="n">tile_id</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Returns tile position in the mosaic.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>tile_id (int):</strong>  Specifies which tile's mosaic position will be returned.             Must be smaller than the total number of tiles.</li>
<li><strong>with_channel_dim (bool):</strong>  Specifies whether to return position with channel dimension or without.
Default is False.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>np.ndarray: Tile mosaic position (tile position relative to other tiles).</p>
</blockquote>
</div>


                            </div>
                            <div id="Tiler.get_mosaic_shape" class="classattr">
                                        <input id="Tiler.get_mosaic_shape-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_mosaic_shape</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">with_channel_dim</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>:</span></span>

                <label class="view-source-button" for="Tiler.get_mosaic_shape-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Tiler.get_mosaic_shape"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Tiler.get_mosaic_shape-524"><a href="#Tiler.get_mosaic_shape-524"><span class="linenos">524</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_mosaic_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">with_channel_dim</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="Tiler.get_mosaic_shape-525"><a href="#Tiler.get_mosaic_shape-525"><span class="linenos">525</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns mosaic shape.</span>
</span><span id="Tiler.get_mosaic_shape-526"><a href="#Tiler.get_mosaic_shape-526"><span class="linenos">526</span></a>
</span><span id="Tiler.get_mosaic_shape-527"><a href="#Tiler.get_mosaic_shape-527"><span class="linenos">527</span></a><span class="sd">        Args:</span>
</span><span id="Tiler.get_mosaic_shape-528"><a href="#Tiler.get_mosaic_shape-528"><span class="linenos">528</span></a><span class="sd">            with_channel_dim (bool):</span>
</span><span id="Tiler.get_mosaic_shape-529"><a href="#Tiler.get_mosaic_shape-529"><span class="linenos">529</span></a><span class="sd">                Specifies whether to return shape with channel dimension or without. Defaults to False.</span>
</span><span id="Tiler.get_mosaic_shape-530"><a href="#Tiler.get_mosaic_shape-530"><span class="linenos">530</span></a>
</span><span id="Tiler.get_mosaic_shape-531"><a href="#Tiler.get_mosaic_shape-531"><span class="linenos">531</span></a><span class="sd">        Returns:</span>
</span><span id="Tiler.get_mosaic_shape-532"><a href="#Tiler.get_mosaic_shape-532"><span class="linenos">532</span></a><span class="sd">            np.ndarray: Shape of tiles mosaic.</span>
</span><span id="Tiler.get_mosaic_shape-533"><a href="#Tiler.get_mosaic_shape-533"><span class="linenos">533</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Tiler.get_mosaic_shape-534"><a href="#Tiler.get_mosaic_shape-534"><span class="linenos">534</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel_dimension</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">with_channel_dim</span><span class="p">:</span>
</span><span id="Tiler.get_mosaic_shape-535"><a href="#Tiler.get_mosaic_shape-535"><span class="linenos">535</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indexing_shape</span><span class="p">[</span><span class="o">~</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_dim</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel_dimension</span><span class="p">)]</span>
</span><span id="Tiler.get_mosaic_shape-536"><a href="#Tiler.get_mosaic_shape-536"><span class="linenos">536</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indexing_shape</span>
</span></pre></div>


            <div class="docstring"><p>Returns mosaic shape.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>with_channel_dim (bool):</strong>  Specifies whether to return shape with channel dimension or without. Defaults to False.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>np.ndarray: Shape of tiles mosaic.</p>
</blockquote>
</div>


                            </div>
                            <div id="Tiler.calculate_padding" class="classattr">
                                        <input id="Tiler.calculate_padding-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">calculate_padding</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Tuple</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]</span>:</span></span>

                <label class="view-source-button" for="Tiler.calculate_padding-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Tiler.calculate_padding"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Tiler.calculate_padding-538"><a href="#Tiler.calculate_padding-538"><span class="linenos">538</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_padding</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]:</span>
</span><span id="Tiler.calculate_padding-539"><a href="#Tiler.calculate_padding-539"><span class="linenos">539</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate a frame padding for the current Tiler parameters.</span>
</span><span id="Tiler.calculate_padding-540"><a href="#Tiler.calculate_padding-540"><span class="linenos">540</span></a><span class="sd">        The padding is overlap//2 or tile_step//2, whichever is bigger.</span>
</span><span id="Tiler.calculate_padding-541"><a href="#Tiler.calculate_padding-541"><span class="linenos">541</span></a><span class="sd">        The method returns a tuple (new_shape, padding) where padding is</span>
</span><span id="Tiler.calculate_padding-542"><a href="#Tiler.calculate_padding-542"><span class="linenos">542</span></a><span class="sd">        ((before_1, after_1), … (before_N, after_N)), unique pad widths for each axis N.</span>
</span><span id="Tiler.calculate_padding-543"><a href="#Tiler.calculate_padding-543"><span class="linenos">543</span></a>
</span><span id="Tiler.calculate_padding-544"><a href="#Tiler.calculate_padding-544"><span class="linenos">544</span></a><span class="sd">        In the usual workflow, you&#39;d recalculate tiling settings and then apply padding, prior to tiling.</span>
</span><span id="Tiler.calculate_padding-545"><a href="#Tiler.calculate_padding-545"><span class="linenos">545</span></a><span class="sd">        Then when merging, pass padding to `Merger.merge(extra_padding=padding, ...)`:</span>
</span><span id="Tiler.calculate_padding-546"><a href="#Tiler.calculate_padding-546"><span class="linenos">546</span></a><span class="sd">        ```python</span>
</span><span id="Tiler.calculate_padding-547"><a href="#Tiler.calculate_padding-547"><span class="linenos">547</span></a><span class="sd">        &gt;&gt;&gt; tiler = Tiler(...)</span>
</span><span id="Tiler.calculate_padding-548"><a href="#Tiler.calculate_padding-548"><span class="linenos">548</span></a><span class="sd">        &gt;&gt;&gt; merger = Merger(tiler, ...)</span>
</span><span id="Tiler.calculate_padding-549"><a href="#Tiler.calculate_padding-549"><span class="linenos">549</span></a><span class="sd">        &gt;&gt;&gt; new_shape, padding = tiler.calculate_padding()</span>
</span><span id="Tiler.calculate_padding-550"><a href="#Tiler.calculate_padding-550"><span class="linenos">550</span></a><span class="sd">        &gt;&gt;&gt; tiler.recalculate(data_shape=new_shape)</span>
</span><span id="Tiler.calculate_padding-551"><a href="#Tiler.calculate_padding-551"><span class="linenos">551</span></a><span class="sd">        &gt;&gt;&gt; padded_data = np.pad(data, pad_width=padding, mode=&quot;reflect&quot;)</span>
</span><span id="Tiler.calculate_padding-552"><a href="#Tiler.calculate_padding-552"><span class="linenos">552</span></a><span class="sd">        &gt;&gt;&gt; for tile_id, tile in tiler(padded_data):</span>
</span><span id="Tiler.calculate_padding-553"><a href="#Tiler.calculate_padding-553"><span class="linenos">553</span></a><span class="sd">        &gt;&gt;&gt;     processed_tile = process(tile)</span>
</span><span id="Tiler.calculate_padding-554"><a href="#Tiler.calculate_padding-554"><span class="linenos">554</span></a><span class="sd">        &gt;&gt;&gt;     merger.add(tile_id, processed_tile)</span>
</span><span id="Tiler.calculate_padding-555"><a href="#Tiler.calculate_padding-555"><span class="linenos">555</span></a><span class="sd">        &gt;&gt;&gt; final_image = merger.merge(extra_padding=padding)</span>
</span><span id="Tiler.calculate_padding-556"><a href="#Tiler.calculate_padding-556"><span class="linenos">556</span></a><span class="sd">        ```</span>
</span><span id="Tiler.calculate_padding-557"><a href="#Tiler.calculate_padding-557"><span class="linenos">557</span></a><span class="sd">        Return:</span>
</span><span id="Tiler.calculate_padding-558"><a href="#Tiler.calculate_padding-558"><span class="linenos">558</span></a><span class="sd">            np.ndarray: Resulting shape when padding is applied.</span>
</span><span id="Tiler.calculate_padding-559"><a href="#Tiler.calculate_padding-559"><span class="linenos">559</span></a>
</span><span id="Tiler.calculate_padding-560"><a href="#Tiler.calculate_padding-560"><span class="linenos">560</span></a><span class="sd">            List[Tuple[int, int]]: Calculated padding.</span>
</span><span id="Tiler.calculate_padding-561"><a href="#Tiler.calculate_padding-561"><span class="linenos">561</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Tiler.calculate_padding-562"><a href="#Tiler.calculate_padding-562"><span class="linenos">562</span></a>
</span><span id="Tiler.calculate_padding-563"><a href="#Tiler.calculate_padding-563"><span class="linenos">563</span></a>        <span class="c1"># Choosing padding</span>
</span><span id="Tiler.calculate_padding-564"><a href="#Tiler.calculate_padding-564"><span class="linenos">564</span></a>        <span class="n">pre_pad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tile_step</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_overlap</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="Tiler.calculate_padding-565"><a href="#Tiler.calculate_padding-565"><span class="linenos">565</span></a>        <span class="n">post_pad</span> <span class="o">=</span> <span class="n">pre_pad</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tile_step</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="Tiler.calculate_padding-566"><a href="#Tiler.calculate_padding-566"><span class="linenos">566</span></a>
</span><span id="Tiler.calculate_padding-567"><a href="#Tiler.calculate_padding-567"><span class="linenos">567</span></a>        <span class="n">new_shape</span> <span class="o">=</span> <span class="n">pre_pad</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span> <span class="o">+</span> <span class="n">post_pad</span>
</span><span id="Tiler.calculate_padding-568"><a href="#Tiler.calculate_padding-568"><span class="linenos">568</span></a>        <span class="n">padding</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">pre_pad</span><span class="p">,</span> <span class="n">post_pad</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</span><span id="Tiler.calculate_padding-569"><a href="#Tiler.calculate_padding-569"><span class="linenos">569</span></a>
</span><span id="Tiler.calculate_padding-570"><a href="#Tiler.calculate_padding-570"><span class="linenos">570</span></a>        <span class="k">return</span> <span class="n">new_shape</span><span class="p">,</span> <span class="n">padding</span>
</span></pre></div>


            <div class="docstring"><p>Calculate a frame padding for the current Tiler parameters.
The padding is overlap//2 or tile_step//2, whichever is bigger.
The method returns a tuple (new_shape, padding) where padding is
((before_1, after_1), … (before_N, after_N)), unique pad widths for each axis N.</p>

<p>In the usual workflow, you'd recalculate tiling settings and then apply padding, prior to tiling.
Then when merging, pass padding to <code><a href="#Merger.merge">Merger.merge</a>(extra_padding=padding, ...)</code>:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">tiler</span> <span class="o">=</span> <span class="n">Tiler</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">merger</span> <span class="o">=</span> <span class="n">Merger</span><span class="p">(</span><span class="n">tiler</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">new_shape</span><span class="p">,</span> <span class="n">padding</span> <span class="o">=</span> <span class="n">tiler</span><span class="o">.</span><span class="n">calculate_padding</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">tiler</span><span class="o">.</span><span class="n">recalculate</span><span class="p">(</span><span class="n">data_shape</span><span class="o">=</span><span class="n">new_shape</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">padded_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pad_width</span><span class="o">=</span><span class="n">padding</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;reflect&quot;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">tile_id</span><span class="p">,</span> <span class="n">tile</span> <span class="ow">in</span> <span class="n">tiler</span><span class="p">(</span><span class="n">padded_data</span><span class="p">):</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="n">processed_tile</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="n">tile</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="n">merger</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tile_id</span><span class="p">,</span> <span class="n">processed_tile</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">final_image</span> <span class="o">=</span> <span class="n">merger</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">extra_padding</span><span class="o">=</span><span class="n">padding</span><span class="p">)</span>
</code></pre>
</div>

<h6 id="return">Return:</h6>

<blockquote>
  <p>np.ndarray: Resulting shape when padding is applied.</p>
  
  <p>List[Tuple[int, int]]: Calculated padding.</p>
</blockquote>
</div>


                            </div>
                </section>
                <section id="Merger">
                            <input id="Merger-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Merger</span>:

                <label class="view-source-button" for="Merger-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Merger"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Merger-12"><a href="#Merger-12"><span class="linenos"> 12</span></a><span class="k">class</span><span class="w"> </span><span class="nc">Merger</span><span class="p">:</span>
</span><span id="Merger-13"><a href="#Merger-13"><span class="linenos"> 13</span></a>    <span class="n">SUPPORTED_WINDOWS</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Merger-14"><a href="#Merger-14"><span class="linenos"> 14</span></a>        <span class="s2">&quot;boxcar&quot;</span><span class="p">,</span>
</span><span id="Merger-15"><a href="#Merger-15"><span class="linenos"> 15</span></a>        <span class="s2">&quot;triang&quot;</span><span class="p">,</span>
</span><span id="Merger-16"><a href="#Merger-16"><span class="linenos"> 16</span></a>        <span class="s2">&quot;blackman&quot;</span><span class="p">,</span>
</span><span id="Merger-17"><a href="#Merger-17"><span class="linenos"> 17</span></a>        <span class="s2">&quot;hamming&quot;</span><span class="p">,</span>
</span><span id="Merger-18"><a href="#Merger-18"><span class="linenos"> 18</span></a>        <span class="s2">&quot;hann&quot;</span><span class="p">,</span>
</span><span id="Merger-19"><a href="#Merger-19"><span class="linenos"> 19</span></a>        <span class="s2">&quot;bartlett&quot;</span><span class="p">,</span>
</span><span id="Merger-20"><a href="#Merger-20"><span class="linenos"> 20</span></a>        <span class="s2">&quot;parzen&quot;</span><span class="p">,</span>
</span><span id="Merger-21"><a href="#Merger-21"><span class="linenos"> 21</span></a>        <span class="s2">&quot;bohman&quot;</span><span class="p">,</span>
</span><span id="Merger-22"><a href="#Merger-22"><span class="linenos"> 22</span></a>        <span class="s2">&quot;blackmanharris&quot;</span><span class="p">,</span>
</span><span id="Merger-23"><a href="#Merger-23"><span class="linenos"> 23</span></a>        <span class="s2">&quot;nuttall&quot;</span><span class="p">,</span>
</span><span id="Merger-24"><a href="#Merger-24"><span class="linenos"> 24</span></a>        <span class="s2">&quot;barthann&quot;</span><span class="p">,</span>
</span><span id="Merger-25"><a href="#Merger-25"><span class="linenos"> 25</span></a>        <span class="s2">&quot;overlap-tile&quot;</span><span class="p">,</span>
</span><span id="Merger-26"><a href="#Merger-26"><span class="linenos"> 26</span></a>    <span class="p">]</span>
</span><span id="Merger-27"><a href="#Merger-27"><span class="linenos"> 27</span></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Merger-28"><a href="#Merger-28"><span class="linenos"> 28</span></a><span class="sd">    Supported windows:</span>
</span><span id="Merger-29"><a href="#Merger-29"><span class="linenos"> 29</span></a><span class="sd">    - &#39;boxcar&#39; (default)</span>
</span><span id="Merger-30"><a href="#Merger-30"><span class="linenos"> 30</span></a><span class="sd">        Boxcar window: the weight of each is tile element is 1.</span>
</span><span id="Merger-31"><a href="#Merger-31"><span class="linenos"> 31</span></a><span class="sd">        Also known as rectangular window or Dirichlet window (and equivalent to no window at all).</span>
</span><span id="Merger-32"><a href="#Merger-32"><span class="linenos"> 32</span></a><span class="sd">    - &#39;triang&#39;</span>
</span><span id="Merger-33"><a href="#Merger-33"><span class="linenos"> 33</span></a><span class="sd">        Triangular window.</span>
</span><span id="Merger-34"><a href="#Merger-34"><span class="linenos"> 34</span></a><span class="sd">    - &#39;blackman&#39;</span>
</span><span id="Merger-35"><a href="#Merger-35"><span class="linenos"> 35</span></a><span class="sd">        Blackman window.</span>
</span><span id="Merger-36"><a href="#Merger-36"><span class="linenos"> 36</span></a><span class="sd">    - &#39;hamming&#39;</span>
</span><span id="Merger-37"><a href="#Merger-37"><span class="linenos"> 37</span></a><span class="sd">        Hamming window.</span>
</span><span id="Merger-38"><a href="#Merger-38"><span class="linenos"> 38</span></a><span class="sd">    - &#39;hann&#39;</span>
</span><span id="Merger-39"><a href="#Merger-39"><span class="linenos"> 39</span></a><span class="sd">        Hann window.</span>
</span><span id="Merger-40"><a href="#Merger-40"><span class="linenos"> 40</span></a><span class="sd">    - &#39;bartlett&#39;</span>
</span><span id="Merger-41"><a href="#Merger-41"><span class="linenos"> 41</span></a><span class="sd">        Bartlett window.</span>
</span><span id="Merger-42"><a href="#Merger-42"><span class="linenos"> 42</span></a><span class="sd">    - &#39;parzen&#39;</span>
</span><span id="Merger-43"><a href="#Merger-43"><span class="linenos"> 43</span></a><span class="sd">        Parzen window.</span>
</span><span id="Merger-44"><a href="#Merger-44"><span class="linenos"> 44</span></a><span class="sd">    - &#39;bohman&#39;</span>
</span><span id="Merger-45"><a href="#Merger-45"><span class="linenos"> 45</span></a><span class="sd">        Bohman window.</span>
</span><span id="Merger-46"><a href="#Merger-46"><span class="linenos"> 46</span></a><span class="sd">    - &#39;blackmanharris&#39;</span>
</span><span id="Merger-47"><a href="#Merger-47"><span class="linenos"> 47</span></a><span class="sd">        Minimum 4-term Blackman-Harris window.</span>
</span><span id="Merger-48"><a href="#Merger-48"><span class="linenos"> 48</span></a><span class="sd">    - &#39;nuttall&#39;</span>
</span><span id="Merger-49"><a href="#Merger-49"><span class="linenos"> 49</span></a><span class="sd">        Minimum 4-term Blackman-Harris window according to Nuttall.</span>
</span><span id="Merger-50"><a href="#Merger-50"><span class="linenos"> 50</span></a><span class="sd">    - &#39;barthann&#39;</span>
</span><span id="Merger-51"><a href="#Merger-51"><span class="linenos"> 51</span></a><span class="sd">        Bartlett-Hann window.</span>
</span><span id="Merger-52"><a href="#Merger-52"><span class="linenos"> 52</span></a><span class="sd">    - &#39;overlap-tile&#39;</span>
</span><span id="Merger-53"><a href="#Merger-53"><span class="linenos"> 53</span></a><span class="sd">        Creates a boxcar window for the non-overlapping, middle part of tile, and zeros everywhere else.</span>
</span><span id="Merger-54"><a href="#Merger-54"><span class="linenos"> 54</span></a><span class="sd">        Requires applying padding calculated with `Tiler.calculate_padding()` for correct results.</span>
</span><span id="Merger-55"><a href="#Merger-55"><span class="linenos"> 55</span></a><span class="sd">        (based on Ronneberger et al. 2015, U-Net paper)</span>
</span><span id="Merger-56"><a href="#Merger-56"><span class="linenos"> 56</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Merger-57"><a href="#Merger-57"><span class="linenos"> 57</span></a>
</span><span id="Merger-58"><a href="#Merger-58"><span class="linenos"> 58</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="Merger-59"><a href="#Merger-59"><span class="linenos"> 59</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Merger-60"><a href="#Merger-60"><span class="linenos"> 60</span></a>        <span class="n">tiler</span><span class="p">:</span> <span class="n">Tiler</span><span class="p">,</span>
</span><span id="Merger-61"><a href="#Merger-61"><span class="linenos"> 61</span></a>        <span class="n">window</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Merger-62"><a href="#Merger-62"><span class="linenos"> 62</span></a>        <span class="n">logits</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="Merger-63"><a href="#Merger-63"><span class="linenos"> 63</span></a>        <span class="n">save_visits</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Merger-64"><a href="#Merger-64"><span class="linenos"> 64</span></a>        <span class="n">data_dtype</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">DTypeLike</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
</span><span id="Merger-65"><a href="#Merger-65"><span class="linenos"> 65</span></a>        <span class="n">weights_dtype</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">DTypeLike</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
</span><span id="Merger-66"><a href="#Merger-66"><span class="linenos"> 66</span></a>    <span class="p">):</span>
</span><span id="Merger-67"><a href="#Merger-67"><span class="linenos"> 67</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Merger holds cumulative result buffers for merging tiles created by a given Tiler</span>
</span><span id="Merger-68"><a href="#Merger-68"><span class="linenos"> 68</span></a><span class="sd">        and the window function that is applied to added tiles.</span>
</span><span id="Merger-69"><a href="#Merger-69"><span class="linenos"> 69</span></a>
</span><span id="Merger-70"><a href="#Merger-70"><span class="linenos"> 70</span></a><span class="sd">        There are two required np.float64 buffers: `self.data` and `self.weights_sum`</span>
</span><span id="Merger-71"><a href="#Merger-71"><span class="linenos"> 71</span></a><span class="sd">        and one optional np.uint32 `self.data_visits` (see below `save_visits` argument).</span>
</span><span id="Merger-72"><a href="#Merger-72"><span class="linenos"> 72</span></a>
</span><span id="Merger-73"><a href="#Merger-73"><span class="linenos"> 73</span></a><span class="sd">        Args:</span>
</span><span id="Merger-74"><a href="#Merger-74"><span class="linenos"> 74</span></a><span class="sd">            tiler (Tiler): Tiler with which the tiles were originally created.</span>
</span><span id="Merger-75"><a href="#Merger-75"><span class="linenos"> 75</span></a>
</span><span id="Merger-76"><a href="#Merger-76"><span class="linenos"> 76</span></a><span class="sd">            window (None, str or np.ndarray): Specifies which window function to use for tile merging.</span>
</span><span id="Merger-77"><a href="#Merger-77"><span class="linenos"> 77</span></a><span class="sd">                Must be one of `Merger.SUPPORTED_WINDOWS` or a numpy array with the same size as the tile.</span>
</span><span id="Merger-78"><a href="#Merger-78"><span class="linenos"> 78</span></a><span class="sd">                Default is None which creates a boxcar window (constant 1s).</span>
</span><span id="Merger-79"><a href="#Merger-79"><span class="linenos"> 79</span></a>
</span><span id="Merger-80"><a href="#Merger-80"><span class="linenos"> 80</span></a><span class="sd">            logits (int): Specify whether to add logits dimensions in front of the data array. Default is `0`.</span>
</span><span id="Merger-81"><a href="#Merger-81"><span class="linenos"> 81</span></a>
</span><span id="Merger-82"><a href="#Merger-82"><span class="linenos"> 82</span></a><span class="sd">            save_visits (bool): Specify whether to save which elements has been modified and how many times in</span>
</span><span id="Merger-83"><a href="#Merger-83"><span class="linenos"> 83</span></a><span class="sd">                `self.data_visits`. Can be disabled to save some memory. Default is `True`.</span>
</span><span id="Merger-84"><a href="#Merger-84"><span class="linenos"> 84</span></a>
</span><span id="Merger-85"><a href="#Merger-85"><span class="linenos"> 85</span></a><span class="sd">            data_dtype (np.dtype): Specify data type for data buffer that stores cumulative result.</span>
</span><span id="Merger-86"><a href="#Merger-86"><span class="linenos"> 86</span></a><span class="sd">                Default is `np.float32`.</span>
</span><span id="Merger-87"><a href="#Merger-87"><span class="linenos"> 87</span></a>
</span><span id="Merger-88"><a href="#Merger-88"><span class="linenos"> 88</span></a><span class="sd">            weights_dtype (np.dtype): Specify data type for weights buffer that stores cumulative weights and window.</span>
</span><span id="Merger-89"><a href="#Merger-89"><span class="linenos"> 89</span></a><span class="sd">                If you don&#39;t need precision but would rather save memory you can use `np.float16`.</span>
</span><span id="Merger-90"><a href="#Merger-90"><span class="linenos"> 90</span></a><span class="sd">                Likewise, on the opposite, you can use `np.float64`.</span>
</span><span id="Merger-91"><a href="#Merger-91"><span class="linenos"> 91</span></a><span class="sd">                Default is `np.float32`.</span>
</span><span id="Merger-92"><a href="#Merger-92"><span class="linenos"> 92</span></a>
</span><span id="Merger-93"><a href="#Merger-93"><span class="linenos"> 93</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Merger-94"><a href="#Merger-94"><span class="linenos"> 94</span></a>
</span><span id="Merger-95"><a href="#Merger-95"><span class="linenos"> 95</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tiler</span> <span class="o">=</span> <span class="n">tiler</span>
</span><span id="Merger-96"><a href="#Merger-96"><span class="linenos"> 96</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="Merger-97"><a href="#Merger-97"><span class="linenos"> 97</span></a>
</span><span id="Merger-98"><a href="#Merger-98"><span class="linenos"> 98</span></a>        <span class="c1"># Logits support</span>
</span><span id="Merger-99"><a href="#Merger-99"><span class="linenos"> 99</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">logits</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="n">logits</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Merger-100"><a href="#Merger-100"><span class="linenos">100</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Logits must be an integer 0 or a positive number (</span><span class="si">{</span><span class="n">logits</span><span class="si">}</span><span class="s2">).&quot;</span><span class="p">)</span>
</span><span id="Merger-101"><a href="#Merger-101"><span class="linenos">101</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logits</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">logits</span><span class="p">)</span>
</span><span id="Merger-102"><a href="#Merger-102"><span class="linenos">102</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="Merger-103"><a href="#Merger-103"><span class="linenos">103</span></a>
</span><span id="Merger-104"><a href="#Merger-104"><span class="linenos">104</span></a>        <span class="c1"># Generate data and normalization arrays</span>
</span><span id="Merger-105"><a href="#Merger-105"><span class="linenos">105</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_visits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights_sum</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Merger-106"><a href="#Merger-106"><span class="linenos">106</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">data_dtype</span> <span class="o">=</span> <span class="n">data_dtype</span>
</span><span id="Merger-107"><a href="#Merger-107"><span class="linenos">107</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="Merger-108"><a href="#Merger-108"><span class="linenos">108</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">weights_dtype</span> <span class="o">=</span> <span class="n">weights_dtype</span>
</span><span id="Merger-109"><a href="#Merger-109"><span class="linenos">109</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="Merger-110"><a href="#Merger-110"><span class="linenos">110</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">save_visits</span><span class="p">)</span>
</span><span id="Merger-111"><a href="#Merger-111"><span class="linenos">111</span></a>
</span><span id="Merger-112"><a href="#Merger-112"><span class="linenos">112</span></a>        <span class="c1"># Generate window function</span>
</span><span id="Merger-113"><a href="#Merger-113"><span class="linenos">113</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Merger-114"><a href="#Merger-114"><span class="linenos">114</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="Merger-115"><a href="#Merger-115"><span class="linenos">115</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_window</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>
</span><span id="Merger-116"><a href="#Merger-116"><span class="linenos">116</span></a>
</span><span id="Merger-117"><a href="#Merger-117"><span class="linenos">117</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_window</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">shape</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">,</span> <span class="n">List</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="Merger-118"><a href="#Merger-118"><span class="linenos">118</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate n-dimensional window according to the given shape.</span>
</span><span id="Merger-119"><a href="#Merger-119"><span class="linenos">119</span></a><span class="sd">        Adapted from: https://stackoverflow.com/a/53588640/1668421</span>
</span><span id="Merger-120"><a href="#Merger-120"><span class="linenos">120</span></a>
</span><span id="Merger-121"><a href="#Merger-121"><span class="linenos">121</span></a><span class="sd">        Args:</span>
</span><span id="Merger-122"><a href="#Merger-122"><span class="linenos">122</span></a><span class="sd">            window (str): Specifies window function. Must be one of `Merger.SUPPORTED_WINDOWS`.</span>
</span><span id="Merger-123"><a href="#Merger-123"><span class="linenos">123</span></a>
</span><span id="Merger-124"><a href="#Merger-124"><span class="linenos">124</span></a><span class="sd">            shape (tuple or list): Shape of the requested window.</span>
</span><span id="Merger-125"><a href="#Merger-125"><span class="linenos">125</span></a>
</span><span id="Merger-126"><a href="#Merger-126"><span class="linenos">126</span></a><span class="sd">        Returns:</span>
</span><span id="Merger-127"><a href="#Merger-127"><span class="linenos">127</span></a><span class="sd">            np.ndarray: n-dimensional window of the given shape and function</span>
</span><span id="Merger-128"><a href="#Merger-128"><span class="linenos">128</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Merger-129"><a href="#Merger-129"><span class="linenos">129</span></a>
</span><span id="Merger-130"><a href="#Merger-130"><span class="linenos">130</span></a>        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">weights_dtype</span><span class="p">)</span>
</span><span id="Merger-131"><a href="#Merger-131"><span class="linenos">131</span></a>        <span class="n">overlap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiler</span><span class="o">.</span><span class="n">_tile_overlap</span>
</span><span id="Merger-132"><a href="#Merger-132"><span class="linenos">132</span></a>        <span class="k">for</span> <span class="n">axis</span><span class="p">,</span> <span class="n">length</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">shape</span><span class="p">):</span>
</span><span id="Merger-133"><a href="#Merger-133"><span class="linenos">133</span></a>            <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiler</span><span class="o">.</span><span class="n">channel_dimension</span><span class="p">:</span>
</span><span id="Merger-134"><a href="#Merger-134"><span class="linenos">134</span></a>                <span class="c1"># channel dimension should have weight of 1 everywhere</span>
</span><span id="Merger-135"><a href="#Merger-135"><span class="linenos">135</span></a>                <span class="n">win</span> <span class="o">=</span> <span class="n">get_window</span><span class="p">(</span><span class="s2">&quot;boxcar&quot;</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span>
</span><span id="Merger-136"><a href="#Merger-136"><span class="linenos">136</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Merger-137"><a href="#Merger-137"><span class="linenos">137</span></a>                <span class="k">if</span> <span class="n">window</span> <span class="o">==</span> <span class="s2">&quot;overlap-tile&quot;</span><span class="p">:</span>
</span><span id="Merger-138"><a href="#Merger-138"><span class="linenos">138</span></a>                    <span class="n">axis_overlap</span> <span class="o">=</span> <span class="n">overlap</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="Merger-139"><a href="#Merger-139"><span class="linenos">139</span></a>                    <span class="n">win</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
</span><span id="Merger-140"><a href="#Merger-140"><span class="linenos">140</span></a>                    <span class="n">win</span><span class="p">[</span><span class="n">axis_overlap</span><span class="p">:</span><span class="o">-</span><span class="n">axis_overlap</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Merger-141"><a href="#Merger-141"><span class="linenos">141</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Merger-142"><a href="#Merger-142"><span class="linenos">142</span></a>                    <span class="n">win</span> <span class="o">=</span> <span class="n">get_window</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span>
</span><span id="Merger-143"><a href="#Merger-143"><span class="linenos">143</span></a>
</span><span id="Merger-144"><a href="#Merger-144"><span class="linenos">144</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)):</span>
</span><span id="Merger-145"><a href="#Merger-145"><span class="linenos">145</span></a>                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">axis</span><span class="p">:</span>
</span><span id="Merger-146"><a href="#Merger-146"><span class="linenos">146</span></a>                    <span class="k">continue</span>
</span><span id="Merger-147"><a href="#Merger-147"><span class="linenos">147</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Merger-148"><a href="#Merger-148"><span class="linenos">148</span></a>                    <span class="n">win</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">win</span><span class="p">]</span> <span class="o">*</span> <span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
</span><span id="Merger-149"><a href="#Merger-149"><span class="linenos">149</span></a>
</span><span id="Merger-150"><a href="#Merger-150"><span class="linenos">150</span></a>            <span class="n">w</span> <span class="o">*=</span> <span class="n">win</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights_dtype</span><span class="p">)</span>
</span><span id="Merger-151"><a href="#Merger-151"><span class="linenos">151</span></a>
</span><span id="Merger-152"><a href="#Merger-152"><span class="linenos">152</span></a>        <span class="k">return</span> <span class="n">w</span>
</span><span id="Merger-153"><a href="#Merger-153"><span class="linenos">153</span></a>
</span><span id="Merger-154"><a href="#Merger-154"><span class="linenos">154</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_window</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Merger-155"><a href="#Merger-155"><span class="linenos">155</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets window function depending on the given window function.</span>
</span><span id="Merger-156"><a href="#Merger-156"><span class="linenos">156</span></a>
</span><span id="Merger-157"><a href="#Merger-157"><span class="linenos">157</span></a><span class="sd">        Args:</span>
</span><span id="Merger-158"><a href="#Merger-158"><span class="linenos">158</span></a><span class="sd">            window (None, str or np.ndarray): Specifies which window function to use for tile merging.</span>
</span><span id="Merger-159"><a href="#Merger-159"><span class="linenos">159</span></a><span class="sd">                Must be one of `Merger.SUPPORTED_WINDOWS` or a numpy array with the same size as the tile.</span>
</span><span id="Merger-160"><a href="#Merger-160"><span class="linenos">160</span></a><span class="sd">                If passed None sets a boxcar window (constant 1s).</span>
</span><span id="Merger-161"><a href="#Merger-161"><span class="linenos">161</span></a>
</span><span id="Merger-162"><a href="#Merger-162"><span class="linenos">162</span></a><span class="sd">        Returns:</span>
</span><span id="Merger-163"><a href="#Merger-163"><span class="linenos">163</span></a><span class="sd">            None</span>
</span><span id="Merger-164"><a href="#Merger-164"><span class="linenos">164</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Merger-165"><a href="#Merger-165"><span class="linenos">165</span></a>
</span><span id="Merger-166"><a href="#Merger-166"><span class="linenos">166</span></a>        <span class="c1"># Warn user that changing window type after some elements were already visited is a bad idea.</span>
</span><span id="Merger-167"><a href="#Merger-167"><span class="linenos">167</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_visits</span><span class="p">):</span>
</span><span id="Merger-168"><a href="#Merger-168"><span class="linenos">168</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;You are setting window type after some elements were already added.&quot;</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="Merger-169"><a href="#Merger-169"><span class="linenos">169</span></a>
</span><span id="Merger-170"><a href="#Merger-170"><span class="linenos">170</span></a>        <span class="c1"># Default window is boxcar</span>
</span><span id="Merger-171"><a href="#Merger-171"><span class="linenos">171</span></a>        <span class="k">if</span> <span class="n">window</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Merger-172"><a href="#Merger-172"><span class="linenos">172</span></a>            <span class="n">window</span> <span class="o">=</span> <span class="s2">&quot;boxcar&quot;</span>
</span><span id="Merger-173"><a href="#Merger-173"><span class="linenos">173</span></a>
</span><span id="Merger-174"><a href="#Merger-174"><span class="linenos">174</span></a>        <span class="c1"># Generate or set a window function</span>
</span><span id="Merger-175"><a href="#Merger-175"><span class="linenos">175</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Merger-176"><a href="#Merger-176"><span class="linenos">176</span></a>            <span class="k">if</span> <span class="n">window</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">SUPPORTED_WINDOWS</span><span class="p">:</span>
</span><span id="Merger-177"><a href="#Merger-177"><span class="linenos">177</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unsupported window, please check docs&quot;</span><span class="p">)</span>
</span><span id="Merger-178"><a href="#Merger-178"><span class="linenos">178</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_window</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiler</span><span class="o">.</span><span class="n">tile_shape</span><span class="p">)</span>
</span><span id="Merger-179"><a href="#Merger-179"><span class="linenos">179</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="Merger-180"><a href="#Merger-180"><span class="linenos">180</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">window</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiler</span><span class="o">.</span><span class="n">tile_shape</span><span class="p">):</span>
</span><span id="Merger-181"><a href="#Merger-181"><span class="linenos">181</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Window function must have the same shape as tile shape.&quot;</span><span class="p">)</span>
</span><span id="Merger-182"><a href="#Merger-182"><span class="linenos">182</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights_dtype</span><span class="p">)</span>
</span><span id="Merger-183"><a href="#Merger-183"><span class="linenos">183</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Merger-184"><a href="#Merger-184"><span class="linenos">184</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported type for window function (</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">window</span><span class="p">)</span><span class="si">}</span><span class="s2">), expected str or np.ndarray.&quot;</span><span class="p">)</span>
</span><span id="Merger-185"><a href="#Merger-185"><span class="linenos">185</span></a>
</span><span id="Merger-186"><a href="#Merger-186"><span class="linenos">186</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save_visits</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Merger-187"><a href="#Merger-187"><span class="linenos">187</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Reset data, weights and optional data_visits buffers.</span>
</span><span id="Merger-188"><a href="#Merger-188"><span class="linenos">188</span></a>
</span><span id="Merger-189"><a href="#Merger-189"><span class="linenos">189</span></a><span class="sd">        Should be done after finishing merging full tile set and before starting processing the next tile set.</span>
</span><span id="Merger-190"><a href="#Merger-190"><span class="linenos">190</span></a>
</span><span id="Merger-191"><a href="#Merger-191"><span class="linenos">191</span></a><span class="sd">        Args:</span>
</span><span id="Merger-192"><a href="#Merger-192"><span class="linenos">192</span></a><span class="sd">            save_visits (bool): Specify whether to save which elements has been modified and how many times in</span>
</span><span id="Merger-193"><a href="#Merger-193"><span class="linenos">193</span></a><span class="sd">                `self.data_visits`. Can be disabled to save some memory. Default is `True`.</span>
</span><span id="Merger-194"><a href="#Merger-194"><span class="linenos">194</span></a>
</span><span id="Merger-195"><a href="#Merger-195"><span class="linenos">195</span></a><span class="sd">        Returns:</span>
</span><span id="Merger-196"><a href="#Merger-196"><span class="linenos">196</span></a><span class="sd">            None</span>
</span><span id="Merger-197"><a href="#Merger-197"><span class="linenos">197</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Merger-198"><a href="#Merger-198"><span class="linenos">198</span></a>
</span><span id="Merger-199"><a href="#Merger-199"><span class="linenos">199</span></a>        <span class="n">padded_data_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiler</span><span class="o">.</span><span class="n">_new_shape</span>
</span><span id="Merger-200"><a href="#Merger-200"><span class="linenos">200</span></a>
</span><span id="Merger-201"><a href="#Merger-201"><span class="linenos">201</span></a>        <span class="c1"># Image holds sum of all processed tiles multiplied by the window</span>
</span><span id="Merger-202"><a href="#Merger-202"><span class="linenos">202</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logits</span><span class="p">:</span>
</span><span id="Merger-203"><a href="#Merger-203"><span class="linenos">203</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">logits</span><span class="p">,</span> <span class="o">*</span><span class="n">padded_data_shape</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dtype</span><span class="p">)</span>
</span><span id="Merger-204"><a href="#Merger-204"><span class="linenos">204</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Merger-205"><a href="#Merger-205"><span class="linenos">205</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">padded_data_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dtype</span><span class="p">)</span>
</span><span id="Merger-206"><a href="#Merger-206"><span class="linenos">206</span></a>
</span><span id="Merger-207"><a href="#Merger-207"><span class="linenos">207</span></a>        <span class="c1"># Data visits holds the number of times each element was assigned</span>
</span><span id="Merger-208"><a href="#Merger-208"><span class="linenos">208</span></a>        <span class="k">if</span> <span class="n">save_visits</span><span class="p">:</span>
</span><span id="Merger-209"><a href="#Merger-209"><span class="linenos">209</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">data_visits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">padded_data_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">)</span>  <span class="c1"># uint32 ought to be enough for anyone :)</span>
</span><span id="Merger-210"><a href="#Merger-210"><span class="linenos">210</span></a>
</span><span id="Merger-211"><a href="#Merger-211"><span class="linenos">211</span></a>        <span class="c1"># Total data window (weight) coefficients</span>
</span><span id="Merger-212"><a href="#Merger-212"><span class="linenos">212</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">weights_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">padded_data_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">weights_dtype</span><span class="p">)</span>
</span><span id="Merger-213"><a href="#Merger-213"><span class="linenos">213</span></a>
</span><span id="Merger-214"><a href="#Merger-214"><span class="linenos">214</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tile_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Merger-215"><a href="#Merger-215"><span class="linenos">215</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds `tile_id`-th tile into Merger.</span>
</span><span id="Merger-216"><a href="#Merger-216"><span class="linenos">216</span></a>
</span><span id="Merger-217"><a href="#Merger-217"><span class="linenos">217</span></a><span class="sd">        Args:</span>
</span><span id="Merger-218"><a href="#Merger-218"><span class="linenos">218</span></a><span class="sd">            tile_id (int): Specifies which tile it is.</span>
</span><span id="Merger-219"><a href="#Merger-219"><span class="linenos">219</span></a>
</span><span id="Merger-220"><a href="#Merger-220"><span class="linenos">220</span></a><span class="sd">            data (np.ndarray): Specifies tile data.</span>
</span><span id="Merger-221"><a href="#Merger-221"><span class="linenos">221</span></a>
</span><span id="Merger-222"><a href="#Merger-222"><span class="linenos">222</span></a><span class="sd">        Returns:</span>
</span><span id="Merger-223"><a href="#Merger-223"><span class="linenos">223</span></a><span class="sd">            None</span>
</span><span id="Merger-224"><a href="#Merger-224"><span class="linenos">224</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Merger-225"><a href="#Merger-225"><span class="linenos">225</span></a>        <span class="k">if</span> <span class="n">tile_id</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile_id</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tiler</span><span class="p">):</span>
</span><span id="Merger-226"><a href="#Merger-226"><span class="linenos">226</span></a>            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span>
</span><span id="Merger-227"><a href="#Merger-227"><span class="linenos">227</span></a>                <span class="sa">f</span><span class="s2">&quot;Out of bounds, there is no tile </span><span class="si">{</span><span class="n">tile_id</span><span class="si">}</span><span class="s2">. There are </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tiler</span><span class="p">)</span><span class="si">}</span><span class="s2"> tiles, starting from index 0.&quot;</span>
</span><span id="Merger-228"><a href="#Merger-228"><span class="linenos">228</span></a>            <span class="p">)</span>
</span><span id="Merger-229"><a href="#Merger-229"><span class="linenos">229</span></a>
</span><span id="Merger-230"><a href="#Merger-230"><span class="linenos">230</span></a>        <span class="n">data_shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="Merger-231"><a href="#Merger-231"><span class="linenos">231</span></a>        <span class="n">expected_tile_shape</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Merger-232"><a href="#Merger-232"><span class="linenos">232</span></a>            <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">logits</span><span class="p">,)</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tiler</span><span class="o">.</span><span class="n">tile_shape</span><span class="p">))</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logits</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tiler</span><span class="o">.</span><span class="n">tile_shape</span><span class="p">)</span>
</span><span id="Merger-233"><a href="#Merger-233"><span class="linenos">233</span></a>        <span class="p">)</span>
</span><span id="Merger-234"><a href="#Merger-234"><span class="linenos">234</span></a>
</span><span id="Merger-235"><a href="#Merger-235"><span class="linenos">235</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiler</span><span class="o">.</span><span class="n">mode</span> <span class="o">!=</span> <span class="s2">&quot;irregular&quot;</span><span class="p">:</span>
</span><span id="Merger-236"><a href="#Merger-236"><span class="linenos">236</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">data_shape</span><span class="p">,</span> <span class="n">expected_tile_shape</span><span class="p">)):</span>
</span><span id="Merger-237"><a href="#Merger-237"><span class="linenos">237</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Merger-238"><a href="#Merger-238"><span class="linenos">238</span></a>                    <span class="sa">f</span><span class="s2">&quot;Passed data shape (</span><span class="si">{</span><span class="n">data_shape</span><span class="si">}</span><span class="s2">) does not fit expected tile shape (</span><span class="si">{</span><span class="n">expected_tile_shape</span><span class="si">}</span><span class="s2">).&quot;</span>
</span><span id="Merger-239"><a href="#Merger-239"><span class="linenos">239</span></a>                <span class="p">)</span>
</span><span id="Merger-240"><a href="#Merger-240"><span class="linenos">240</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Merger-241"><a href="#Merger-241"><span class="linenos">241</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">less_equal</span><span class="p">(</span><span class="n">data_shape</span><span class="p">,</span> <span class="n">expected_tile_shape</span><span class="p">)):</span>
</span><span id="Merger-242"><a href="#Merger-242"><span class="linenos">242</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Merger-243"><a href="#Merger-243"><span class="linenos">243</span></a>                    <span class="sa">f</span><span class="s2">&quot;Passed data shape (</span><span class="si">{</span><span class="n">data_shape</span><span class="si">}</span><span class="s2">) must be less or equal than tile shape (</span><span class="si">{</span><span class="n">expected_tile_shape</span><span class="si">}</span><span class="s2">).&quot;</span>
</span><span id="Merger-244"><a href="#Merger-244"><span class="linenos">244</span></a>                <span class="p">)</span>
</span><span id="Merger-245"><a href="#Merger-245"><span class="linenos">245</span></a>
</span><span id="Merger-246"><a href="#Merger-246"><span class="linenos">246</span></a>        <span class="c1"># Select coordinates for data</span>
</span><span id="Merger-247"><a href="#Merger-247"><span class="linenos">247</span></a>        <span class="n">shape_diff</span> <span class="o">=</span> <span class="n">expected_tile_shape</span> <span class="o">-</span> <span class="n">data_shape</span>
</span><span id="Merger-248"><a href="#Merger-248"><span class="linenos">248</span></a>        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiler</span><span class="o">.</span><span class="n">get_tile_bbox</span><span class="p">(</span><span class="n">tile_id</span><span class="p">,</span> <span class="n">with_channel_dim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Merger-249"><a href="#Merger-249"><span class="linenos">249</span></a>
</span><span id="Merger-250"><a href="#Merger-250"><span class="linenos">250</span></a>        <span class="n">sl</span> <span class="o">=</span> <span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="n">shape_diff</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">))]</span>
</span><span id="Merger-251"><a href="#Merger-251"><span class="linenos">251</span></a>        <span class="n">win_sl</span> <span class="o">=</span> <span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="o">-</span><span class="n">diff</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">diff</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">else</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">diff</span> <span class="ow">in</span> <span class="n">shape_diff</span><span class="p">]</span>
</span><span id="Merger-252"><a href="#Merger-252"><span class="linenos">252</span></a>
</span><span id="Merger-253"><a href="#Merger-253"><span class="linenos">253</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logits</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Merger-254"><a href="#Merger-254"><span class="linenos">254</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="nb">tuple</span><span class="p">([</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span> <span class="o">+</span> <span class="n">sl</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">data</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">win_sl</span><span class="p">[</span><span class="mi">1</span><span class="p">:])]</span>
</span><span id="Merger-255"><a href="#Merger-255"><span class="linenos">255</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">weights_sum</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">sl</span><span class="p">)]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">win_sl</span><span class="p">[</span><span class="mi">1</span><span class="p">:])]</span>
</span><span id="Merger-256"><a href="#Merger-256"><span class="linenos">256</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Merger-257"><a href="#Merger-257"><span class="linenos">257</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">sl</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">data</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">win_sl</span><span class="p">)]</span>
</span><span id="Merger-258"><a href="#Merger-258"><span class="linenos">258</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">weights_sum</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">sl</span><span class="p">)]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">win_sl</span><span class="p">)]</span>
</span><span id="Merger-259"><a href="#Merger-259"><span class="linenos">259</span></a>
</span><span id="Merger-260"><a href="#Merger-260"><span class="linenos">260</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_visits</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Merger-261"><a href="#Merger-261"><span class="linenos">261</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">data_visits</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">sl</span><span class="p">)]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Merger-262"><a href="#Merger-262"><span class="linenos">262</span></a>
</span><span id="Merger-263"><a href="#Merger-263"><span class="linenos">263</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Merger-264"><a href="#Merger-264"><span class="linenos">264</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds `batch_id`-th batch of `batch_size` tiles into Merger.</span>
</span><span id="Merger-265"><a href="#Merger-265"><span class="linenos">265</span></a>
</span><span id="Merger-266"><a href="#Merger-266"><span class="linenos">266</span></a><span class="sd">        Args:</span>
</span><span id="Merger-267"><a href="#Merger-267"><span class="linenos">267</span></a><span class="sd">            batch_id (int): Specifies batch number, must be &gt;= 0.</span>
</span><span id="Merger-268"><a href="#Merger-268"><span class="linenos">268</span></a>
</span><span id="Merger-269"><a href="#Merger-269"><span class="linenos">269</span></a><span class="sd">            batch_size (int): Specifies batch size, must be &gt;= 0.</span>
</span><span id="Merger-270"><a href="#Merger-270"><span class="linenos">270</span></a>
</span><span id="Merger-271"><a href="#Merger-271"><span class="linenos">271</span></a><span class="sd">            data (np.ndarray): Tile data array, must have shape `[batch, *tile_shape]</span>
</span><span id="Merger-272"><a href="#Merger-272"><span class="linenos">272</span></a>
</span><span id="Merger-273"><a href="#Merger-273"><span class="linenos">273</span></a><span class="sd">        Returns:</span>
</span><span id="Merger-274"><a href="#Merger-274"><span class="linenos">274</span></a><span class="sd">            None</span>
</span><span id="Merger-275"><a href="#Merger-275"><span class="linenos">275</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Merger-276"><a href="#Merger-276"><span class="linenos">276</span></a>
</span><span id="Merger-277"><a href="#Merger-277"><span class="linenos">277</span></a>        <span class="c1"># calculate total number of batches</span>
</span><span id="Merger-278"><a href="#Merger-278"><span class="linenos">278</span></a>        <span class="n">div</span><span class="p">,</span> <span class="n">mod</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divmod</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tiler</span><span class="p">),</span> <span class="n">batch_size</span><span class="p">)</span>
</span><span id="Merger-279"><a href="#Merger-279"><span class="linenos">279</span></a>        <span class="n">n_batches</span> <span class="o">=</span> <span class="p">(</span><span class="n">div</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">mod</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">div</span>
</span><span id="Merger-280"><a href="#Merger-280"><span class="linenos">280</span></a>
</span><span id="Merger-281"><a href="#Merger-281"><span class="linenos">281</span></a>        <span class="k">if</span> <span class="n">batch_id</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">batch_id</span> <span class="o">&gt;=</span> <span class="n">n_batches</span><span class="p">:</span>
</span><span id="Merger-282"><a href="#Merger-282"><span class="linenos">282</span></a>            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Out of bounds. There are </span><span class="si">{</span><span class="n">n_batches</span><span class="si">}</span><span class="s2"> batches of </span><span class="si">{</span><span class="n">batch_size</span><span class="si">}</span><span class="s2">, starting from index 0.&quot;</span><span class="p">)</span>
</span><span id="Merger-283"><a href="#Merger-283"><span class="linenos">283</span></a>
</span><span id="Merger-284"><a href="#Merger-284"><span class="linenos">284</span></a>        <span class="c1"># add each tile in a batch with computed tile_id</span>
</span><span id="Merger-285"><a href="#Merger-285"><span class="linenos">285</span></a>        <span class="k">for</span> <span class="n">data_i</span><span class="p">,</span> <span class="n">tile_i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
</span><span id="Merger-286"><a href="#Merger-286"><span class="linenos">286</span></a>            <span class="nb">range</span><span class="p">(</span><span class="n">batch_id</span> <span class="o">*</span> <span class="n">batch_size</span><span class="p">,</span> <span class="nb">min</span><span class="p">((</span><span class="n">batch_id</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">batch_size</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tiler</span><span class="p">)))</span>
</span><span id="Merger-287"><a href="#Merger-287"><span class="linenos">287</span></a>        <span class="p">):</span>
</span><span id="Merger-288"><a href="#Merger-288"><span class="linenos">288</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tile_i</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">data_i</span><span class="p">])</span>
</span><span id="Merger-289"><a href="#Merger-289"><span class="linenos">289</span></a>
</span><span id="Merger-290"><a href="#Merger-290"><span class="linenos">290</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_unpad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">extra_padding</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="Merger-291"><a href="#Merger-291"><span class="linenos">291</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Slices/unpads data according to merger and tiler settings, as well as additional padding.</span>
</span><span id="Merger-292"><a href="#Merger-292"><span class="linenos">292</span></a>
</span><span id="Merger-293"><a href="#Merger-293"><span class="linenos">293</span></a><span class="sd">        Args:</span>
</span><span id="Merger-294"><a href="#Merger-294"><span class="linenos">294</span></a><span class="sd">            data (np.ndarray): Data to be sliced.</span>
</span><span id="Merger-295"><a href="#Merger-295"><span class="linenos">295</span></a>
</span><span id="Merger-296"><a href="#Merger-296"><span class="linenos">296</span></a><span class="sd">            extra_padding (tuple of tuples of two ints, optional): Specifies padding that was applied to the data.</span>
</span><span id="Merger-297"><a href="#Merger-297"><span class="linenos">297</span></a><span class="sd">                Number of values padded to the edges of each axis.</span>
</span><span id="Merger-298"><a href="#Merger-298"><span class="linenos">298</span></a><span class="sd">                ((before_1, after_1), … (before_N, after_N)) unique pad widths for each axis.</span>
</span><span id="Merger-299"><a href="#Merger-299"><span class="linenos">299</span></a><span class="sd">                Default is None.</span>
</span><span id="Merger-300"><a href="#Merger-300"><span class="linenos">300</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Merger-301"><a href="#Merger-301"><span class="linenos">301</span></a>        <span class="k">if</span> <span class="n">extra_padding</span><span class="p">:</span>
</span><span id="Merger-302"><a href="#Merger-302"><span class="linenos">302</span></a>            <span class="n">sl</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Merger-303"><a href="#Merger-303"><span class="linenos">303</span></a>                <span class="nb">slice</span><span class="p">(</span><span class="n">pad_from</span><span class="p">,</span> <span class="n">shape</span> <span class="o">-</span> <span class="n">pad_to</span><span class="p">)</span>
</span><span id="Merger-304"><a href="#Merger-304"><span class="linenos">304</span></a>                <span class="k">for</span> <span class="n">shape</span><span class="p">,</span> <span class="p">(</span><span class="n">pad_from</span><span class="p">,</span> <span class="n">pad_to</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tiler</span><span class="o">.</span><span class="n">data_shape</span><span class="p">,</span> <span class="n">extra_padding</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="Merger-305"><a href="#Merger-305"><span class="linenos">305</span></a>            <span class="p">]</span>
</span><span id="Merger-306"><a href="#Merger-306"><span class="linenos">306</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Merger-307"><a href="#Merger-307"><span class="linenos">307</span></a>            <span class="n">sl</span> <span class="o">=</span> <span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiler</span><span class="o">.</span><span class="n">data_shape</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tiler</span><span class="o">.</span><span class="n">data_shape</span><span class="p">))]</span>
</span><span id="Merger-308"><a href="#Merger-308"><span class="linenos">308</span></a>
</span><span id="Merger-309"><a href="#Merger-309"><span class="linenos">309</span></a>        <span class="c1"># if merger has logits dimension, add another slicing in front</span>
</span><span id="Merger-310"><a href="#Merger-310"><span class="linenos">310</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logits</span><span class="p">:</span>
</span><span id="Merger-311"><a href="#Merger-311"><span class="linenos">311</span></a>            <span class="n">sl</span> <span class="o">=</span> <span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span> <span class="o">+</span> <span class="n">sl</span>
</span><span id="Merger-312"><a href="#Merger-312"><span class="linenos">312</span></a>
</span><span id="Merger-313"><a href="#Merger-313"><span class="linenos">313</span></a>        <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">sl</span><span class="p">)]</span>
</span><span id="Merger-314"><a href="#Merger-314"><span class="linenos">314</span></a>
</span><span id="Merger-315"><a href="#Merger-315"><span class="linenos">315</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">merge</span><span class="p">(</span>
</span><span id="Merger-316"><a href="#Merger-316"><span class="linenos">316</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Merger-317"><a href="#Merger-317"><span class="linenos">317</span></a>        <span class="n">unpad</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Merger-318"><a href="#Merger-318"><span class="linenos">318</span></a>        <span class="n">extra_padding</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Merger-319"><a href="#Merger-319"><span class="linenos">319</span></a>        <span class="n">argmax</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Merger-320"><a href="#Merger-320"><span class="linenos">320</span></a>        <span class="n">normalize_by_weights</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Merger-321"><a href="#Merger-321"><span class="linenos">321</span></a>        <span class="n">dtype</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">npt</span><span class="o">.</span><span class="n">DTypeLike</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Merger-322"><a href="#Merger-322"><span class="linenos">322</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="Merger-323"><a href="#Merger-323"><span class="linenos">323</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns merged data array obtained from added tiles.</span>
</span><span id="Merger-324"><a href="#Merger-324"><span class="linenos">324</span></a>
</span><span id="Merger-325"><a href="#Merger-325"><span class="linenos">325</span></a><span class="sd">        Args:</span>
</span><span id="Merger-326"><a href="#Merger-326"><span class="linenos">326</span></a><span class="sd">            unpad (bool): If unpad is True, removes padded array elements. Default is True.</span>
</span><span id="Merger-327"><a href="#Merger-327"><span class="linenos">327</span></a>
</span><span id="Merger-328"><a href="#Merger-328"><span class="linenos">328</span></a><span class="sd">            extra_padding (tuple of tuples of two ints, optional): Specifies padding that was applied to the data.</span>
</span><span id="Merger-329"><a href="#Merger-329"><span class="linenos">329</span></a><span class="sd">                Number of values padded to the edges of each axis.</span>
</span><span id="Merger-330"><a href="#Merger-330"><span class="linenos">330</span></a><span class="sd">                ((before_1, after_1), … (before_N, after_N)) unique pad widths for each axis.</span>
</span><span id="Merger-331"><a href="#Merger-331"><span class="linenos">331</span></a><span class="sd">                Default is None.</span>
</span><span id="Merger-332"><a href="#Merger-332"><span class="linenos">332</span></a>
</span><span id="Merger-333"><a href="#Merger-333"><span class="linenos">333</span></a><span class="sd">            argmax (bool): If argmax is True, the first dimension will be argmaxed.</span>
</span><span id="Merger-334"><a href="#Merger-334"><span class="linenos">334</span></a><span class="sd">                Useful when merger is initialized with `logits=True`.</span>
</span><span id="Merger-335"><a href="#Merger-335"><span class="linenos">335</span></a><span class="sd">                Default is False.</span>
</span><span id="Merger-336"><a href="#Merger-336"><span class="linenos">336</span></a>
</span><span id="Merger-337"><a href="#Merger-337"><span class="linenos">337</span></a><span class="sd">            normalize_by_weights (bool): If normalize is True, the accumulated data will be divided by weights.</span>
</span><span id="Merger-338"><a href="#Merger-338"><span class="linenos">338</span></a><span class="sd">                Default is True.</span>
</span><span id="Merger-339"><a href="#Merger-339"><span class="linenos">339</span></a>
</span><span id="Merger-340"><a href="#Merger-340"><span class="linenos">340</span></a><span class="sd">            dtype (np.dtype, optional): Specify dtype for the final merged output.</span>
</span><span id="Merger-341"><a href="#Merger-341"><span class="linenos">341</span></a><span class="sd">                If None, uses `data_dtype` specified when Merger was initialized.</span>
</span><span id="Merger-342"><a href="#Merger-342"><span class="linenos">342</span></a><span class="sd">                Default is None.</span>
</span><span id="Merger-343"><a href="#Merger-343"><span class="linenos">343</span></a>
</span><span id="Merger-344"><a href="#Merger-344"><span class="linenos">344</span></a><span class="sd">        Returns:</span>
</span><span id="Merger-345"><a href="#Merger-345"><span class="linenos">345</span></a><span class="sd">            np.ndarray: Final merged data array obtained from added tiles.</span>
</span><span id="Merger-346"><a href="#Merger-346"><span class="linenos">346</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Merger-347"><a href="#Merger-347"><span class="linenos">347</span></a>
</span><span id="Merger-348"><a href="#Merger-348"><span class="linenos">348</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
</span><span id="Merger-349"><a href="#Merger-349"><span class="linenos">349</span></a>
</span><span id="Merger-350"><a href="#Merger-350"><span class="linenos">350</span></a>        <span class="k">if</span> <span class="n">normalize_by_weights</span><span class="p">:</span>
</span><span id="Merger-351"><a href="#Merger-351"><span class="linenos">351</span></a>            <span class="c1"># ignoring division by zero</span>
</span><span id="Merger-352"><a href="#Merger-352"><span class="linenos">352</span></a>            <span class="c1"># alternatively, set values &lt; atol to 1</span>
</span><span id="Merger-353"><a href="#Merger-353"><span class="linenos">353</span></a>            <span class="c1"># https://github.com/the-lay/tiler/blob/46e948bb2bd7a909e954baf87a0c15b384109fde/tiler/merger.py#L314</span>
</span><span id="Merger-354"><a href="#Merger-354"><span class="linenos">354</span></a>            <span class="c1"># TODO check which way is better</span>
</span><span id="Merger-355"><a href="#Merger-355"><span class="linenos">355</span></a>            <span class="c1">#  ignoring should be more precise without atol</span>
</span><span id="Merger-356"><a href="#Merger-356"><span class="linenos">356</span></a>            <span class="c1">#  but can hide other errors</span>
</span><span id="Merger-357"><a href="#Merger-357"><span class="linenos">357</span></a>            <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">):</span>
</span><span id="Merger-358"><a href="#Merger-358"><span class="linenos">358</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">data</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights_sum</span><span class="p">)</span>
</span><span id="Merger-359"><a href="#Merger-359"><span class="linenos">359</span></a>
</span><span id="Merger-360"><a href="#Merger-360"><span class="linenos">360</span></a>        <span class="k">if</span> <span class="n">unpad</span><span class="p">:</span>
</span><span id="Merger-361"><a href="#Merger-361"><span class="linenos">361</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unpad</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">extra_padding</span><span class="p">)</span>
</span><span id="Merger-362"><a href="#Merger-362"><span class="linenos">362</span></a>
</span><span id="Merger-363"><a href="#Merger-363"><span class="linenos">363</span></a>        <span class="k">if</span> <span class="n">argmax</span><span class="p">:</span>
</span><span id="Merger-364"><a href="#Merger-364"><span class="linenos">364</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Merger-365"><a href="#Merger-365"><span class="linenos">365</span></a>
</span><span id="Merger-366"><a href="#Merger-366"><span class="linenos">366</span></a>        <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Merger-367"><a href="#Merger-367"><span class="linenos">367</span></a>            <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="Merger-368"><a href="#Merger-368"><span class="linenos">368</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Merger-369"><a href="#Merger-369"><span class="linenos">369</span></a>            <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dtype</span><span class="p">)</span>
</span></pre></div>


    

                            <div id="Merger.__init__" class="classattr">
                                        <input id="Merger.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Merger</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">tiler</span><span class="p">:</span> <span class="n"><a href="#Tiler">Tiler</a></span>,</span><span class="param">	<span class="n">window</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">NoneType</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">logits</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">save_visits</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	data_dtype: Union[numpy.dtype[Any], NoneType, type[Any], numpy._typing._dtype_like._SupportsDType[numpy.dtype[Any]], str, tuple[Any, int], tuple[Any, SupportsIndex | Sequence[SupportsIndex]], list[Any], numpy._typing._dtype_like._DTypeDict, tuple[Any, Any]] = &lt;class &#x27;numpy.float32&#x27;&gt;,</span><span class="param">	weights_dtype: Union[numpy.dtype[Any], NoneType, type[Any], numpy._typing._dtype_like._SupportsDType[numpy.dtype[Any]], str, tuple[Any, int], tuple[Any, SupportsIndex | Sequence[SupportsIndex]], list[Any], numpy._typing._dtype_like._DTypeDict, tuple[Any, Any]] = &lt;class &#x27;numpy.float32&#x27;&gt;</span>)</span>

                <label class="view-source-button" for="Merger.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Merger.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Merger.__init__-58"><a href="#Merger.__init__-58"><span class="linenos"> 58</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="Merger.__init__-59"><a href="#Merger.__init__-59"><span class="linenos"> 59</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Merger.__init__-60"><a href="#Merger.__init__-60"><span class="linenos"> 60</span></a>        <span class="n">tiler</span><span class="p">:</span> <span class="n">Tiler</span><span class="p">,</span>
</span><span id="Merger.__init__-61"><a href="#Merger.__init__-61"><span class="linenos"> 61</span></a>        <span class="n">window</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Merger.__init__-62"><a href="#Merger.__init__-62"><span class="linenos"> 62</span></a>        <span class="n">logits</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="Merger.__init__-63"><a href="#Merger.__init__-63"><span class="linenos"> 63</span></a>        <span class="n">save_visits</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Merger.__init__-64"><a href="#Merger.__init__-64"><span class="linenos"> 64</span></a>        <span class="n">data_dtype</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">DTypeLike</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
</span><span id="Merger.__init__-65"><a href="#Merger.__init__-65"><span class="linenos"> 65</span></a>        <span class="n">weights_dtype</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">DTypeLike</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
</span><span id="Merger.__init__-66"><a href="#Merger.__init__-66"><span class="linenos"> 66</span></a>    <span class="p">):</span>
</span><span id="Merger.__init__-67"><a href="#Merger.__init__-67"><span class="linenos"> 67</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Merger holds cumulative result buffers for merging tiles created by a given Tiler</span>
</span><span id="Merger.__init__-68"><a href="#Merger.__init__-68"><span class="linenos"> 68</span></a><span class="sd">        and the window function that is applied to added tiles.</span>
</span><span id="Merger.__init__-69"><a href="#Merger.__init__-69"><span class="linenos"> 69</span></a>
</span><span id="Merger.__init__-70"><a href="#Merger.__init__-70"><span class="linenos"> 70</span></a><span class="sd">        There are two required np.float64 buffers: `self.data` and `self.weights_sum`</span>
</span><span id="Merger.__init__-71"><a href="#Merger.__init__-71"><span class="linenos"> 71</span></a><span class="sd">        and one optional np.uint32 `self.data_visits` (see below `save_visits` argument).</span>
</span><span id="Merger.__init__-72"><a href="#Merger.__init__-72"><span class="linenos"> 72</span></a>
</span><span id="Merger.__init__-73"><a href="#Merger.__init__-73"><span class="linenos"> 73</span></a><span class="sd">        Args:</span>
</span><span id="Merger.__init__-74"><a href="#Merger.__init__-74"><span class="linenos"> 74</span></a><span class="sd">            tiler (Tiler): Tiler with which the tiles were originally created.</span>
</span><span id="Merger.__init__-75"><a href="#Merger.__init__-75"><span class="linenos"> 75</span></a>
</span><span id="Merger.__init__-76"><a href="#Merger.__init__-76"><span class="linenos"> 76</span></a><span class="sd">            window (None, str or np.ndarray): Specifies which window function to use for tile merging.</span>
</span><span id="Merger.__init__-77"><a href="#Merger.__init__-77"><span class="linenos"> 77</span></a><span class="sd">                Must be one of `Merger.SUPPORTED_WINDOWS` or a numpy array with the same size as the tile.</span>
</span><span id="Merger.__init__-78"><a href="#Merger.__init__-78"><span class="linenos"> 78</span></a><span class="sd">                Default is None which creates a boxcar window (constant 1s).</span>
</span><span id="Merger.__init__-79"><a href="#Merger.__init__-79"><span class="linenos"> 79</span></a>
</span><span id="Merger.__init__-80"><a href="#Merger.__init__-80"><span class="linenos"> 80</span></a><span class="sd">            logits (int): Specify whether to add logits dimensions in front of the data array. Default is `0`.</span>
</span><span id="Merger.__init__-81"><a href="#Merger.__init__-81"><span class="linenos"> 81</span></a>
</span><span id="Merger.__init__-82"><a href="#Merger.__init__-82"><span class="linenos"> 82</span></a><span class="sd">            save_visits (bool): Specify whether to save which elements has been modified and how many times in</span>
</span><span id="Merger.__init__-83"><a href="#Merger.__init__-83"><span class="linenos"> 83</span></a><span class="sd">                `self.data_visits`. Can be disabled to save some memory. Default is `True`.</span>
</span><span id="Merger.__init__-84"><a href="#Merger.__init__-84"><span class="linenos"> 84</span></a>
</span><span id="Merger.__init__-85"><a href="#Merger.__init__-85"><span class="linenos"> 85</span></a><span class="sd">            data_dtype (np.dtype): Specify data type for data buffer that stores cumulative result.</span>
</span><span id="Merger.__init__-86"><a href="#Merger.__init__-86"><span class="linenos"> 86</span></a><span class="sd">                Default is `np.float32`.</span>
</span><span id="Merger.__init__-87"><a href="#Merger.__init__-87"><span class="linenos"> 87</span></a>
</span><span id="Merger.__init__-88"><a href="#Merger.__init__-88"><span class="linenos"> 88</span></a><span class="sd">            weights_dtype (np.dtype): Specify data type for weights buffer that stores cumulative weights and window.</span>
</span><span id="Merger.__init__-89"><a href="#Merger.__init__-89"><span class="linenos"> 89</span></a><span class="sd">                If you don&#39;t need precision but would rather save memory you can use `np.float16`.</span>
</span><span id="Merger.__init__-90"><a href="#Merger.__init__-90"><span class="linenos"> 90</span></a><span class="sd">                Likewise, on the opposite, you can use `np.float64`.</span>
</span><span id="Merger.__init__-91"><a href="#Merger.__init__-91"><span class="linenos"> 91</span></a><span class="sd">                Default is `np.float32`.</span>
</span><span id="Merger.__init__-92"><a href="#Merger.__init__-92"><span class="linenos"> 92</span></a>
</span><span id="Merger.__init__-93"><a href="#Merger.__init__-93"><span class="linenos"> 93</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Merger.__init__-94"><a href="#Merger.__init__-94"><span class="linenos"> 94</span></a>
</span><span id="Merger.__init__-95"><a href="#Merger.__init__-95"><span class="linenos"> 95</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tiler</span> <span class="o">=</span> <span class="n">tiler</span>
</span><span id="Merger.__init__-96"><a href="#Merger.__init__-96"><span class="linenos"> 96</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="Merger.__init__-97"><a href="#Merger.__init__-97"><span class="linenos"> 97</span></a>
</span><span id="Merger.__init__-98"><a href="#Merger.__init__-98"><span class="linenos"> 98</span></a>        <span class="c1"># Logits support</span>
</span><span id="Merger.__init__-99"><a href="#Merger.__init__-99"><span class="linenos"> 99</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">logits</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="n">logits</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Merger.__init__-100"><a href="#Merger.__init__-100"><span class="linenos">100</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Logits must be an integer 0 or a positive number (</span><span class="si">{</span><span class="n">logits</span><span class="si">}</span><span class="s2">).&quot;</span><span class="p">)</span>
</span><span id="Merger.__init__-101"><a href="#Merger.__init__-101"><span class="linenos">101</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logits</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">logits</span><span class="p">)</span>
</span><span id="Merger.__init__-102"><a href="#Merger.__init__-102"><span class="linenos">102</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="Merger.__init__-103"><a href="#Merger.__init__-103"><span class="linenos">103</span></a>
</span><span id="Merger.__init__-104"><a href="#Merger.__init__-104"><span class="linenos">104</span></a>        <span class="c1"># Generate data and normalization arrays</span>
</span><span id="Merger.__init__-105"><a href="#Merger.__init__-105"><span class="linenos">105</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_visits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights_sum</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Merger.__init__-106"><a href="#Merger.__init__-106"><span class="linenos">106</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">data_dtype</span> <span class="o">=</span> <span class="n">data_dtype</span>
</span><span id="Merger.__init__-107"><a href="#Merger.__init__-107"><span class="linenos">107</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="Merger.__init__-108"><a href="#Merger.__init__-108"><span class="linenos">108</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">weights_dtype</span> <span class="o">=</span> <span class="n">weights_dtype</span>
</span><span id="Merger.__init__-109"><a href="#Merger.__init__-109"><span class="linenos">109</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="Merger.__init__-110"><a href="#Merger.__init__-110"><span class="linenos">110</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">save_visits</span><span class="p">)</span>
</span><span id="Merger.__init__-111"><a href="#Merger.__init__-111"><span class="linenos">111</span></a>
</span><span id="Merger.__init__-112"><a href="#Merger.__init__-112"><span class="linenos">112</span></a>        <span class="c1"># Generate window function</span>
</span><span id="Merger.__init__-113"><a href="#Merger.__init__-113"><span class="linenos">113</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Merger.__init__-114"><a href="#Merger.__init__-114"><span class="linenos">114</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="Merger.__init__-115"><a href="#Merger.__init__-115"><span class="linenos">115</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_window</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Merger holds cumulative result buffers for merging tiles created by a given Tiler
and the window function that is applied to added tiles.</p>

<p>There are two required np.float64 buffers: <code>self.data</code> and <code>self.weights_sum</code>
and one optional np.uint32 <code>self.data_visits</code> (see below <code>save_visits</code> argument).</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>tiler (Tiler):</strong>  Tiler with which the tiles were originally created.</li>
<li><strong>window (None, str or np.ndarray):</strong>  Specifies which window function to use for tile merging.
Must be one of <code><a href="#Merger.SUPPORTED_WINDOWS">Merger.SUPPORTED_WINDOWS</a></code> or a numpy array with the same size as the tile.
Default is None which creates a boxcar window (constant 1s).</li>
<li><strong>logits (int):</strong>  Specify whether to add logits dimensions in front of the data array. Default is <code>0</code>.</li>
<li><strong>save_visits (bool):</strong>  Specify whether to save which elements has been modified and how many times in
<code>self.data_visits</code>. Can be disabled to save some memory. Default is <code>True</code>.</li>
<li><strong>data_dtype (np.dtype):</strong>  Specify data type for data buffer that stores cumulative result.
Default is <code>np.float32</code>.</li>
<li><strong>weights_dtype (np.dtype):</strong>  Specify data type for weights buffer that stores cumulative weights and window.
If you don't need precision but would rather save memory you can use <code>np.float16</code>.
Likewise, on the opposite, you can use <code>np.float64</code>.
Default is <code>np.float32</code>.</li>
</ul>
</div>


                            </div>
                            <div id="Merger.SUPPORTED_WINDOWS" class="classattr">
                                <div class="attr variable">
            <span class="name">SUPPORTED_WINDOWS</span>        =
<input id="Merger.SUPPORTED_WINDOWS-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="Merger.SUPPORTED_WINDOWS-view-value"></label><span class="default_value">[&#39;boxcar&#39;, &#39;triang&#39;, &#39;blackman&#39;, &#39;hamming&#39;, &#39;hann&#39;, &#39;bartlett&#39;, &#39;parzen&#39;, &#39;bohman&#39;, &#39;blackmanharris&#39;, &#39;nuttall&#39;, &#39;barthann&#39;, &#39;overlap-tile&#39;]</span>

        
    </div>
    <a class="headerlink" href="#Merger.SUPPORTED_WINDOWS"></a>
    
            <div class="docstring"><p>Supported windows:</p>

<ul>
<li>'boxcar' (default)
Boxcar window: the weight of each is tile element is 1.
Also known as rectangular window or Dirichlet window (and equivalent to no window at all).</li>
<li>'triang'
Triangular window.</li>
<li>'blackman'
Blackman window.</li>
<li>'hamming'
Hamming window.</li>
<li>'hann'
Hann window.</li>
<li>'bartlett'
Bartlett window.</li>
<li>'parzen'
Parzen window.</li>
<li>'bohman'
Bohman window.</li>
<li>'blackmanharris'
Minimum 4-term Blackman-Harris window.</li>
<li>'nuttall'
Minimum 4-term Blackman-Harris window according to Nuttall.</li>
<li>'barthann'
Bartlett-Hann window.</li>
<li>'overlap-tile'
Creates a boxcar window for the non-overlapping, middle part of tile, and zeros everywhere else.
Requires applying padding calculated with <code><a href="#Tiler.calculate_padding">Tiler.calculate_padding()</a></code> for correct results.
(based on Ronneberger et al. 2015, U-Net paper)</li>
</ul>
</div>


                            </div>
                            <div id="Merger.set_window" class="classattr">
                                        <input id="Merger.set_window-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_window</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">window</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">NoneType</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Merger.set_window-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Merger.set_window"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Merger.set_window-154"><a href="#Merger.set_window-154"><span class="linenos">154</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_window</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Merger.set_window-155"><a href="#Merger.set_window-155"><span class="linenos">155</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets window function depending on the given window function.</span>
</span><span id="Merger.set_window-156"><a href="#Merger.set_window-156"><span class="linenos">156</span></a>
</span><span id="Merger.set_window-157"><a href="#Merger.set_window-157"><span class="linenos">157</span></a><span class="sd">        Args:</span>
</span><span id="Merger.set_window-158"><a href="#Merger.set_window-158"><span class="linenos">158</span></a><span class="sd">            window (None, str or np.ndarray): Specifies which window function to use for tile merging.</span>
</span><span id="Merger.set_window-159"><a href="#Merger.set_window-159"><span class="linenos">159</span></a><span class="sd">                Must be one of `Merger.SUPPORTED_WINDOWS` or a numpy array with the same size as the tile.</span>
</span><span id="Merger.set_window-160"><a href="#Merger.set_window-160"><span class="linenos">160</span></a><span class="sd">                If passed None sets a boxcar window (constant 1s).</span>
</span><span id="Merger.set_window-161"><a href="#Merger.set_window-161"><span class="linenos">161</span></a>
</span><span id="Merger.set_window-162"><a href="#Merger.set_window-162"><span class="linenos">162</span></a><span class="sd">        Returns:</span>
</span><span id="Merger.set_window-163"><a href="#Merger.set_window-163"><span class="linenos">163</span></a><span class="sd">            None</span>
</span><span id="Merger.set_window-164"><a href="#Merger.set_window-164"><span class="linenos">164</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Merger.set_window-165"><a href="#Merger.set_window-165"><span class="linenos">165</span></a>
</span><span id="Merger.set_window-166"><a href="#Merger.set_window-166"><span class="linenos">166</span></a>        <span class="c1"># Warn user that changing window type after some elements were already visited is a bad idea.</span>
</span><span id="Merger.set_window-167"><a href="#Merger.set_window-167"><span class="linenos">167</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_visits</span><span class="p">):</span>
</span><span id="Merger.set_window-168"><a href="#Merger.set_window-168"><span class="linenos">168</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;You are setting window type after some elements were already added.&quot;</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="Merger.set_window-169"><a href="#Merger.set_window-169"><span class="linenos">169</span></a>
</span><span id="Merger.set_window-170"><a href="#Merger.set_window-170"><span class="linenos">170</span></a>        <span class="c1"># Default window is boxcar</span>
</span><span id="Merger.set_window-171"><a href="#Merger.set_window-171"><span class="linenos">171</span></a>        <span class="k">if</span> <span class="n">window</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Merger.set_window-172"><a href="#Merger.set_window-172"><span class="linenos">172</span></a>            <span class="n">window</span> <span class="o">=</span> <span class="s2">&quot;boxcar&quot;</span>
</span><span id="Merger.set_window-173"><a href="#Merger.set_window-173"><span class="linenos">173</span></a>
</span><span id="Merger.set_window-174"><a href="#Merger.set_window-174"><span class="linenos">174</span></a>        <span class="c1"># Generate or set a window function</span>
</span><span id="Merger.set_window-175"><a href="#Merger.set_window-175"><span class="linenos">175</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Merger.set_window-176"><a href="#Merger.set_window-176"><span class="linenos">176</span></a>            <span class="k">if</span> <span class="n">window</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">SUPPORTED_WINDOWS</span><span class="p">:</span>
</span><span id="Merger.set_window-177"><a href="#Merger.set_window-177"><span class="linenos">177</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unsupported window, please check docs&quot;</span><span class="p">)</span>
</span><span id="Merger.set_window-178"><a href="#Merger.set_window-178"><span class="linenos">178</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_window</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiler</span><span class="o">.</span><span class="n">tile_shape</span><span class="p">)</span>
</span><span id="Merger.set_window-179"><a href="#Merger.set_window-179"><span class="linenos">179</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="Merger.set_window-180"><a href="#Merger.set_window-180"><span class="linenos">180</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">window</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiler</span><span class="o">.</span><span class="n">tile_shape</span><span class="p">):</span>
</span><span id="Merger.set_window-181"><a href="#Merger.set_window-181"><span class="linenos">181</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Window function must have the same shape as tile shape.&quot;</span><span class="p">)</span>
</span><span id="Merger.set_window-182"><a href="#Merger.set_window-182"><span class="linenos">182</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights_dtype</span><span class="p">)</span>
</span><span id="Merger.set_window-183"><a href="#Merger.set_window-183"><span class="linenos">183</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Merger.set_window-184"><a href="#Merger.set_window-184"><span class="linenos">184</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported type for window function (</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">window</span><span class="p">)</span><span class="si">}</span><span class="s2">), expected str or np.ndarray.&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Sets window function depending on the given window function.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>window (None, str or np.ndarray):</strong>  Specifies which window function to use for tile merging.
Must be one of <code><a href="#Merger.SUPPORTED_WINDOWS">Merger.SUPPORTED_WINDOWS</a></code> or a numpy array with the same size as the tile.
If passed None sets a boxcar window (constant 1s).</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>None</p>
</blockquote>
</div>


                            </div>
                            <div id="Merger.reset" class="classattr">
                                        <input id="Merger.reset-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reset</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">save_visits</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Merger.reset-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Merger.reset"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Merger.reset-186"><a href="#Merger.reset-186"><span class="linenos">186</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save_visits</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Merger.reset-187"><a href="#Merger.reset-187"><span class="linenos">187</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Reset data, weights and optional data_visits buffers.</span>
</span><span id="Merger.reset-188"><a href="#Merger.reset-188"><span class="linenos">188</span></a>
</span><span id="Merger.reset-189"><a href="#Merger.reset-189"><span class="linenos">189</span></a><span class="sd">        Should be done after finishing merging full tile set and before starting processing the next tile set.</span>
</span><span id="Merger.reset-190"><a href="#Merger.reset-190"><span class="linenos">190</span></a>
</span><span id="Merger.reset-191"><a href="#Merger.reset-191"><span class="linenos">191</span></a><span class="sd">        Args:</span>
</span><span id="Merger.reset-192"><a href="#Merger.reset-192"><span class="linenos">192</span></a><span class="sd">            save_visits (bool): Specify whether to save which elements has been modified and how many times in</span>
</span><span id="Merger.reset-193"><a href="#Merger.reset-193"><span class="linenos">193</span></a><span class="sd">                `self.data_visits`. Can be disabled to save some memory. Default is `True`.</span>
</span><span id="Merger.reset-194"><a href="#Merger.reset-194"><span class="linenos">194</span></a>
</span><span id="Merger.reset-195"><a href="#Merger.reset-195"><span class="linenos">195</span></a><span class="sd">        Returns:</span>
</span><span id="Merger.reset-196"><a href="#Merger.reset-196"><span class="linenos">196</span></a><span class="sd">            None</span>
</span><span id="Merger.reset-197"><a href="#Merger.reset-197"><span class="linenos">197</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Merger.reset-198"><a href="#Merger.reset-198"><span class="linenos">198</span></a>
</span><span id="Merger.reset-199"><a href="#Merger.reset-199"><span class="linenos">199</span></a>        <span class="n">padded_data_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiler</span><span class="o">.</span><span class="n">_new_shape</span>
</span><span id="Merger.reset-200"><a href="#Merger.reset-200"><span class="linenos">200</span></a>
</span><span id="Merger.reset-201"><a href="#Merger.reset-201"><span class="linenos">201</span></a>        <span class="c1"># Image holds sum of all processed tiles multiplied by the window</span>
</span><span id="Merger.reset-202"><a href="#Merger.reset-202"><span class="linenos">202</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logits</span><span class="p">:</span>
</span><span id="Merger.reset-203"><a href="#Merger.reset-203"><span class="linenos">203</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">logits</span><span class="p">,</span> <span class="o">*</span><span class="n">padded_data_shape</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dtype</span><span class="p">)</span>
</span><span id="Merger.reset-204"><a href="#Merger.reset-204"><span class="linenos">204</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Merger.reset-205"><a href="#Merger.reset-205"><span class="linenos">205</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">padded_data_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dtype</span><span class="p">)</span>
</span><span id="Merger.reset-206"><a href="#Merger.reset-206"><span class="linenos">206</span></a>
</span><span id="Merger.reset-207"><a href="#Merger.reset-207"><span class="linenos">207</span></a>        <span class="c1"># Data visits holds the number of times each element was assigned</span>
</span><span id="Merger.reset-208"><a href="#Merger.reset-208"><span class="linenos">208</span></a>        <span class="k">if</span> <span class="n">save_visits</span><span class="p">:</span>
</span><span id="Merger.reset-209"><a href="#Merger.reset-209"><span class="linenos">209</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">data_visits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">padded_data_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">)</span>  <span class="c1"># uint32 ought to be enough for anyone :)</span>
</span><span id="Merger.reset-210"><a href="#Merger.reset-210"><span class="linenos">210</span></a>
</span><span id="Merger.reset-211"><a href="#Merger.reset-211"><span class="linenos">211</span></a>        <span class="c1"># Total data window (weight) coefficients</span>
</span><span id="Merger.reset-212"><a href="#Merger.reset-212"><span class="linenos">212</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">weights_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">padded_data_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">weights_dtype</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Reset data, weights and optional data_visits buffers.</p>

<p>Should be done after finishing merging full tile set and before starting processing the next tile set.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>save_visits (bool):</strong>  Specify whether to save which elements has been modified and how many times in
<code>self.data_visits</code>. Can be disabled to save some memory. Default is <code>True</code>.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>None</p>
</blockquote>
</div>


                            </div>
                            <div id="Merger.add" class="classattr">
                                        <input id="Merger.add-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">tile_id</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="n">data</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Merger.add-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Merger.add"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Merger.add-214"><a href="#Merger.add-214"><span class="linenos">214</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tile_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Merger.add-215"><a href="#Merger.add-215"><span class="linenos">215</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds `tile_id`-th tile into Merger.</span>
</span><span id="Merger.add-216"><a href="#Merger.add-216"><span class="linenos">216</span></a>
</span><span id="Merger.add-217"><a href="#Merger.add-217"><span class="linenos">217</span></a><span class="sd">        Args:</span>
</span><span id="Merger.add-218"><a href="#Merger.add-218"><span class="linenos">218</span></a><span class="sd">            tile_id (int): Specifies which tile it is.</span>
</span><span id="Merger.add-219"><a href="#Merger.add-219"><span class="linenos">219</span></a>
</span><span id="Merger.add-220"><a href="#Merger.add-220"><span class="linenos">220</span></a><span class="sd">            data (np.ndarray): Specifies tile data.</span>
</span><span id="Merger.add-221"><a href="#Merger.add-221"><span class="linenos">221</span></a>
</span><span id="Merger.add-222"><a href="#Merger.add-222"><span class="linenos">222</span></a><span class="sd">        Returns:</span>
</span><span id="Merger.add-223"><a href="#Merger.add-223"><span class="linenos">223</span></a><span class="sd">            None</span>
</span><span id="Merger.add-224"><a href="#Merger.add-224"><span class="linenos">224</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Merger.add-225"><a href="#Merger.add-225"><span class="linenos">225</span></a>        <span class="k">if</span> <span class="n">tile_id</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile_id</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tiler</span><span class="p">):</span>
</span><span id="Merger.add-226"><a href="#Merger.add-226"><span class="linenos">226</span></a>            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span>
</span><span id="Merger.add-227"><a href="#Merger.add-227"><span class="linenos">227</span></a>                <span class="sa">f</span><span class="s2">&quot;Out of bounds, there is no tile </span><span class="si">{</span><span class="n">tile_id</span><span class="si">}</span><span class="s2">. There are </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tiler</span><span class="p">)</span><span class="si">}</span><span class="s2"> tiles, starting from index 0.&quot;</span>
</span><span id="Merger.add-228"><a href="#Merger.add-228"><span class="linenos">228</span></a>            <span class="p">)</span>
</span><span id="Merger.add-229"><a href="#Merger.add-229"><span class="linenos">229</span></a>
</span><span id="Merger.add-230"><a href="#Merger.add-230"><span class="linenos">230</span></a>        <span class="n">data_shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="Merger.add-231"><a href="#Merger.add-231"><span class="linenos">231</span></a>        <span class="n">expected_tile_shape</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Merger.add-232"><a href="#Merger.add-232"><span class="linenos">232</span></a>            <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">logits</span><span class="p">,)</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tiler</span><span class="o">.</span><span class="n">tile_shape</span><span class="p">))</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logits</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tiler</span><span class="o">.</span><span class="n">tile_shape</span><span class="p">)</span>
</span><span id="Merger.add-233"><a href="#Merger.add-233"><span class="linenos">233</span></a>        <span class="p">)</span>
</span><span id="Merger.add-234"><a href="#Merger.add-234"><span class="linenos">234</span></a>
</span><span id="Merger.add-235"><a href="#Merger.add-235"><span class="linenos">235</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiler</span><span class="o">.</span><span class="n">mode</span> <span class="o">!=</span> <span class="s2">&quot;irregular&quot;</span><span class="p">:</span>
</span><span id="Merger.add-236"><a href="#Merger.add-236"><span class="linenos">236</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">data_shape</span><span class="p">,</span> <span class="n">expected_tile_shape</span><span class="p">)):</span>
</span><span id="Merger.add-237"><a href="#Merger.add-237"><span class="linenos">237</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Merger.add-238"><a href="#Merger.add-238"><span class="linenos">238</span></a>                    <span class="sa">f</span><span class="s2">&quot;Passed data shape (</span><span class="si">{</span><span class="n">data_shape</span><span class="si">}</span><span class="s2">) does not fit expected tile shape (</span><span class="si">{</span><span class="n">expected_tile_shape</span><span class="si">}</span><span class="s2">).&quot;</span>
</span><span id="Merger.add-239"><a href="#Merger.add-239"><span class="linenos">239</span></a>                <span class="p">)</span>
</span><span id="Merger.add-240"><a href="#Merger.add-240"><span class="linenos">240</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Merger.add-241"><a href="#Merger.add-241"><span class="linenos">241</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">less_equal</span><span class="p">(</span><span class="n">data_shape</span><span class="p">,</span> <span class="n">expected_tile_shape</span><span class="p">)):</span>
</span><span id="Merger.add-242"><a href="#Merger.add-242"><span class="linenos">242</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Merger.add-243"><a href="#Merger.add-243"><span class="linenos">243</span></a>                    <span class="sa">f</span><span class="s2">&quot;Passed data shape (</span><span class="si">{</span><span class="n">data_shape</span><span class="si">}</span><span class="s2">) must be less or equal than tile shape (</span><span class="si">{</span><span class="n">expected_tile_shape</span><span class="si">}</span><span class="s2">).&quot;</span>
</span><span id="Merger.add-244"><a href="#Merger.add-244"><span class="linenos">244</span></a>                <span class="p">)</span>
</span><span id="Merger.add-245"><a href="#Merger.add-245"><span class="linenos">245</span></a>
</span><span id="Merger.add-246"><a href="#Merger.add-246"><span class="linenos">246</span></a>        <span class="c1"># Select coordinates for data</span>
</span><span id="Merger.add-247"><a href="#Merger.add-247"><span class="linenos">247</span></a>        <span class="n">shape_diff</span> <span class="o">=</span> <span class="n">expected_tile_shape</span> <span class="o">-</span> <span class="n">data_shape</span>
</span><span id="Merger.add-248"><a href="#Merger.add-248"><span class="linenos">248</span></a>        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiler</span><span class="o">.</span><span class="n">get_tile_bbox</span><span class="p">(</span><span class="n">tile_id</span><span class="p">,</span> <span class="n">with_channel_dim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Merger.add-249"><a href="#Merger.add-249"><span class="linenos">249</span></a>
</span><span id="Merger.add-250"><a href="#Merger.add-250"><span class="linenos">250</span></a>        <span class="n">sl</span> <span class="o">=</span> <span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="n">shape_diff</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">))]</span>
</span><span id="Merger.add-251"><a href="#Merger.add-251"><span class="linenos">251</span></a>        <span class="n">win_sl</span> <span class="o">=</span> <span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="o">-</span><span class="n">diff</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">diff</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">else</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">diff</span> <span class="ow">in</span> <span class="n">shape_diff</span><span class="p">]</span>
</span><span id="Merger.add-252"><a href="#Merger.add-252"><span class="linenos">252</span></a>
</span><span id="Merger.add-253"><a href="#Merger.add-253"><span class="linenos">253</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logits</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Merger.add-254"><a href="#Merger.add-254"><span class="linenos">254</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="nb">tuple</span><span class="p">([</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span> <span class="o">+</span> <span class="n">sl</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">data</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">win_sl</span><span class="p">[</span><span class="mi">1</span><span class="p">:])]</span>
</span><span id="Merger.add-255"><a href="#Merger.add-255"><span class="linenos">255</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">weights_sum</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">sl</span><span class="p">)]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">win_sl</span><span class="p">[</span><span class="mi">1</span><span class="p">:])]</span>
</span><span id="Merger.add-256"><a href="#Merger.add-256"><span class="linenos">256</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Merger.add-257"><a href="#Merger.add-257"><span class="linenos">257</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">sl</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">data</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">win_sl</span><span class="p">)]</span>
</span><span id="Merger.add-258"><a href="#Merger.add-258"><span class="linenos">258</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">weights_sum</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">sl</span><span class="p">)]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">win_sl</span><span class="p">)]</span>
</span><span id="Merger.add-259"><a href="#Merger.add-259"><span class="linenos">259</span></a>
</span><span id="Merger.add-260"><a href="#Merger.add-260"><span class="linenos">260</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_visits</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Merger.add-261"><a href="#Merger.add-261"><span class="linenos">261</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">data_visits</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">sl</span><span class="p">)]</span> <span class="o">+=</span> <span class="mi">1</span>
</span></pre></div>


            <div class="docstring"><p>Adds <code>tile_id</code>-th tile into Merger.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>tile_id (int):</strong>  Specifies which tile it is.</li>
<li><strong>data (np.ndarray):</strong>  Specifies tile data.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>None</p>
</blockquote>
</div>


                            </div>
                            <div id="Merger.add_batch" class="classattr">
                                        <input id="Merger.add_batch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_batch</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">batch_id</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="n">data</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Merger.add_batch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Merger.add_batch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Merger.add_batch-263"><a href="#Merger.add_batch-263"><span class="linenos">263</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Merger.add_batch-264"><a href="#Merger.add_batch-264"><span class="linenos">264</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds `batch_id`-th batch of `batch_size` tiles into Merger.</span>
</span><span id="Merger.add_batch-265"><a href="#Merger.add_batch-265"><span class="linenos">265</span></a>
</span><span id="Merger.add_batch-266"><a href="#Merger.add_batch-266"><span class="linenos">266</span></a><span class="sd">        Args:</span>
</span><span id="Merger.add_batch-267"><a href="#Merger.add_batch-267"><span class="linenos">267</span></a><span class="sd">            batch_id (int): Specifies batch number, must be &gt;= 0.</span>
</span><span id="Merger.add_batch-268"><a href="#Merger.add_batch-268"><span class="linenos">268</span></a>
</span><span id="Merger.add_batch-269"><a href="#Merger.add_batch-269"><span class="linenos">269</span></a><span class="sd">            batch_size (int): Specifies batch size, must be &gt;= 0.</span>
</span><span id="Merger.add_batch-270"><a href="#Merger.add_batch-270"><span class="linenos">270</span></a>
</span><span id="Merger.add_batch-271"><a href="#Merger.add_batch-271"><span class="linenos">271</span></a><span class="sd">            data (np.ndarray): Tile data array, must have shape `[batch, *tile_shape]</span>
</span><span id="Merger.add_batch-272"><a href="#Merger.add_batch-272"><span class="linenos">272</span></a>
</span><span id="Merger.add_batch-273"><a href="#Merger.add_batch-273"><span class="linenos">273</span></a><span class="sd">        Returns:</span>
</span><span id="Merger.add_batch-274"><a href="#Merger.add_batch-274"><span class="linenos">274</span></a><span class="sd">            None</span>
</span><span id="Merger.add_batch-275"><a href="#Merger.add_batch-275"><span class="linenos">275</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Merger.add_batch-276"><a href="#Merger.add_batch-276"><span class="linenos">276</span></a>
</span><span id="Merger.add_batch-277"><a href="#Merger.add_batch-277"><span class="linenos">277</span></a>        <span class="c1"># calculate total number of batches</span>
</span><span id="Merger.add_batch-278"><a href="#Merger.add_batch-278"><span class="linenos">278</span></a>        <span class="n">div</span><span class="p">,</span> <span class="n">mod</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divmod</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tiler</span><span class="p">),</span> <span class="n">batch_size</span><span class="p">)</span>
</span><span id="Merger.add_batch-279"><a href="#Merger.add_batch-279"><span class="linenos">279</span></a>        <span class="n">n_batches</span> <span class="o">=</span> <span class="p">(</span><span class="n">div</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">mod</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">div</span>
</span><span id="Merger.add_batch-280"><a href="#Merger.add_batch-280"><span class="linenos">280</span></a>
</span><span id="Merger.add_batch-281"><a href="#Merger.add_batch-281"><span class="linenos">281</span></a>        <span class="k">if</span> <span class="n">batch_id</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">batch_id</span> <span class="o">&gt;=</span> <span class="n">n_batches</span><span class="p">:</span>
</span><span id="Merger.add_batch-282"><a href="#Merger.add_batch-282"><span class="linenos">282</span></a>            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Out of bounds. There are </span><span class="si">{</span><span class="n">n_batches</span><span class="si">}</span><span class="s2"> batches of </span><span class="si">{</span><span class="n">batch_size</span><span class="si">}</span><span class="s2">, starting from index 0.&quot;</span><span class="p">)</span>
</span><span id="Merger.add_batch-283"><a href="#Merger.add_batch-283"><span class="linenos">283</span></a>
</span><span id="Merger.add_batch-284"><a href="#Merger.add_batch-284"><span class="linenos">284</span></a>        <span class="c1"># add each tile in a batch with computed tile_id</span>
</span><span id="Merger.add_batch-285"><a href="#Merger.add_batch-285"><span class="linenos">285</span></a>        <span class="k">for</span> <span class="n">data_i</span><span class="p">,</span> <span class="n">tile_i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
</span><span id="Merger.add_batch-286"><a href="#Merger.add_batch-286"><span class="linenos">286</span></a>            <span class="nb">range</span><span class="p">(</span><span class="n">batch_id</span> <span class="o">*</span> <span class="n">batch_size</span><span class="p">,</span> <span class="nb">min</span><span class="p">((</span><span class="n">batch_id</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">batch_size</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tiler</span><span class="p">)))</span>
</span><span id="Merger.add_batch-287"><a href="#Merger.add_batch-287"><span class="linenos">287</span></a>        <span class="p">):</span>
</span><span id="Merger.add_batch-288"><a href="#Merger.add_batch-288"><span class="linenos">288</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tile_i</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">data_i</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>Adds <code>batch_id</code>-th batch of <code>batch_size</code> tiles into Merger.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>batch_id (int):</strong>  Specifies batch number, must be &gt;= 0.</li>
<li><strong>batch_size (int):</strong>  Specifies batch size, must be &gt;= 0.</li>
<li><strong>data (np.ndarray):</strong>  Tile data array, must have shape `[batch, *tile_shape]</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>None</p>
</blockquote>
</div>


                            </div>
                            <div id="Merger.merge" class="classattr">
                                        <input id="Merger.merge-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">merge</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">unpad</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">extra_padding</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">argmax</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">normalize_by_weights</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">dtype</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">NoneType</span><span class="p">,</span> <span class="nb">type</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_dtype_like</span><span class="o">.</span><span class="n">_SupportsDType</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">SupportsIndex</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">SupportsIndex</span><span class="p">]],</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_dtype_like</span><span class="o">.</span><span class="n">_DTypeDict</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>:</span></span>

                <label class="view-source-button" for="Merger.merge-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Merger.merge"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Merger.merge-315"><a href="#Merger.merge-315"><span class="linenos">315</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">merge</span><span class="p">(</span>
</span><span id="Merger.merge-316"><a href="#Merger.merge-316"><span class="linenos">316</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Merger.merge-317"><a href="#Merger.merge-317"><span class="linenos">317</span></a>        <span class="n">unpad</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Merger.merge-318"><a href="#Merger.merge-318"><span class="linenos">318</span></a>        <span class="n">extra_padding</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Merger.merge-319"><a href="#Merger.merge-319"><span class="linenos">319</span></a>        <span class="n">argmax</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Merger.merge-320"><a href="#Merger.merge-320"><span class="linenos">320</span></a>        <span class="n">normalize_by_weights</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Merger.merge-321"><a href="#Merger.merge-321"><span class="linenos">321</span></a>        <span class="n">dtype</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">npt</span><span class="o">.</span><span class="n">DTypeLike</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Merger.merge-322"><a href="#Merger.merge-322"><span class="linenos">322</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="Merger.merge-323"><a href="#Merger.merge-323"><span class="linenos">323</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns merged data array obtained from added tiles.</span>
</span><span id="Merger.merge-324"><a href="#Merger.merge-324"><span class="linenos">324</span></a>
</span><span id="Merger.merge-325"><a href="#Merger.merge-325"><span class="linenos">325</span></a><span class="sd">        Args:</span>
</span><span id="Merger.merge-326"><a href="#Merger.merge-326"><span class="linenos">326</span></a><span class="sd">            unpad (bool): If unpad is True, removes padded array elements. Default is True.</span>
</span><span id="Merger.merge-327"><a href="#Merger.merge-327"><span class="linenos">327</span></a>
</span><span id="Merger.merge-328"><a href="#Merger.merge-328"><span class="linenos">328</span></a><span class="sd">            extra_padding (tuple of tuples of two ints, optional): Specifies padding that was applied to the data.</span>
</span><span id="Merger.merge-329"><a href="#Merger.merge-329"><span class="linenos">329</span></a><span class="sd">                Number of values padded to the edges of each axis.</span>
</span><span id="Merger.merge-330"><a href="#Merger.merge-330"><span class="linenos">330</span></a><span class="sd">                ((before_1, after_1), … (before_N, after_N)) unique pad widths for each axis.</span>
</span><span id="Merger.merge-331"><a href="#Merger.merge-331"><span class="linenos">331</span></a><span class="sd">                Default is None.</span>
</span><span id="Merger.merge-332"><a href="#Merger.merge-332"><span class="linenos">332</span></a>
</span><span id="Merger.merge-333"><a href="#Merger.merge-333"><span class="linenos">333</span></a><span class="sd">            argmax (bool): If argmax is True, the first dimension will be argmaxed.</span>
</span><span id="Merger.merge-334"><a href="#Merger.merge-334"><span class="linenos">334</span></a><span class="sd">                Useful when merger is initialized with `logits=True`.</span>
</span><span id="Merger.merge-335"><a href="#Merger.merge-335"><span class="linenos">335</span></a><span class="sd">                Default is False.</span>
</span><span id="Merger.merge-336"><a href="#Merger.merge-336"><span class="linenos">336</span></a>
</span><span id="Merger.merge-337"><a href="#Merger.merge-337"><span class="linenos">337</span></a><span class="sd">            normalize_by_weights (bool): If normalize is True, the accumulated data will be divided by weights.</span>
</span><span id="Merger.merge-338"><a href="#Merger.merge-338"><span class="linenos">338</span></a><span class="sd">                Default is True.</span>
</span><span id="Merger.merge-339"><a href="#Merger.merge-339"><span class="linenos">339</span></a>
</span><span id="Merger.merge-340"><a href="#Merger.merge-340"><span class="linenos">340</span></a><span class="sd">            dtype (np.dtype, optional): Specify dtype for the final merged output.</span>
</span><span id="Merger.merge-341"><a href="#Merger.merge-341"><span class="linenos">341</span></a><span class="sd">                If None, uses `data_dtype` specified when Merger was initialized.</span>
</span><span id="Merger.merge-342"><a href="#Merger.merge-342"><span class="linenos">342</span></a><span class="sd">                Default is None.</span>
</span><span id="Merger.merge-343"><a href="#Merger.merge-343"><span class="linenos">343</span></a>
</span><span id="Merger.merge-344"><a href="#Merger.merge-344"><span class="linenos">344</span></a><span class="sd">        Returns:</span>
</span><span id="Merger.merge-345"><a href="#Merger.merge-345"><span class="linenos">345</span></a><span class="sd">            np.ndarray: Final merged data array obtained from added tiles.</span>
</span><span id="Merger.merge-346"><a href="#Merger.merge-346"><span class="linenos">346</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Merger.merge-347"><a href="#Merger.merge-347"><span class="linenos">347</span></a>
</span><span id="Merger.merge-348"><a href="#Merger.merge-348"><span class="linenos">348</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
</span><span id="Merger.merge-349"><a href="#Merger.merge-349"><span class="linenos">349</span></a>
</span><span id="Merger.merge-350"><a href="#Merger.merge-350"><span class="linenos">350</span></a>        <span class="k">if</span> <span class="n">normalize_by_weights</span><span class="p">:</span>
</span><span id="Merger.merge-351"><a href="#Merger.merge-351"><span class="linenos">351</span></a>            <span class="c1"># ignoring division by zero</span>
</span><span id="Merger.merge-352"><a href="#Merger.merge-352"><span class="linenos">352</span></a>            <span class="c1"># alternatively, set values &lt; atol to 1</span>
</span><span id="Merger.merge-353"><a href="#Merger.merge-353"><span class="linenos">353</span></a>            <span class="c1"># https://github.com/the-lay/tiler/blob/46e948bb2bd7a909e954baf87a0c15b384109fde/tiler/merger.py#L314</span>
</span><span id="Merger.merge-354"><a href="#Merger.merge-354"><span class="linenos">354</span></a>            <span class="c1"># TODO check which way is better</span>
</span><span id="Merger.merge-355"><a href="#Merger.merge-355"><span class="linenos">355</span></a>            <span class="c1">#  ignoring should be more precise without atol</span>
</span><span id="Merger.merge-356"><a href="#Merger.merge-356"><span class="linenos">356</span></a>            <span class="c1">#  but can hide other errors</span>
</span><span id="Merger.merge-357"><a href="#Merger.merge-357"><span class="linenos">357</span></a>            <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">):</span>
</span><span id="Merger.merge-358"><a href="#Merger.merge-358"><span class="linenos">358</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">data</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights_sum</span><span class="p">)</span>
</span><span id="Merger.merge-359"><a href="#Merger.merge-359"><span class="linenos">359</span></a>
</span><span id="Merger.merge-360"><a href="#Merger.merge-360"><span class="linenos">360</span></a>        <span class="k">if</span> <span class="n">unpad</span><span class="p">:</span>
</span><span id="Merger.merge-361"><a href="#Merger.merge-361"><span class="linenos">361</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unpad</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">extra_padding</span><span class="p">)</span>
</span><span id="Merger.merge-362"><a href="#Merger.merge-362"><span class="linenos">362</span></a>
</span><span id="Merger.merge-363"><a href="#Merger.merge-363"><span class="linenos">363</span></a>        <span class="k">if</span> <span class="n">argmax</span><span class="p">:</span>
</span><span id="Merger.merge-364"><a href="#Merger.merge-364"><span class="linenos">364</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Merger.merge-365"><a href="#Merger.merge-365"><span class="linenos">365</span></a>
</span><span id="Merger.merge-366"><a href="#Merger.merge-366"><span class="linenos">366</span></a>        <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Merger.merge-367"><a href="#Merger.merge-367"><span class="linenos">367</span></a>            <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="Merger.merge-368"><a href="#Merger.merge-368"><span class="linenos">368</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Merger.merge-369"><a href="#Merger.merge-369"><span class="linenos">369</span></a>            <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dtype</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Returns merged data array obtained from added tiles.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>unpad (bool):</strong>  If unpad is True, removes padded array elements. Default is True.</li>
<li><strong>extra_padding (tuple of tuples of two ints, optional):</strong>  Specifies padding that was applied to the data.
Number of values padded to the edges of each axis.
((before_1, after_1), … (before_N, after_N)) unique pad widths for each axis.
Default is None.</li>
<li><strong>argmax (bool):</strong>  If argmax is True, the first dimension will be argmaxed.
Useful when merger is initialized with <code>logits=True</code>.
Default is False.</li>
<li><strong>normalize_by_weights (bool):</strong>  If normalize is True, the accumulated data will be divided by weights.
Default is True.</li>
<li><strong>dtype (np.dtype, optional):</strong>  Specify dtype for the final merged output.
If None, uses <code>data_dtype</code> specified when Merger was initialized.
Default is None.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>np.ndarray: Final merged data array obtained from added tiles.</p>
</blockquote>
</div>


                            </div>
                </section>
    </main>
</body>
</html>